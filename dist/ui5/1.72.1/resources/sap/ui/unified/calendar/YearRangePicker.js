/*!
 * OpenUI5
 * (c) Copyright 2009-2019 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/core/Renderer","./YearPicker","./YearPickerRenderer","./CalendarDate","sap/ui/core/date/UniversalDate","./CalendarUtils","sap/ui/thirdparty/jquery"],function(e,t,a,r,i,s,o){"use strict";var n=t.extend("sap.ui.unified.calendar.YearRangePicker",{metadata:{library:"sap.ui.unified",properties:{years:{type:"int",group:"Appearance",defaultValue:9},columns:{type:"int",group:"Appearance",defaultValue:3},rangeSize:{type:"int",group:"Appearance",defaultValue:20}}},renderer:e.extend(a)});n.prototype.setDate=function(e){var t,a,i,o;e&&s._checkJSDateObject(e);a=e.getFullYear();s._checkYearInValidRange(a);t=r.fromLocalJSDate(e,this.getPrimaryCalendarType());t.setMonth(0,1);this.setProperty("date",e,true);this.setProperty("year",t.getYear(),true);this._oDate=t;if(this.getDomRef()){i=this.getYears();o=new r(this._oDate,this.getPrimaryCalendarType());o.setYear(o.getYear()-Math.floor(i/2)*this.getRangeSize());o=this._checkFirstDate(o);this._updateYears(o,Math.floor(i/2))}return this};n.prototype._checkFirstDate=function(e){var t=this.getYears();var a=new r(this._oMaxDate,this.getPrimaryCalendarType());a.setYear(a.getYear()-t*this.getRangeSize()+1);if(e.isAfter(a)&&e.getYear()!=a.getYear()){e=new r(a,this.getPrimaryCalendarType());e.setMonth(0,1)}else if(e.isBefore(this._oMinDate)&&e.getYear()!=this._oMinDate.getYear()){e=new r(this._oMinDate,this.getPrimaryCalendarType());e.setMonth(0,1)}return e};n.prototype._updatePage=function(e,t,a){var i=this._oItemNavigation.getItemDomRefs(),s=r.fromLocalJSDate(this._oFormatYyyymmdd.parse(o(i[0]).attr("data-sap-year-start")),this.getPrimaryCalendarType()),n=this.getYears();if(e){var h=new r(this._oMaxDate,this.getPrimaryCalendarType());h.setYear(h.getYear()-n*this.getRangeSize()+1);if(s.isBefore(h)){s.setYear(s.getYear()+n*this.getRangeSize());s=this._checkFirstDate(s)}else{return}}else{if(s.isAfter(this._oMinDate)){s.setYear(s.getYear()-n*this.getRangeSize());if(s.isBefore(this._oMinDate)){s=new r(this._oMinDate,this.getPrimaryCalendarType())}s=this._checkFirstDate(s)}else{return}}this._updateYears(s,t);if(a){this.firePageChange()}};n.prototype._updateYears=function(e,t){var a=new r(this._getDate(),this.getPrimaryCalendarType()),n="",h="",g=new r(e,this.getPrimaryCalendarType()),l=this._oItemNavigation.getItemDomRefs(),p,d;a.setYear(a.getYear()+Math.floor(this.getRangeSize()/2));g.setYear(g.getYear()+this.getRangeSize()-1);for(var y=0;y<l.length;y++){p=this._oFormatYyyymmdd.format(e.toUTCJSDate(),true);d=o(l[y]);d.attr("id",this.getId()+"-y"+p);n=this._oYearFormat.format(i.getInstance(e.toUTCJSDate(),e.getCalendarType()),true);h=this._oYearFormat.format(i.getInstance(g.toUTCJSDate(),g.getCalendarType()),true);d.text(n+" - "+h);d.attr("data-sap-year-start",p);if(d.hasClass("sapUiCalItemSel")){d.removeClass("sapUiCalItemSel")}d.removeAttr("aria-selected");if(s._isBetween(a,e,g,true)){t=y}if(s._isBetween(this._oMinDate,e,g,true)||s._isBetween(this._oMaxDate,e,g,true)||this._oMinDate.isBefore(e)&&this._oMaxDate.isAfter(g)){d.removeClass("sapUiCalItemDsbl");d.removeAttr("aria-disabled")}else{d.addClass("sapUiCalItemDsbl");d.attr("aria-disabled",true)}e.setYear(g.getYear()+1);g.setYear(g.getYear()+this.getRangeSize())}this._oItemNavigation.focusItem(t)};n.prototype._selectYear=function(e){var t=this._oItemNavigation.getItemDomRefs(),a=o(t[e]),i=a.attr("data-sap-year-start"),s=r.fromLocalJSDate(this._oFormatYyyymmdd.parse(i),this.getPrimaryCalendarType());if(a.hasClass("sapUiCalItemDsbl")){return false}this.setProperty("date",s.toLocalJSDate(),true);this.setProperty("year",s.getYear(),true);return true};return n});