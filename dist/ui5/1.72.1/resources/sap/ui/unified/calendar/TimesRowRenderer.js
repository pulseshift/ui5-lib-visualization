/*!
 * OpenUI5
 * (c) Copyright 2009-2019 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/unified/calendar/CalendarUtils","sap/ui/core/date/UniversalDate","sap/ui/unified/CalendarLegendRenderer","sap/ui/unified/library","sap/base/Log"],function(e,t,a,i,r){"use strict";var s=i.CalendarDayType;var d={};d.render=function(e,t){var a=t._getStartDate();var i=t.getTooltip_AsString();var r=t.getId();var s={value:r+"-Descr",append:true};e.write("<div");e.writeControlData(t);e.addClass("sapUiCalTimesRow");e.addClass("sapUiCalRow");e.writeClasses();if(i){e.writeAttributeEscaped("title",i)}if(t._getShowHeader()){s.value=s.value+" "+r+"-Head"}e.writeAccessibilityState(t,{role:"grid",readonly:"true",multiselectable:!t.getSingleSelection()||t.getIntervalSelection(),labelledby:s});e.write(">");e.write('<span id="'+r+'-Descr" style="display: none;">'+t._rb.getText("CALENDAR_DIALOG")+"</span>");if(t.getIntervalSelection()){e.write('<span id="'+r+'-Start" style="display: none;">'+t._rb.getText("CALENDAR_START_TIME")+"</span>");e.write('<span id="'+r+'-End" style="display: none;">'+t._rb.getText("CALENDAR_END_TIME")+"</span>")}this.renderRow(e,t,a);e.write("</div>")};d.renderRow=function(e,t,a){var i=t.getId();this.renderHeader(e,t,a);e.write('<div id="'+i+'-times" class="sapUiCalItems">');this.renderTimes(e,t,a);e.write("</div>")};d.renderHeader=function(e,t,a){if(t._getShowHeader()){var i=t._getLocaleData();var r=t.getId();e.write('<div id="'+r+'-Head">');this.renderHeaderLine(e,t,i,a);e.write("</div>")}};d.renderHeaderLine=function(e,t,a,i){var r=t._getFormatDate();var s=t.getId();var d=t.getItems();var l=t._getIntervalStart(i);var n=t.getIntervalMinutes();var o="";var m=0;var g=[];var u=0;for(u=0;u<d;u++){m=r.format(l,true);if(g.length>0&&g[g.length-1].sDay==m){g[g.length-1].iItems++}else{g.push({sDay:m,iItems:1})}l.setUTCMinutes(l.getUTCMinutes()+n)}for(u=0;u<g.length;u++){var v=g[u];o=100/d*v.iItems+"%";e.write('<div id="'+s+"-Head"+u+'"class="sapUiCalHeadText" style="width:'+o+'">');e.write(v.sDay);e.write("</div>")}};d.renderTimes=function(e,t,a){var i=this.getHelper(t,a);var r=t.getItems();var s=100/r+"%";var d=t._getIntervalStart(a);var l="";var n="";for(var o=0;o<r;o++){if(i.oFormatTimeAmPm){n=i.oFormatTimeAmPm.format(d,true);if(l==n){n=""}else{l=n}}this.renderTime(e,t,d,i,s,n);d.setUTCMinutes(d.getUTCMinutes()+i.iMinutes)}};d.getHelper=function(t,a){var i={};i.sLocale=t._getLocale();i.oLocaleData=t._getLocaleData();i.oNow=e._createUniversalUTCDate(new Date,undefined,true);i.sCurrentTime=t._rb.getText("CALENDAR_CURRENT_TIME");i.sId=t.getId();i.oFormatLong=t._getFormatLong();i.oFormatTime=t._getFormatTime();i.oFormatTimeAmPm=t._oFormatTimeAmPm;i.iMinutes=t.getIntervalMinutes();var s=t.getLegend();if(s){var d=sap.ui.getCore().byId(s);if(d){if(!(d instanceof sap.ui.unified.CalendarLegend)){throw new Error(d+" is not an sap.ui.unified.CalendarLegend. "+t)}i.oLegend=d}else{r.warning("CalendarLegend "+s+" does not exist!",t)}}return i};d.renderTime=function(e,i,r,d,l,n){var o=i._getAriaRole();var m={role:o,selected:o!=="gridcell"?null:false,label:"",describedby:""};var g=i._oFormatYyyyMMddHHmm.format(r.getJSDate(),true);var u=i._checkDateSelected(r);var v=i._getDateType(r);var C=i._checkTimeEnabled(r);e.write("<div");e.writeAttribute("id",d.sId+"-"+g);e.addClass("sapUiCalItem");if(l){e.addStyle("width",l)}var p=new t(r.getTime());p.setUTCMinutes(p.getUTCMinutes()+d.iMinutes);if(r.getTime()<=d.oNow.getTime()&&p.getTime()>d.oNow.getTime()){e.addClass("sapUiCalItemNow");m["label"]=d.sCurrentTime+" "}if(u>0){e.addClass("sapUiCalItemSel");if(o==="gridcell"){m["selected"]=true}}if(u==2){e.addClass("sapUiCalItemSelStart");m["describedby"]=m["describedby"]+" "+d.sId+"-Start"}else if(u==3){e.addClass("sapUiCalItemSelEnd");m["describedby"]=m["describedby"]+" "+d.sId+"-End"}else if(u==4){e.addClass("sapUiCalItemSelBetween")}else if(u==5){e.addClass("sapUiCalItemSelStart");e.addClass("sapUiCalItemSelEnd");m["describedby"]=m["describedby"]+" "+d.sId+"-Start";m["describedby"]=m["describedby"]+" "+d.sId+"-End"}if(v&&v.type!=s.None){e.addClass("sapUiCalItem"+v.type);if(v.tooltip){e.writeAttributeEscaped("title",v.tooltip)}}if(!C){e.addClass("sapUiCalItemDsbl");m["disabled"]=true}e.writeAttribute("tabindex","-1");e.writeAttribute("data-sap-time",g);m["label"]=m["label"]+d.oFormatLong.format(r,true);if(v&&v.type!=s.None){a.addCalendarTypeAccInfo(m,v.type,d.oLegend)}e.writeAccessibilityState(null,m);e.writeClasses();e.writeStyles();e.write(">");e.write("<span");e.addClass("sapUiCalItemText");e.writeClasses();e.write(">");e.write(d.oFormatTime.format(r,true));if(n){e.write("<span");e.addClass("sapUiCalItemTextAmPm");e.writeClasses();e.write(">");e.write(n);e.write("</span>")}e.write("</span>");e.write("</div>")};return d},true);