/*!
 * OpenUI5
 * (c) Copyright 2009-2019 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/core/Control","sap/ui/Device","sap/ui/core/LocaleData","sap/ui/core/delegate/ItemNavigation","sap/ui/unified/calendar/CalendarUtils","sap/ui/unified/calendar/CalendarDate","sap/ui/unified/DateRange","sap/ui/unified/library","sap/ui/core/format/DateFormat","sap/ui/core/library","sap/ui/core/Locale","./MonthRenderer","sap/ui/dom/containsOrEquals","sap/ui/events/KeyCodes","sap/ui/thirdparty/jquery"],function(e,t,a,i,r,s,o,n,l,h,d,g,u,f,p){"use strict";var c=h.CalendarType;var y=n.CalendarDayType;var m=e.extend("sap.ui.unified.calendar.Month",{metadata:{library:"sap.ui.unified",properties:{date:{type:"object",group:"Data"},intervalSelection:{type:"boolean",group:"Behavior",defaultValue:false},singleSelection:{type:"boolean",group:"Behavior",defaultValue:true},showHeader:{type:"boolean",group:"Appearance",defaultValue:false},firstDayOfWeek:{type:"int",group:"Appearance",defaultValue:-1},nonWorkingDays:{type:"int[]",group:"Appearance",defaultValue:null},primaryCalendarType:{type:"sap.ui.core.CalendarType",group:"Appearance"},secondaryCalendarType:{type:"sap.ui.core.CalendarType",group:"Appearance"},width:{type:"sap.ui.core.CSSSize",group:"Dimension",defaultValue:null},showWeekNumbers:{type:"boolean",group:"Appearance",defaultValue:true}},aggregations:{selectedDates:{type:"sap.ui.unified.DateRange",multiple:true,singularName:"selectedDate"},specialDates:{type:"sap.ui.unified.DateTypeRange",multiple:true,singularName:"specialDate"},disabledDates:{type:"sap.ui.unified.DateRange",multiple:true,singularName:"disabledDate"}},associations:{ariaLabelledBy:{type:"sap.ui.core.Control",multiple:true,singularName:"ariaLabelledBy"},legend:{type:"sap.ui.unified.CalendarLegend",multiple:false}},events:{select:{},focus:{parameters:{date:{type:"object"},otherMonth:{type:"boolean"},restoreOldDate:{type:"boolean"}}},weekNumberSelect:{allowPreventDefault:true,parameters:{weekNumber:{type:"int"},weekDays:{type:"sap.ui.unified.DateRange"}}}}}});m.prototype.init=function(){var e=sap.ui.getCore().getConfiguration().getCalendarType();this.setProperty("primaryCalendarType",e);this.setProperty("secondaryCalendarType",e);this._oFormatYyyymmdd=l.getInstance({pattern:"yyyyMMdd",calendarType:c.Gregorian});this._oFormatLong=l.getInstance({style:"long",calendarType:e});this._mouseMoveProxy=p.proxy(this._handleMouseMove,this);this._iColumns=7;this._aVisibleDays=[]};m.prototype._getAriaRole=function(){return"gridcell"};m.prototype.exit=function(){if(this._oItemNavigation){this.removeDelegate(this._oItemNavigation);this._oItemNavigation.destroy();delete this._oItemNavigation}if(this._sInvalidateMonth){clearTimeout(this._sInvalidateMonth)}this._aVisibleDays=null};m.prototype.onAfterRendering=function(){D.call(this);T.call(this)};m.prototype.onmouseover=function(e){var t=p(e.target),a=this.getSelectedDates()[0],i,r;if(!this._isMarkingUnfinishedRangeAllowed()){return}if(!t.hasClass("sapUiCalItemText")&&!t.hasClass("sapUiCalItem")){return}if(t.hasClass("sapUiCalItemText")){t=t.parent()}i=parseInt(this._oFormatYyyymmdd.format(a.getStartDate()));r=t.data("sapDay");if(this.hasListeners("datehovered")){this.fireEvent("datehovered",{date1:i,date2:r})}else{this._markDatesBetweenStartAndHoveredDate(i,r)}};m.prototype._markDatesBetweenStartAndHoveredDate=function(e,t){var a,i,r,s;a=this.$().find(".sapUiCalItem");if(e>t){e=e+t;t=e-t;e=e-t}for(s=0;s<a.length;s++){i=p(a[s]);r=i.data("sapDay");if(r>e&&r<t){i.addClass("sapUiCalItemSelBetween")}else{i.removeClass("sapUiCalItemSelBetween")}}};m.prototype.onsapfocusleave=function(e){if(!e.relatedControlId||!u(this.getDomRef(),sap.ui.getCore().byId(e.relatedControlId).getFocusDomRef())){if(this._bMouseMove){this._unbindMousemove(true);var t=this._selectDay(this._getDate());if(!t&&this._oMoveSelectedDate){this._selectDay(this._oMoveSelectedDate)}this._bMoveChange=false;this._bMousedownChange=false;this._oMoveSelectedDate=undefined;M.call(this)}if(this._bMousedownChange){this._bMousedownChange=false;M.call(this)}}};m.prototype.removeAllSelectedDates=function(){this._bDateRangeChanged=true;var e=this.removeAllAggregation("selectedDates");return e};m.prototype.destroySelectedDates=function(){this._bDateRangeChanged=true;var e=this.destroyAggregation("selectedDates");return e};m.prototype.removeAllSpecialDates=function(){this._bDateRangeChanged=true;var e=this.removeAllAggregation("specialDates");return e};m.prototype.destroySpecialDates=function(){this._bDateRangeChanged=true;var e=this.destroyAggregation("specialDates");return e};m.prototype.removeAllDisabledDates=function(){this._bDateRangeChanged=true;var e=this.removeAllAggregation("disabledDates");return e};m.prototype.destroyDisabledDates=function(){this._bDateRangeChanged=true;var e=this.destroyAggregation("disabledDates");return e};m.prototype.setDate=function(e){var t=s.fromLocalJSDate(e,this.getPrimaryCalendarType());S.call(this,t,false);return this};m.prototype._setDate=function(e){var t=e.toLocalJSDate();this.setProperty("date",t,true);this._oDate=e};m.prototype._getDate=function(){if(!this._oDate){this._oDate=s.fromLocalJSDate(new Date,this.getPrimaryCalendarType())}return this._oDate};m.prototype.displayDate=function(e){var t=s.fromLocalJSDate(e,this.getPrimaryCalendarType());S.call(this,t,true);return this};m.prototype.setPrimaryCalendarType=function(e){this.setProperty("primaryCalendarType",e);this._oFormatLong=l.getInstance({style:"long",calendarType:e});if(this._oDate){this._oDate=new s(this._oDate,e)}return this};m.prototype.setSecondaryCalendarType=function(e){this._bSecondaryCalendarTypeSet=true;this.setProperty("secondaryCalendarType",e);this.invalidate();this._oFormatSecondaryLong=l.getInstance({style:"long",calendarType:e});return this};m.prototype._getSecondaryCalendarType=function(){var e;if(this._bSecondaryCalendarTypeSet){e=this.getSecondaryCalendarType();var t=this.getPrimaryCalendarType();if(e===t){e=undefined}}return e};m.prototype._getLocale=function(){var e=this.getParent();if(e&&e.getLocale){return e.getLocale()}else if(!this._sLocale){this._sLocale=sap.ui.getCore().getConfiguration().getFormatSettings().getFormatLocale().toString()}return this._sLocale};m.prototype._getLocaleData=function(){var e=this.getParent();if(e&&e._getLocaleData){return e._getLocaleData()}else if(!this._oLocaleData){var t=this._getLocale();var i=new d(t);this._oLocaleData=a.getInstance(i)}return this._oLocaleData};m.prototype._getFormatLong=function(){var e=this._getLocale();if(this._oFormatLong.oLocale.toString()!==e){var t=new d(e);this._oFormatLong=l.getInstance({style:"long",calendarType:this.getPrimaryCalendarType()},t);if(this._oFormatSecondaryLong){this._oFormatSecondaryLong=l.getInstance({style:"long",calendarType:this._getSecondaryCalendarType()},t)}}return this._oFormatLong};m.prototype.getIntervalSelection=function(){var e=this.getParent();if(e&&e.getIntervalSelection){return e.getIntervalSelection()}else{return this.getProperty("intervalSelection")}};m.prototype.getSingleSelection=function(){var e=this.getParent();if(e&&e.getSingleSelection){return e.getSingleSelection()}else{return this.getProperty("singleSelection")}};m.prototype.getSelectedDates=function(){var e=this.getParent();if(e&&e.getSelectedDates){return e.getSelectedDates()}else{return this.getAggregation("selectedDates",[])}};m.prototype.getSpecialDates=function(){var e=this.getParent();if(e&&e.getSpecialDates){return e.getSpecialDates()}else{return this.getAggregation("specialDates",[])}};m.prototype.getDisabledDates=function(){var e=this.getParent();if(e&&e.getDisabledDates){return e.getDisabledDates()}else{return this.getAggregation("disabledDates",[])}};m.prototype.getPrimaryCalendarType=function(){var e=this.getParent();if(e&&e.getPrimaryCalendarType){return e.getPrimaryCalendarType()}return this.getProperty("primaryCalendarType")};m.prototype._getShowHeader=function(){var e=this.getParent();if(e&&e._getShowMonthHeader){return e._getShowMonthHeader()}else{return this.getProperty("showHeader")}};m.prototype.getAriaLabelledBy=function(){var e=this.getParent();if(e&&e.getAriaLabelledBy){return e.getAriaLabelledBy()}else{return this.getAssociation("ariaLabelledBy",[])}};m.prototype.getLegend=function(){var e=this.getParent();if(e&&e.getLegend){return e.getLegend()}else{return this.getAssociation("legend",[])}};m.prototype._getFirstDayOfWeek=function(){var e=this.getParent();var t=0;if(e&&e.getFirstDayOfWeek){t=e.getFirstDayOfWeek()}else{t=this.getProperty("firstDayOfWeek")}if(t<0||t>6){var a=this._getLocaleData();t=a.getFirstDayOfWeek()}return t};m.prototype._getNonWorkingDays=function(){var e=this.getParent();var t;if(e&&e.getNonWorkingDays){t=e.getNonWorkingDays()}else{t=this.getProperty("nonWorkingDays")}if(t&&!Array.isArray(t)){t=[]}return t};m.prototype._checkDateSelected=function(e){r._checkCalendarDate(e);var t=0;var a=this.getSelectedDates();var i=e.toUTCJSDate().getTime();var o=this.getPrimaryCalendarType();for(var n=0;n<a.length;n++){var l=a[n];var h=l.getStartDate();var d=0;if(h){h=s.fromLocalJSDate(h,o);d=h.toUTCJSDate().getTime()}var g=l.getEndDate();var u=0;if(g){g=s.fromLocalJSDate(g,o);u=g.toUTCJSDate().getTime()}if(i===d&&!g){t=1;break}else if(i===d&&g){t=2;if(g&&i===u){t=5}break}else if(g&&i===u){t=3;break}else if(g&&i>d&&i<u){t=4;break}if(this.getSingleSelection()){break}}return t};m.prototype._getDateTypes=function(e){r._checkCalendarDate(e);var t,a,i,s=[];var o=this.getSpecialDates();var n=e.toUTCJSDate().getTime();var l=new Date(Date.UTC(0,0,1));for(var h=0;h<o.length;h++){var d=o[h];var g=d.getStartDate();var u=r.MAX_MILLISECONDS;if(g){l.setUTCFullYear(g.getFullYear(),g.getMonth(),g.getDate());u=l.getTime()}var f=d.getEndDate();var p=-r.MAX_MILLISECONDS;if(f){l.setUTCFullYear(f.getFullYear(),f.getMonth(),f.getDate());p=l.getTime()}i=d.getType()===y.NonWorking;if(n===u&&!f||n>=u&&n<=p){if(!i&&!t){t={type:d.getType(),tooltip:d.getTooltip_AsString()};s.push(t)}else if(i&&!a){a={type:d.getType(),tooltip:d.getTooltip_AsString()};s.push(a)}if(t&&a){break}}}return s};m.prototype._checkDateEnabled=function(e){r._checkCalendarDate(e);var t=true;var a=this.getDisabledDates();var i=e.toUTCJSDate().getTime();var o=this.getPrimaryCalendarType();var n=this.getParent();if(n&&n._oMinDate&&n._oMaxDate){if(i<n._oMinDate.valueOf()||i>n._oMaxDate.valueOf()){return false}}for(var l=0;l<a.length;l++){var h=a[l];var d=h.getStartDate();var g=0;if(d){d=s.fromLocalJSDate(d,o);g=d.toUTCJSDate().getTime()}var u=h.getEndDate();var f=0;if(u){u=s.fromLocalJSDate(u,o);f=u.toUTCJSDate().getTime()}if(u){if(i>g&&i<f){t=false;break}}else if(i===g){t=false;break}}return t};m.prototype._handleMouseMove=function(e){if(!this.$().is(":visible")){this._unbindMousemove(true)}var t=p(e.target);if(t.hasClass("sapUiCalItemText")){t=t.parent()}if(this._sLastTargetId&&this._sLastTargetId===t.attr("id")){return}this._sLastTargetId=t.attr("id");if(t.hasClass("sapUiCalItem")){var a=this._getDate();if(!u(this.getDomRef(),e.target)){var i=this.getSelectedDates();if(i.length>0&&this.getSingleSelection()){var r=i[0].getStartDate();if(r){r=s.fromLocalJSDate(r,this.getPrimaryCalendarType())}var o=s.fromLocalJSDate(this._oFormatYyyymmdd.parse(t.attr("data-sap-day")));if(o.isSameOrAfter(r)){I.call(this,r,o)}else{I.call(this,o,r)}}}else{var n=s.fromLocalJSDate(this._oFormatYyyymmdd.parse(t.attr("data-sap-day")),this.getPrimaryCalendarType());if(!n.isSame(a)){if(t.hasClass("sapUiCalItemOtherMonth")){this.fireFocus({date:n.toLocalJSDate(),otherMonth:true})}else{this._setDate(n);var l=this._selectDay(n,true);if(l){this._oMoveSelectedDate=new s(n,this.getPrimaryCalendarType())}this._bMoveChange=true}}}}};m.prototype.onmousedown=function(e){this._oMousedownPosition={clientX:e.clientX,clientY:e.clientY}};m.prototype.onmouseup=function(e){var a=e.button!==2;if(this._bMouseMove){this._unbindMousemove(true);var i=this._getDate();var r=this._oItemNavigation.getItemDomRefs();for(var s=0;s<r.length;s++){var o=p(r[s]);if(!o.hasClass("sapUiCalItemOtherMonth")){if(o.attr("data-sap-day")===this._oFormatYyyymmdd.format(i.toUTCJSDate(),true)){o.focus();break}}}if(this._bMoveChange){var n=this._selectDay(i);if(!n&&this._oMoveSelectedDate){this._selectDay(this._oMoveSelectedDate)}this._bMoveChange=false;this._bMousedownChange=false;this._oMoveSelectedDate=undefined;M.call(this)}}if(this._bMousedownChange){this._bMousedownChange=false;M.call(this)}else if(t.support.touch&&a&&this._areMouseEventCoordinatesInThreshold(e.clientX,e.clientY,10)){var l=e.target.classList,h=l.contains("sapUiCalItemText")||l.contains("sapUiCalDayName"),d=l.contains("sapUiCalWeekNum"),g=this._getSelectedDateFromEvent(e);if(d&&this._isWeekSelectionAllowed()){this._handleWeekSelection(g,true)}else if(h&&e.shiftKey&&this._isConsecutiveDaysSelectionAllowed()){this._handleConsecutiveDaysSelection(g)}else if(h){this._selectDay(g,false,false);M.call(this)}}};m.prototype.onsapselect=function(e){if(this.bSpaceButtonPressed){return}var t=this._selectDay(this._getSelectedDateFromEvent(e));if(t){M.call(this)}e.stopPropagation();e.preventDefault()};m.prototype.onkeydown=function(e){if(e.which===f.SPACE){this.bSpaceButtonPressed=true}};m.prototype.onkeyup=function(e){if(e.which===f.SPACE){this.bSpaceButtonPressed=false}};m.prototype.onsapselectmodifiers=function(e){var t=this._getSelectedDateFromEvent(e),a;if(this._isWeekSelectionAllowed()&&e.shiftKey&&e.keyCode===f.SPACE){a=r._getFirstDateOfWeek(t);this._handleWeekSelection(a,false)}else if(this._isConsecutiveDaysSelectionAllowed()&&e.shiftKey&&e.keyCode===f.ENTER){this._handleConsecutiveDaysSelection(t)}e.preventDefault()};m.prototype.onsappageupmodifiers=function(e){var t=new s(this._getDate(),this.getPrimaryCalendarType());var a=t.getYear();if(e.metaKey||e.ctrlKey){t.setYear(a-10)}else{t.setYear(a-1)}this.fireFocus({date:t.toLocalJSDate(),otherMonth:true});e.preventDefault()};m.prototype.onsappagedownmodifiers=function(e){var t=new s(this._getDate(),this.getPrimaryCalendarType());var a=t.getYear();if(e.metaKey||e.ctrlKey){t.setYear(a+10)}else{t.setYear(a+1)}this.fireFocus({date:t.toLocalJSDate(),otherMonth:true});e.preventDefault()};m.prototype._updateSelection=function(){var e=this.getSelectedDates();if(e.length>0){var t=this.getPrimaryCalendarType();var a=e.map(function(e){var a=e.getStartDate();if(a){return s.fromLocalJSDate(a,t)}});var i=e[0].getEndDate();if(i){i=s.fromLocalJSDate(i,t)}I.call(this,a,i)}};m.prototype._isValueInThreshold=function(e,t,a){var i=e-a,r=e+a;return t>=i&&t<=r};m.prototype._areMouseEventCoordinatesInThreshold=function(e,t,a){return this._isValueInThreshold(this._oMousedownPosition.clientX,e,a)&&this._isValueInThreshold(this._oMousedownPosition.clientY,t,a)};m.prototype._bindMousemove=function(e){p(window.document).bind("mousemove",this._mouseMoveProxy);this._bMouseMove=true;if(e){this.fireEvent("_bindMousemove")}};m.prototype._unbindMousemove=function(e){p(window.document).unbind("mousemove",this._mouseMoveProxy);this._bMouseMove=undefined;this._sLastTargetId=undefined;if(e){this.fireEvent("_unbindMousemove")}};m.prototype.onThemeChanged=function(){if(this._bNoThemeChange){return}this._bNamesLengthChecked=undefined;this._bLongWeekDays=undefined;var e=this.$().find(".sapUiCalWH");var t=this._getLocaleData();var a=this._getFirstWeekDay();var i=t.getDaysStandAlone("abbreviated",this.getPrimaryCalendarType());for(var r=0;r<e.length;r++){var s=e[r];p(s).text(i[(r+a)%7])}T.call(this)};m.prototype._handleBorderReached=function(e){var t=e.getParameter("event");var a=0;var i=this._getDate();var r=new s(i,this.getPrimaryCalendarType());if(t.type){switch(t.type){case"sapnext":case"sapnextmodifiers":if(t.keyCode===f.ARROW_DOWN){r.setDate(r.getDate()+7)}else{r.setDate(r.getDate()+1)}break;case"sapprevious":case"sappreviousmodifiers":if(t.keyCode===f.ARROW_UP){r.setDate(r.getDate()-7)}else{r.setDate(r.getDate()-1)}break;case"sappagedown":a=r.getMonth()+1;r.setMonth(a);if(a%12!==r.getMonth()){while(a!==r.getMonth()){r.setDate(r.getDate()-1)}}break;case"sappageup":a=r.getMonth()-1;r.setMonth(a);if(a<0){a=11}if(a!==r.getMonth()){while(a!==r.getMonth()){r.setDate(r.getDate()-1)}}break;default:break}this.fireFocus({date:r.toLocalJSDate(),otherMonth:true});if(this._isMarkingUnfinishedRangeAllowed()){var o=this.getSelectedDates()[0],n=parseInt(this._oFormatYyyymmdd.format(o.getStartDate())),l=parseInt(this._oFormatYyyymmdd.format(r.toLocalJSDate()));this._markDatesBetweenStartAndHoveredDate(n,l)}}};m.prototype.checkDateFocusable=function(e){r._checkJSDateObject(e);var t=this._getDate();var a=s.fromLocalJSDate(e,this.getPrimaryCalendarType());return r._isSameMonthAndYear(a,t)};m.prototype.applyFocusInfo=function(e){this._oItemNavigation.focusItem(this._oItemNavigation.getFocusedIndex());return this};m.prototype._renderHeader=function(){if(this._getShowHeader()){var e=this._getDate();var t=this._getLocaleData();var a=t.getMonthsStandAlone("wide",this.getPrimaryCalendarType());this.$("Head").text(a[e.getMonth()])}};m.prototype._getFirstWeekDay=function(){return this._getFirstDayOfWeek()};m.prototype._isMonthNameLong=function(e){var t;var a;for(t=0;t<e.length;t++){a=e[t];if(Math.abs(a.clientWidth-a.scrollWidth)>1){return true}}return false};m.prototype._getVisibleDays=function(e,t){var a,i,r,o,n,l,h;if(!e){return this._aVisibleDays}this._aVisibleDays=[];l=this._getFirstDayOfWeek();n=new s(e,this.getPrimaryCalendarType());n.setDate(1);o=n.getDay()-l;if(o<0){o=7+o}if(o>0){n.setDate(1-o)}i=new s(n);a=(e.getMonth()+1)%12;do{h=i.getYear();r=new s(i,this.getPrimaryCalendarType());if(t&&h<1){r._bBeforeFirstYear=true;this._aVisibleDays.push(r)}else if(h>0&&h<1e4){this._aVisibleDays.push(r)}i.setDate(i.getDate()+1)}while(i.getMonth()!==a||i.getDay()!==l);return this._aVisibleDays};m.prototype._handleMousedown=function(e,a){var i=e.target.classList.contains("sapUiCalWeekNum"),r=!e.button,o=this._getSelectedDateFromEvent(e);if(!r||t.support.touch){return this}if(i){this._isWeekSelectionAllowed()&&this._handleWeekSelection(o,true);return this}else if(e.shiftKey&&this._isConsecutiveDaysSelectionAllowed()){this._handleConsecutiveDaysSelection(o);return this}var n=this._selectDay(a);if(n){this._bMousedownChange=true}if(this._bMouseMove){this._unbindMousemove(true);this._bMoveChange=false;this._oMoveSelectedDate=undefined}else if(n&&this.getIntervalSelection()&&this.$().is(":visible")){this._bindMousemove(true);this._oMoveSelectedDate=new s(a,this.getPrimaryCalendarType())}e.preventDefault();e.setMark("cancelAutoClose")};m.prototype._getSelectedDateFromEvent=function(e){var t=p(e.target),a=t.attr("data-sap-day")||t.parent().attr("data-sap-day"),i=this._oFormatYyyymmdd.parse(a);return i?s.fromLocalJSDate(i,this.getPrimaryCalendarType()):null};m.prototype._handleWeekSelection=function(e,t){var a=r.calculateWeekNumber(e.toUTCJSDate(),e.getYear(),this._getLocale(),this._getLocaleData()),i=this._getLastWeekDate(e),s=this.getSingleSelection(),o=this.getIntervalSelection();if(!s&&!o){this._handleWeekSelectionByMultipleDays(a,e,i)}else if(s&&o){this._handleWeekSelectionBySingleInterval(a,e,i)}t&&this._focusDate(e);return this};m.prototype._handleConsecutiveDaysSelection=function(e){var t=this.getSelectedDates(),a=t.length&&t[t.length-1].getStartDate(),i=a?s.fromLocalJSDate(a):e,r;r=this._areAllDaysBetweenSelected(i,e);this._toggleDaysBetween(i,e,!r);return this};m.prototype._isWeekSelectionAllowed=function(){var e=this.getSingleSelection(),t=this.getIntervalSelection(),a=this.getPrimaryCalendarType(),i=this.getFirstDayOfWeek()!==-1,r=!e&&!t,s=e&&t,o=s||r;return a===c.Gregorian&&!i&&o};m.prototype._isConsecutiveDaysSelectionAllowed=function(){var e=this.getSingleSelection(),t=this.getIntervalSelection();return!e&&!t};m.prototype._isMarkingUnfinishedRangeAllowed=function(){var e=this.getSelectedDates()[0],t=!!(e&&e.getStartDate()&&!e.getEndDate());return this.getIntervalSelection()&&t};m.prototype._handleWeekSelectionByMultipleDays=function(e,t,a){var i,r;if(this._areAllDaysBetweenSelected(t,a)){i=null}else{i=new o({startDate:t.toLocalJSDate(),endDate:a.toLocalJSDate()})}r=this.fireWeekNumberSelect({weekNumber:e,weekDays:i});if(r){this._toggleDaysBetween(t,a,!!i)}return this};m.prototype._handleWeekSelectionBySingleInterval=function(e,t,a){var i=new o({startDate:t.toLocalJSDate(),endDate:a.toLocalJSDate()}),r=this.getParent(),s=this,n;if(r&&r.getSelectedDates){s=r}if(this._isIntervalSelected(i)){i=null}n=this.fireWeekNumberSelect({weekNumber:e,weekDays:i});if(n){s.removeAllSelectedDates();s.addSelectedDate(i)}return this};m.prototype._isIntervalSelected=function(e){var t=this.getSelectedDates(),a=t.length&&t[0],i=a&&a.getEndDate();return a&&a.getStartDate().getTime()===e.getStartDate().getTime()&&i&&a.getEndDate().getTime()===e.getEndDate().getTime()};m.prototype._getLastWeekDate=function(e){return new s(e).setDate(e.getDate()+6)};m.prototype._toggleDaysBetween=function(e,t,a){var i=this._arrangeStartAndEndDates(e,t),r=new s(i.startDate),o;do{o=this._checkDateSelected(r);if(!o&&a||o&&!a){this._selectDay(r);M.call(this)}r.setDate(r.getDate()+1)}while(r.isSameOrBefore(i.endDate));return this};m.prototype._areAllDaysBetweenSelected=function(e,t){var a=this._arrangeStartAndEndDates(e,t),i=new s(a.startDate),r=true;do{if(!this._checkDateSelected(i)){r=false;break}i.setDate(i.getDate()+1)}while(i.isSameOrBefore(a.endDate));return r};m.prototype._arrangeStartAndEndDates=function(e,t){var a=e.isSameOrBefore(t);return{startDate:a?e:t,endDate:a?t:e}};m.prototype._selectDay=function(e,t){if(!this._checkDateEnabled(e)){return false}var a=this.getSelectedDates();var i;var r=this._oItemNavigation.getItemDomRefs();var n;var l;var h=0;var d=this.getParent();var g=this;var u;var f=this.getPrimaryCalendarType();if(d&&d.getSelectedDates){g=d}if(this.getSingleSelection()){if(a.length>0){i=a[0];u=i.getStartDate();if(u){u=s.fromLocalJSDate(u,f)}}else{i=new o;g.addAggregation("selectedDates",i,true)}if(this.getIntervalSelection()&&(!i.getEndDate()||t)&&u){var c;if(e.isBefore(u)){c=u;u=e;if(!t){i.setProperty("startDate",u.toLocalJSDate(),true);i.setProperty("endDate",c.toLocalJSDate(),true)}}else if(e.isSameOrAfter(u)){c=e;if(!t){i.setProperty("endDate",c.toLocalJSDate(),true)}}I.call(this,u,c)}else{I.call(this,e);i.setProperty("startDate",e.toLocalJSDate(),true);i.setProperty("endDate",undefined,true)}}else{if(this.getIntervalSelection()){throw new Error("Calender don't support multiple interval selection")}else{var y=this._checkDateSelected(e);if(y>0){for(h=0;h<a.length;h++){u=a[h].getStartDate();if(u&&e.isSame(s.fromLocalJSDate(u,f))){g.removeAggregation("selectedDates",h,true);break}}}else{i=new o({startDate:e.toLocalJSDate()});g.addAggregation("selectedDates",i,true)}l=this._oFormatYyyymmdd.format(e.toUTCJSDate(),true);for(h=0;h<r.length;h++){n=p(r[h]);if(n.attr("data-sap-day")===l){if(y>0){n.removeClass("sapUiCalItemSel");n.attr("aria-selected","false")}else{n.addClass("sapUiCalItemSel");n.attr("aria-selected","true")}}}}}return true};function D(){var e=this._oFormatYyyymmdd.format(this._getDate().toUTCJSDate(),true);var t=0;var a=this.$("days").get(0);var r=this.$("days").find(".sapUiCalItem");for(var s=0;s<r.length;s++){var o=p(r[s]);if(o.attr("data-sap-day")===e){t=s;break}}if(!this._oItemNavigation){this._oItemNavigation=new i;this._oItemNavigation.attachEvent(i.Events.AfterFocus,v,this);this._oItemNavigation.attachEvent(i.Events.FocusAgain,_,this);this._oItemNavigation.attachEvent(i.Events.BorderReached,this._handleBorderReached,this);this.addDelegate(this._oItemNavigation);if(this._iColumns>1){this._oItemNavigation.setHomeEndColumnMode(true,true)}this._oItemNavigation.setDisabledModifiers({sapnext:["alt"],sapprevious:["alt"],saphome:["alt"],sapend:["alt"]});this._oItemNavigation.setCycling(false);this._oItemNavigation.setColumns(this._iColumns,true)}this._oItemNavigation.setRootDomRef(a);this._oItemNavigation.setItemDomRefs(r);this._oItemNavigation.setFocusedIndex(t);this._oItemNavigation.setPageSize(r.length)}function v(e){var t=e.getParameter("index");var a=e.getParameter("event");if(!a){return}var i=this._getDate();var r=new s(i,this.getPrimaryCalendarType());var o=false;var n=true;var l=this._oItemNavigation.getItemDomRefs();var h=0;var d=p(l[t]);var g;if(d.hasClass("sapUiCalItemOtherMonth")){if(a.type==="saphomemodifiers"&&(a.metaKey||a.ctrlKey)){r.setDate(1);this._focusDate(r)}else if(a.type==="sapendmodifiers"&&(a.metaKey||a.ctrlKey)){for(h=l.length-1;h>0;h--){g=p(l[h]);if(!g.hasClass("sapUiCalItemOtherMonth")){r=s.fromLocalJSDate(this._oFormatYyyymmdd.parse(g.attr("data-sap-day")),this.getPrimaryCalendarType());break}}this._focusDate(r)}else{o=true;r=s.fromLocalJSDate(this._oFormatYyyymmdd.parse(d.attr("data-sap-day")),this.getPrimaryCalendarType());if(!r){r=new s(i)}this._focusDate(i);if(a.type==="mousedown"||this._sTouchstartYyyyMMdd&&a.type==="focusin"&&this._sTouchstartYyyyMMdd===d.attr("data-sap-day")){n=false;this.fireFocus({date:i.toLocalJSDate(),otherMonth:false,restoreOldDate:true})}if(a.originalEvent&&a.originalEvent.type==="touchstart"){this._sTouchstartYyyyMMdd=d.attr("data-sap-day")}else{this._sTouchstartYyyyMMdd=undefined}}}else{if(p(a.target).hasClass("sapUiCalWeekNum")){this._focusDate(r)}else{r=s.fromLocalJSDate(this._oFormatYyyymmdd.parse(d.attr("data-sap-day")),this.getPrimaryCalendarType());this._setDate(r)}this._sTouchstartYyyyMMdd=undefined}if(a.type==="mousedown"&&this.getIntervalSelection()){this._sLastTargetId=d.attr("id")}if(n){this.fireFocus({date:r.toLocalJSDate(),otherMonth:o})}if(a.type==="mousedown"){this._handleMousedown(a,r,t)}if(a.type==="sapnext"||a.type==="sapprevious"){var u=this.getSelectedDates()[0],f,c;if(!this._isMarkingUnfinishedRangeAllowed()){return}f=parseInt(this._oFormatYyyymmdd.format(u.getStartDate()));c=d.data("sapDay");this._markDatesBetweenStartAndHoveredDate(f,c)}}function _(e){var t=e.getParameter("index");var a=e.getParameter("event");if(!a){return}if(a.type==="mousedown"){var i=this._getDate();if(this.getIntervalSelection()){var r=this._oItemNavigation.getItemDomRefs();this._sLastTargetId=r[t].id}this._handleMousedown(a,i,t)}}function S(e,t){r._checkCalendarDate(e);var a=e.getYear();r._checkYearInValidRange(a);var i=true;if(!this.getDate()||!e.isSame(s.fromLocalJSDate(this.getDate(),e.getCalendarType()))){var o=new s(e);i=this.checkDateFocusable(e.toLocalJSDate());this.setProperty("date",e.toLocalJSDate(),true);this._oDate=o}if(this.getDomRef()){if(i){this._focusDate(this._oDate,true,t)}else{C.call(this,t)}}}m.prototype._focusDate=function(e,t,a){if(!t){this.setDate(e.toLocalJSDate())}var i=this._oFormatYyyymmdd.format(e.toUTCJSDate(),true);var r=this._oItemNavigation.getItemDomRefs();var s;for(var o=0;o<r.length;o++){s=p(r[o]);if(s.attr("data-sap-day")===i){if(document.activeElement!==r[o]){if(a){this._oItemNavigation.setFocusedIndex(o)}else{this._oItemNavigation.focusItem(o)}}break}}};function C(e){var t=this.getRenderer().getStartDate(this);var a=this.$("days");var i=this.$("weeks");var r;var s;var o=0;var n=0;if(this._sLastTargetId){r=this._oItemNavigation.getItemDomRefs();for(o=0;o<r.length;o++){s=p(r[o]);if(s.attr("id")===this._sLastTargetId){n=o;break}}}if(a.length>0){var l=sap.ui.getCore().createRenderManager();this.getRenderer().renderDays(l,this,t);l.flush(a[0]);if(i.length){this.getRenderer().renderWeekNumbers(l,this);l.flush(i[0])}l.destroy()}this._renderHeader();this.fireEvent("_renderMonth",{days:a.find(".sapUiCalItem").length});D.call(this);if(!e){this._oItemNavigation.focusItem(this._oItemNavigation.getFocusedIndex())}if(this._sLastTargetId){r=this._oItemNavigation.getItemDomRefs();if(n<=r.length-1){s=p(r[n]);this._sLastTargetId=s.attr("id")}}}function I(e,t){if(!Array.isArray(e)){e=[e]}var a=this._oItemNavigation.getItemDomRefs();var i;var o=0;var n=false;var l=false;if(!t){var h=e.map(function(e){return this._oFormatYyyymmdd.format(e.toUTCJSDate(),true)},this);for(o=0;o<a.length;o++){i=p(a[o]);n=false;l=false;if(h.indexOf(i.attr("data-sap-day"))>-1){i.addClass("sapUiCalItemSel");i.attr("aria-selected","true");n=true}else if(i.hasClass("sapUiCalItemSel")){i.removeClass("sapUiCalItemSel");i.attr("aria-selected","false")}if(i.hasClass("sapUiCalItemSelStart")){i.removeClass("sapUiCalItemSelStart")}else if(i.hasClass("sapUiCalItemSelBetween")){i.removeClass("sapUiCalItemSelBetween")}else if(i.hasClass("sapUiCalItemSelEnd")){i.removeClass("sapUiCalItemSelEnd")}b.call(this,i,n,l)}}else{var d;for(o=0;o<a.length;o++){i=p(a[o]);n=false;l=false;d=s.fromLocalJSDate(this._oFormatYyyymmdd.parse(i.attr("data-sap-day")),c.Gregorian);if(d.isSame(e[0])){i.addClass("sapUiCalItemSelStart");n=true;i.addClass("sapUiCalItemSel");i.attr("aria-selected","true");if(t&&d.isSame(t)){i.addClass("sapUiCalItemSelEnd");l=true}i.removeClass("sapUiCalItemSelBetween")}else if(t&&r._isBetween(d,e[0],t)){i.addClass("sapUiCalItemSel");i.attr("aria-selected","true");i.addClass("sapUiCalItemSelBetween");i.removeClass("sapUiCalItemSelStart");i.removeClass("sapUiCalItemSelEnd")}else if(t&&d.isSame(t)){i.addClass("sapUiCalItemSelEnd");l=true;i.addClass("sapUiCalItemSel");i.attr("aria-selected","true");i.removeClass("sapUiCalItemSelStart");i.removeClass("sapUiCalItemSelBetween")}else{if(i.hasClass("sapUiCalItemSel")){i.removeClass("sapUiCalItemSel");i.attr("aria-selected","false")}if(i.hasClass("sapUiCalItemSelStart")){i.removeClass("sapUiCalItemSelStart")}else if(i.hasClass("sapUiCalItemSelBetween")){i.removeClass("sapUiCalItemSelBetween")}else if(i.hasClass("sapUiCalItemSelEnd")){i.removeClass("sapUiCalItemSelEnd")}}b.call(this,i,n,l)}}}function b(e,t,a){if(!this.getIntervalSelection()){return}var i="";var r=[];var s=this.getId();var o=false;i=e.attr("aria-describedby");if(i){r=i.split(" ")}var n=-1;var l=-1;for(var h=0;h<r.length;h++){var d=r[h];if(d===s+"-Start"){n=h}if(d===s+"-End"){l=h}}if(n>=0&&!t){r.splice(n,1);o=true;if(l>n){l--}}if(l>=0&&!a){r.splice(l,1);o=true}if(n<0&&t){r.push(s+"-Start");o=true}if(l<0&&a){r.push(s+"-End");o=true}if(o){i=r.join(" ");e.attr("aria-describedby",i)}}function M(){if(this._bMouseMove){this._unbindMousemove(true)}this.fireSelect()}function T(){if(!this._bNamesLengthChecked){var e;var t=this.$().find(".sapUiCalWH");var a=this._isMonthNameLong(t);var i=0;if(a){this._bLongWeekDays=false;var r=this._getLocaleData();var s=this._getFirstWeekDay();var o=r.getDaysStandAlone("narrow",this.getPrimaryCalendarType());for(i=0;i<t.length;i++){e=t[i];p(e).text(o[(i+s)%7])}}else{this._bLongWeekDays=true}this._bNamesLengthChecked=true}}return m});