/*!
 * OpenUI5
 * (c) Copyright 2009-2019 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/unified/calendar/CalendarUtils","sap/ui/unified/calendar/CalendarDate","sap/ui/unified/CalendarLegend","sap/ui/unified/CalendarLegendRenderer","sap/ui/core/library","sap/ui/unified/library","sap/base/Log"],function(e,a,t,n,i,r,s){"use strict";var d=r.CalendarDayType;var l=i.CalendarType;var o={apiVersion:2};o.render=function(e,a){var t=this.getStartDate(a);var n=a.getTooltip_AsString();var i=sap.ui.getCore().getLibraryResourceBundle("sap.ui.unified");var r=a.getId();var s={value:r+"-Descr",append:true};var d=a.getWidth();e.openStart("div",a);this.getClass(e,a).forEach(function(a){e.class(a)});if(a._getSecondaryCalendarType()){e.class("sapUiCalMonthSecType")}this.addWrapperAdditionalStyles(e,a);if(n){e.attr("title",n)}if(a._getShowHeader()){s.value=s.value+" "+r+"-Head"}if(d){e.style("width",d)}e.accessibilityState(a,{role:"grid",multiselectable:!a.getSingleSelection()||a.getIntervalSelection(),labelledby:s});e.openEnd();e.openStart("span",r+"-Descr");e.style("display","none");e.openEnd();e.text(i.getText("CALENDAR_DIALOG"));e.close("span");if(a.getIntervalSelection()){e.openStart("span",r+"-Start");e.style("display","none");e.openEnd();e.text(i.getText("CALENDAR_START_DATE"));e.close("span");e.openStart("span",r+"-End");e.style("display","none");e.openEnd();e.text(i.getText("CALENDAR_END_DATE"));e.close("span")}this.renderMonth(e,a,t);e.close("div")};o.addWrapperAdditionalStyles=function(){};o.getStartDate=function(e){return e._getDate()};o.getClass=function(e,a){var t=["sapUiCalMonthView"],n=a.getPrimaryCalendarType(),i=a.getShowWeekNumbers();if(n===l.Islamic||!i){t.push("sapUiCalNoWeekNum")}return t};o.renderMonth=function(e,a,t){var n=a.getId();this.renderHeader(e,a,t);e.openStart("div",n+"-days");e.attr("role","row");e.class("sapUiCalItems");e.openEnd();this.renderDays(e,a,t);e.close("div")};o.renderHeader=function(e,a,t){var n=a._getLocaleData();var i=a._getFirstDayOfWeek();var r=a.getId();var s=sap.ui.getCore().getLibraryResourceBundle("sap.ui.unified");this.renderHeaderLine(e,a,n,t);e.openStart("div",r+"-CW");e.style("display","none");e.accessibilityState(null,{role:"columnheader"});e.openEnd();e.text(s.getText("CALENDAR_WEEK"));e.close("div");e.openStart("div");e.accessibilityState(null,{role:"row"});e.style("overflow","hidden");e.openEnd();this.renderDayNames(e,a,n,i,7,true,undefined);e.close("div")};o.renderHeaderLine=function(a,t,n,i){e._checkCalendarDate(i);if(t._getShowHeader()){var r=t.getId();var s=t.getPrimaryCalendarType();var d=n.getMonthsStandAlone("wide",s);a.openStart("div",r+"-Head");a.class("sapUiCalHeadText");a.openEnd();a.text(d[i.getMonth()]);a.close("div")}};o.renderDayNames=function(e,a,t,n,i,r,s){var d=a._getFirstDayOfWeek();var l=a.getId();var o="";var c=a.getPrimaryCalendarType();var p=[];if(a._bLongWeekDays||!a._bNamesLengthChecked){p=t.getDaysStandAlone("abbreviated",c)}else{p=t.getDaysStandAlone("narrow",c)}var y=t.getDaysStandAlone("wide",c);for(var g=0;g<i;g++){if(r){o=l+"-WH"+(g+d)%7}else{o=l+"-WH"+g}e.openStart("div",o);e.class("sapUiCalWH");if(g===0){e.class("sapUiCalFirstWDay")}if(s){e.style("width",s)}e.accessibilityState(null,{role:"columnheader",label:y[(g+n)%7]});e.openEnd();e.text(p[(g+n)%7]);e.close("div")}};o.renderDays=function(a,t,n){var i,r,s,d,o,c,p;e._checkCalendarDate(n);if(!n){n=t._getFocusedDate()}c=n.toUTCJSDate().getTime();if(!c&&c!==0){throw new Error("Date is invalid "+t)}d=this.getDayHelper(t,n);r=t._getVisibleDays(n,true);p=t.getShowWeekNumbers();i=t.getPrimaryCalendarType()!==l.Islamic&&p;s=r.length;for(o=0;o<s;o++){this.renderDay(a,t,r[o],d,true,i,-1)}if(s===28){this.renderDummyDay(a)}};o.renderDummyDay=function(e){e.openStart("div");e.class("sapUiCalItem");e.style("visibility","hidden");e.attr("tabindex","-1");e.openEnd();e.close("div")};o.getDayHelper=function(e,n){var i,r,d=e._getLocaleData(),l={sLocale:e._getLocale(),oLocaleData:d,iMonth:n.getMonth(),iYear:n.getYear(),iFirstDayOfWeek:e._getFirstDayOfWeek(),iWeekendStart:d.getWeekendStart(),iWeekendEnd:d.getWeekendEnd(),aNonWorkingDays:e._getNonWorkingDays(),sToday:d.getRelativeDay(0),oToday:a.fromLocalJSDate(new Date,e.getPrimaryCalendarType()),sId:e.getId(),oFormatLong:e._getFormatLong(),sSecondaryCalendarType:e._getSecondaryCalendarType(),oLegend:undefined};r=e.getLegend();if(r&&typeof r==="string"){i=sap.ui.getCore().byId(r);if(i){if(!(i instanceof t)){throw new Error(i+" is not an sap.ui.unified.CalendarLegend. "+e)}l.oLegend=i}else{s.warning("CalendarLegend "+r+" does not exist!",e)}}return l};o.renderDay=function(t,i,r,s,l,o,c,p,y){e._checkCalendarDate(r);var g=new a(r,s.sSecondaryCalendarType),f={role:i._getAriaRole(),selected:false,label:"",describedby:""},u=r._bBeforeFirstYear,D="";var S=i._oFormatYyyymmdd.format(r.toUTCJSDate(),true);var C=r.getDay();var b=i._checkDateSelected(r);var v=i._getDateTypes(r);var m=i._checkDateEnabled(r);var h=0;if(u){m=false}var W=0;if(o){W=e.calculateWeekNumber(r.toUTCJSDate(),s.iYear,s.sLocale,s.oLocaleData);f["describedby"]=s.sId+"-CW"+" "+s.sId+"-WNum-"+W}if(!y){var I="";if(c<0){I=s.sId+"-WH"+C}else{I=s.sId+"-WH"+c}f["describedby"]=f["describedby"]+" "+I}t.openStart("div",s.sId+"-"+S);t.class("sapUiCalItem");t.class("sapUiCalWDay"+C);if(p){t.style("width",p)}if(C===s.iFirstDayOfWeek){t.class("sapUiCalFirstWDay")}if(l&&s.iMonth!==r.getMonth()){t.class("sapUiCalItemOtherMonth");f["disabled"]=true}if(r.isSame(s.oToday)){t.class("sapUiCalItemNow");f["label"]=s.sToday+" "}if(b>0){t.class("sapUiCalItemSel");f["selected"]=true}else{f["selected"]=false}if(b===2){t.class("sapUiCalItemSelStart");f["describedby"]=f["describedby"]+" "+s.sId+"-Start"}else if(b===3){t.class("sapUiCalItemSelEnd");f["describedby"]=f["describedby"]+" "+s.sId+"-End"}else if(b===4){t.class("sapUiCalItemSelBetween")}else if(b===5){t.class("sapUiCalItemSelStart");t.class("sapUiCalItemSelEnd");f["describedby"]=f["describedby"]+" "+s.sId+"-Start";f["describedby"]=f["describedby"]+" "+s.sId+"-End"}v.forEach(function(e){if(e.type!==d.None){if(e.type===d.NonWorking){t.class("sapUiCalItemWeekEnd");return}t.class("sapUiCalItem"+e.type);D=e.type;if(e.tooltip){t.attr("title",e.tooltip)}}});if((i.getParent()&&i.getParent().getMetadata().getName()==="sap.ui.unified.CalendarOneMonthInterval"||i.getMetadata().getName()==="sap.ui.unified.calendar.OneMonthDatesRow")&&i.getStartDate()&&r.getMonth()!==i.getStartDate().getMonth()){t.class("sapUiCalItemOtherMonth")}if(!m){t.class("sapUiCalItemDsbl");f["disabled"]=true}if(s.aNonWorkingDays){for(h=0;h<s.aNonWorkingDays.length;h++){if(C===s.aNonWorkingDays[h]){t.class("sapUiCalItemWeekEnd");break}}}else if(C>=s.iWeekendStart&&C<=s.iWeekendEnd||s.iWeekendEnd<s.iWeekendStart&&(C>=s.iWeekendStart||C<=s.iWeekendEnd)){t.class("sapUiCalItemWeekEnd")}t.attr("tabindex","-1");t.attr("data-sap-day",S);if(y){f["label"]=f["label"]+s.aWeekDaysWide[C]+" "}f["label"]=f["label"]+s.oFormatLong.format(r.toUTCJSDate(),true);if(D!==""){n.addCalendarTypeAccInfo(f,D,s.oLegend)}if(s.sSecondaryCalendarType){f["label"]=f["label"]+" "+i._oFormatSecondaryLong.format(g.toUTCJSDate(),true)}t.accessibilityState(null,f);t.openEnd();if(v[0]){t.openStart("div");t.class("sapUiCalSpecialDate");t.openEnd();t.close("div")}t.openStart("span");t.class("sapUiCalItemText");t.openEnd();if(!u){t.text(r.getDate())}t.close("span");if(o&&C===s.iFirstDayOfWeek){t.openStart("span",s.sId+"-WNum-"+W);t.class("sapUiCalWeekNum");t.accessibilityState(null,{role:"rowheader",desribedby:s.sId+"-CW"});t.openEnd();t.text(W);t.close("span")}if(y){t.openStart("span");t.class("sapUiCalDayName");t.openEnd();t.text(s.aWeekDays[C]);t.close("span")}if(s.sSecondaryCalendarType){t.openStart("span");t.class("sapUiCalItemSecText");t.openEnd();t.text(g.getDate());t.close("span")}t.close("div")};return o},true);