/*!
 * OpenUI5
 * (c) Copyright 2009-2019 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["./Splitter","./SplitterRenderer","sap/base/Log","sap/ui/thirdparty/jquery","sap/ui/layout/SplitterLayoutData"],function(e,t,i,s,a){"use strict";var n=e.extend("sap.ui.layout.AssociativeSplitter",{metadata:{associations:{associatedContentAreas:{type:"sap.ui.core.Control",multiple:true,singularName:"associatedContentArea"}}},renderer:t});n.prototype.init=function(){e.prototype.init.call(this);this._keyListeners={increase:this._onKeyboardResize.bind(this,"inc",1),decrease:this._onKeyboardResize.bind(this,"dec",1),increaseMore:this._onKeyboardResize.bind(this,"incMore",2),decreaseMore:this._onKeyboardResize.bind(this,"decMore",2),max:this._onKeyboardResize.bind(this,"max",1),min:this._onKeyboardResize.bind(this,"min",1)};this._enableKeyboardListeners()};n.prototype._enableKeyboardListeners=function(){e.prototype._enableKeyboardListeners.call(this);this.onsaprightmodifiers=this._keyListeners.increase;this.onsapleftmodifiers=this._keyListeners.decrease;this.onsapupmodifiers=this._keyListeners.decrease;this.onsapdownmodifiers=this._keyListeners.increase;this.onsapright=this._keyListeners.increaseMore;this.onsapdown=this._keyListeners.increaseMore;this.onsapleft=this._keyListeners.decreaseMore;this.onsapup=this._keyListeners.decreaseMore;this.onsapend=this._keyListeners.max;this.onsaphome=this._keyListeners.min;this._keyboardEnabled=true};n.prototype.addAssociatedContentArea=function(e){this._needsInvalidation=true;r(e);return this.addAssociation("associatedContentAreas",e)};n.prototype.indexOfAssociatedContentArea=function(e){var t=this._getContentAreas();for(var i=0;i<t.length;i++){if(e==t[i]){return i}}return-1};n.prototype.insertAssociatedContentArea=function(e,t){var i=e.getId();this._needsInvalidation=true;r(e);var s=this.getAssociatedContentAreas();for(var a=0;a<s.length;a++){if(s[a]===i){s.splice(a,1)}}s.splice(t,0,i);this.setAssociation("associatedContentAreas",null);var n=this;s.forEach(function(e){n.addAssociation("associatedContentAreas",e)})};n.prototype.removeAssociatedContentArea=function(e){this.removeAssociation("associatedContentAreas",e)};n.prototype._getContentAreas=function(){var e=this.getAssociatedContentAreas()||[];var t=this.getContentAreas();var i=e.map(function(e){return sap.ui.getCore().byId(e)}).filter(function(e){return e});return t.concat(i)};n.prototype.onmousedown=function(e){if(this._ignoreMouse){return}if(s(e.target).hasClass("sapUiLoSplitterBarIcon")){e.target=e.target.parentElement}var t=this.getId();if(!e.target.id||e.target.id.indexOf(t+"-splitbar")!==0){return}this._ignoreTouch=true;this._onBarMoveStart(e);this._oLastDOMclicked=e.target};n.prototype.ondblclick=function(e){var t=this.getId(),i,s;if(!(e.target.contains(this._oLastDOMclicked)&&this._oLastDOMclicked.id.indexOf(t+"-splitbar")>-1)){return}i=parseInt(this._oLastDOMclicked.id.substr((t+"-splitbar-").length));s=this._getContentAreas()[i];s._currentPosition=this.getCalculatedSizes()[i];s._lastPosition=s._lastPosition||s._currentPosition;if(s._currentPosition===s._lastPosition){this._resizeContents(i,this.getCalculatedSizes()[i]*-1,true)}else{this._resizeContents(i,s._lastPosition,true);s._lastPosition=null}};n.prototype.ontouchstart=function(e){if(this._ignoreTouch){return}if(s(e.target).hasClass("sapUiLoSplitterBarIcon")){e.target=e.target.parentElement}var t=this.getId();if(!e.target.id||e.target.id.indexOf(t+"-splitbar")!==0){return}if(!e.changedTouches||!e.changedTouches[0]){return}this._ignoreMouse=true;this._onBarMoveStart(e.changedTouches[0],true)};n.prototype._onBarMoveStart=function(e,t){var i=this.getId();this.disableAutoResize(true);var a=e[this._moveCord];var n=parseInt(e.target.id.substr((i+"-splitbar-").length));var r=parseInt(e.target.parentElement.id.substr((i+"-splitbar-").length));var h=n+1?n:r;var u=s(e.target);if(u.attr("class")==="sapUiLoSplitterBarIcon"){u=u.parent()}var l=this.getCalculatedSizes();var c=this._bHorizontal?u.innerWidth():u.innerHeight();var d=this._getContentAreas();var p=d[h].getLayoutData();var g=d[h+1].getLayoutData();if(!p.getResizable()||!g.getResizable()){o(t);return}var v=0-c;for(var f=0;f<=h;++f){v+=l[f]+c}this._move={start:a,relStart:v,barNum:h,bar:s(e.target),c1Size:l[h],c1MinSize:p?parseInt(p.getMinSize()):0,c2Size:l[h+1],c2MinSize:g?parseInt(g.getMinSize()):0};if(t){document.addEventListener("touchend",this._boundBarMoveEnd);document.addEventListener("touchmove",this._boundBarMove)}else{document.addEventListener("mouseup",this._boundBarMoveEnd);document.addEventListener("mousemove",this._boundBarMove)}this._$SplitterOverlay.css("display","block");this._$SplitterOverlay.appendTo(this.getDomRef());this._$SplitterOverlayBar.css(this._sizeDirNot,"");this._move["bar"].css("visibility","hidden");this._onBarMove(e)};n.prototype._resizeContents=function(e,t,s){var a,n,r,o,h,u,l,c,d,p,g,v,f,_,y,z,m=parseFloat(this._move.c1Size).toFixed(5),S=parseFloat(this._move.c2Size).toFixed(5),b=parseFloat(m),L=parseFloat(S);if(isNaN(t)){i.warning("Splitter: Received invalid resizing values - resize aborted.");return}a=this._getContentAreas();n=a[e].getLayoutData();r=a[e+1].getLayoutData();o=n.getSize();h=r.getSize();u=this.$("content-"+e);l=this.$("content-"+(e+1));c=b+t;d=L-t;p=parseInt(n.getMinSize());g=parseInt(r.getMinSize());v=this.getOrientation();f=v==="Horizontal"?this.$().width():this.$().height();if(c<p){z=p-c;t+=z;c=p;d-=z}else if(d<g){z=g-d;t-=z;d=g;c-=z}if(s){if(o==="auto"&&h!=="auto"){y=this._pxToPercent(d,f);r.setSize(y)}else if(o!=="auto"&&h==="auto"){_=this._pxToPercent(c,f);n.setSize(_)}else{_=this._pxToPercent(c,f);y=this._pxToPercent(d,f);n.setSize(_);r.setSize(y)}}else{_=this._pxToPercent(c,f);y=this._pxToPercent(d,f);u.css(this._sizeType,_);l.css(this._sizeType,y)}};n.prototype._pxToPercent=function(e,t){return e*100/t+"%"};n.prototype._recalculateSizes=function(){var e,t,s,a,n,r,o;var h=[];var u=this._getContentAreas();var l=this.getOrientation();var c=[];var d=[];var p=[];for(e=0;e<u.length;++e){s=u[e].getLayoutData();t=s?s.getSize():"auto";h.push(t)}var g=this._calculateAvailableContentSize(h)+1;this._calculatedSizes=[];for(e=0;e<h.length;++e){t=h[e];if(t.indexOf("px")>-1){r=parseInt(t);g-=r;this._calculatedSizes[e]=r}else if(t.indexOf("%")>-1){p.push(e)}else if(t==="auto"){s=u[e].getLayoutData();if(s&&parseInt(s.getMinSize())!==0){d.push(e)}else{c.push(e)}}else{i.error("Illegal size value: "+h[e])}}var v=false;if(g<0){v=true;g=0}var f=g;g=l==="Horizontal"?this.$().width():this.$().height();var _=p.length;for(e=0;e<_;++e){n=p[e];if(_===1&&u.length===1){a=g}else{a=parseFloat(h[n])/100*g;o=parseInt(u[n].getLayoutData().getMinSize());if(a<o){a=o}}this._calculatedSizes[n]=a;f-=a}g=f;if(g<0){v=true;g=0}a=Math.floor(g/(d.length+c.length),0);var y=d.length;for(e=0;e<y;++e){n=d[e];o=parseInt(u[n].getLayoutData().getMinSize());if(o>a){this._calculatedSizes[n]=o;g-=o}else{this._calculatedSizes[n]=a;g-=a}}if(g<0){v=true;g=0}f=g;var z=c.length;a=Math.floor(g/z,0);for(e=0;e<z;++e){n=c[e];this._calculatedSizes[n]=a;f-=a}if(v){i.info("[Splitter] The set sizes and minimal sizes of the splitter contents are bigger "+"than the available space in the UI.")}this._calculatedSizes=this._calculatedSizes};n.prototype._ensureAllSplittersCollapsed=function(e){var t=this._getContentAreas();var i=false;for(var s=0;s<t.length;s++){var n=t[s].getLayoutData().getSize().slice(0,-2);if(n==="0"||n==="au"){i=true;continue}else if(s===t.length-1&&i){this._getContentAreas()[e+1].setLayoutData(new a({size:"100%"}))}}};function r(e){var t=e.getLayoutData();if(t&&(!t.getResizable||!t.getSize||!t.getMinSize)){i.warning('Content "'+e.getId()+'" for the Splitter contained wrong LayoutData. '+"The LayoutData has been replaced with default values.");t=null}if(!t){e.setLayoutData(new a)}}function o(e){var t=function(e){e.preventDefault()};var i=null;i=function(){document.removeEventListener("touchend",i);document.removeEventListener("touchmove",t);document.removeEventListener("mouseup",i);document.removeEventListener("mousemove",t)};if(e){this._ignoreMouse=true;document.addEventListener("touchend",i);document.addEventListener("touchmove",t)}else{document.addEventListener("mouseup",i);document.addEventListener("mousemove",t)}}return n});