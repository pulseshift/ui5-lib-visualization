/*!
 * OpenUI5
 * (c) Copyright 2009-2019 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/core/Element","sap/ui/core/Control","sap/ui/base/ManagedObjectObserver","sap/ui/layout/library","sap/base/Log"],function(e,i,t,s,a){"use strict";var r=e.extend("sap.ui.layout.form.FormElement",{metadata:{library:"sap.ui.layout",properties:{visible:{type:"boolean",group:"Misc",defaultValue:true}},defaultAggregation:"fields",aggregations:{label:{type:"sap.ui.core.Label",altTypes:["string"],multiple:false},_label:{type:"sap.ui.core.Label",multiple:false,visibility:"hidden"},fields:{type:"sap.ui.core.Control",multiple:true,singularName:"field"}},designtime:"sap/ui/layout/designtime/form/FormElement.designtime"}});r.prototype.init=function(){this._oFieldDelegate={oElement:this,onAfterRendering:f};this._oObserver=new t(this._observeChanges.bind(this));this._oObserver.observe(this,{aggregations:["fields"]})};r.prototype.exit=function(){if(this._oLabel){delete this._oLabel}this._oFieldDelegate=undefined;this._oObserver.disconnect();this._oObserver=undefined};r.prototype.setLabel=function(e){if(!this._oLabel){var i=this.getLabel();if(i){if(i.setAlternativeLabelFor){i.setAlternativeLabelFor(null)}if(i.isRequired){i.isRequired=i._sapuiIsRequired;i._sapuiIsRequired=undefined;i.disableRequiredChangeCheck(false)}if(i.isDisplayOnly){i.isDisplayOnly=i._sapuiIsDisplayOnly;i._sapuiIsDisplayOnly=undefined}if(i.isWrapping){i.isWrapping=i._sapuiIsWrapping;i._sapuiIsWrapping=undefined}}}this.setAggregation("label",e);var t=e;if(typeof t==="string"){if(!this._oLabel){this._oLabel=s.form.FormHelper.createLabel(t,this.getId()+"-label");this.setAggregation("_label",this._oLabel,true);this._oLabel.disableRequiredChangeCheck(true);if(this._oLabel.isRequired){this._oLabel.isRequired=o}if(this._oLabel.isDisplayOnly){this._oLabel.isDisplayOnly=u}if(this._oLabel.setWrapping){this._oLabel.setWrapping(true)}}else{this._oLabel.setText(t)}}else{if(this._oLabel){this._oLabel.destroy();delete this._oLabel}if(t&&t.isRequired){t._sapuiIsRequired=t.isRequired;t.isRequired=o;t.disableRequiredChangeCheck(true)}if(t&&t.isDisplayOnly){t._sapuiIsDisplayOnly=t.isDisplayOnly;t.isDisplayOnly=u}if(t&&t.isWrapping){t._sapuiIsWrapping=t.isWrapping;t.isWrapping=p}}g.call(this);return this};r.prototype.destroyLabel=function(){this.destroyAggregation("label");if(this._oLabel){this._oLabel.destroy();delete this._oLabel}return this};r.prototype.getLabelControl=function(){if(this._oLabel){return this._oLabel}else{return this.getLabel()}};r.prototype.updateFields=function(){var e=this.getFields();var i;var t=0;for(t=0;t<e.length;t++){i=e[t];d.call(this,i)}this.updateAggregation("fields");e=this.getFields();for(t=0;t<e.length;t++){i=e[t];h.call(this,i)}g.call(this);return this};r.prototype.enhanceAccessibilityState=function(e,i){var t=this.getLabelControl();if(t&&t!=e){var s=i["labelledby"];if(!s){s=t.getId()}else{var a=s.split(" ");if(a.indexOf(t.getId())<0){a.splice(0,0,t.getId());s=a.join(" ")}}i["labelledby"]=s}return i};r.prototype.onLayoutDataChange=function(e){var i=this.getParent();if(i&&i.onLayoutDataChange){i.onLayoutDataChange(e)}};r.prototype.getRenderedDomRef=function(){var e=this;var i=this.getParent();if(i&&i.getElementRenderedDomRef){return i.getElementRenderedDomRef(e)}else{return null}};r.prototype.invalidateLabel=function(){var e=this.getLabelControl();if(e){e.invalidate()}};r.prototype.isVisible=function(){return this.getVisible()};r.prototype._observeChanges=function(e){if(e.object==this){if(e.name=="fields"){l.call(this,e.child,e.mutation)}}else{n.call(this,e)}};function l(e,i){if(i=="insert"){if(!e.isA("sap.ui.core.IFormContent")){a.warning(e+" is not valid Form content",this)}h.call(this,e)}else{d.call(this,e)}g.call(this)}function n(e){if(e.name=="required"){this.invalidateLabel()}}function o(){if(this.getRequired&&this.getRequired()){return true}var e=this.getParent();var i=e.getFields();for(var t=0;t<i.length;t++){var s=i[t];if(s.getRequired&&s.getRequired()===true&&(!s.getEditable||s.getEditable())){return true}}return false}function u(){if(this.getDisplayOnly){if(!this.isPropertyInitial("displayOnly")){return this.getDisplayOnly()}var e=this.getParent();var i=e.getParent();if(i){var t=i.getParent();if(t){return!t.getEditable()}}}return false}function p(){if(this.getWrapping&&!this.isPropertyInitial("wrapping")){return this.getWrapping()}return true}function g(){var e=this.getFields();var t=e.length>0?e[0]:null;var s=this._oLabel;if(s){s.setLabelFor(t)}else{s=this.getLabel();if(s instanceof i){s.setAlternativeLabelFor(t)}}}function h(e){e.addDelegate(this._oFieldDelegate);if(!this._bNoObserverChange&&e.getMetadata().getProperty("required")){this._oObserver.observe(e,{properties:["required"]})}}function d(e){e.removeDelegate(this._oFieldDelegate);if(!this._bNoObserverChange){this._oObserver.unobserve(e)}}function f(e){var i=this.oElement.getParent();if(i&&i.contentOnAfterRendering){i.contentOnAfterRendering(this.oElement,e.srcControl)}}return r});