/*!
 * OpenUI5
 * (c) Copyright 2009-2019 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/layout/cssgrid/GridLayoutBase","sap/ui/layout/cssgrid/GridSettings","sap/ui/layout/cssgrid/GridBoxLayoutStyleHelper","sap/ui/Device","sap/ui/thirdparty/jquery"],function(t,i,e,s,a){"use strict";var o=/^([X][L](?:[1-9]|1[0-2]))? ?([L](?:[1-9]|1[0-2]))? ?([M](?:[1-9]|1[0-2]))? ?([S](?:[1-9]|1[0-2]))?$/i;var r=o.exec("XL7 L6 M4 S2");var n={Phone:"sapUiLayoutCSSGridBoxLayoutSizeS",Tablet:"sapUiLayoutCSSGridBoxLayoutSizeM",Desktop:"sapUiLayoutCSSGridBoxLayoutSizeL",LargeDesktop:"sapUiLayoutCSSGridBoxLayoutSizeXL"};var p={XL:"sapUiLayoutCSSGridBoxLayoutSpanXL7",L:"sapUiLayoutCSSGridBoxLayoutSpanL6",M:"sapUiLayoutCSSGridBoxLayoutSpanM4",S:"sapUiLayoutCSSGridBoxLayoutSpanS2"};var l=t.extend("sap.ui.layout.cssgrid.GridBoxLayout",{metadata:{library:"sap.ui.layout",properties:{boxMinWidth:{type:"sap.ui.core.CSSSize",defaultValue:""},boxWidth:{type:"sap.ui.core.CSSSize",defaultValue:""},boxesPerRowConfig:{type:"sap.ui.layout.BoxesPerRowConfig",group:"Behavior",defaultValue:"XL7 L6 M4 S2"}}}});l.prototype.getActiveGridSettings=function(){return new i({gridTemplateColumns:this._getTemplateColumns(),gridGap:"0.5rem 0.5rem"})};l.prototype._applySingleGridLayout=function(i){if(this.isGridSupportedByBrowser()){t.prototype._applySingleGridLayout.call(this,i)}};l.prototype.renderSingleGridLayout=function(t){this._addSpanClasses(t);if(this.isGridSupportedByBrowser()){t.addClass("sapUiLayoutCSSGridBoxLayoutContainer")}else{t.addClass("sapUiLayoutCSSGridBoxLayoutPolyfill")}};l.prototype.onGridAfterRendering=function(i){t.prototype.onGridAfterRendering.call(this,i);if(!this._hasBoxWidth()){this._applySizeClass(i)}if(!this.isGridSupportedByBrowser()){this._calcWidth(i);this._flattenHeight(i);if(!this._hasBoxWidth()){this._applyClassForLastItem(i)}}if(i.isA("sap.f.GridList")&&i.getGrowing()){var e=i._oGrowingDelegate._onAfterPageLoaded;i._oGrowingDelegate._onAfterPageLoaded=function(){e.call(i._oGrowingDelegate);if(!this.isGridSupportedByBrowser()){this._flattenHeight(i);this._calcWidth(i);this._loopOverGridItems(i,function(t){if(!t.classList.contains("sapMGHLI")&&!t.classList.contains("sapUiBlockLayerTabbable")){t.classList.add("sapUiLayoutCSSGridItem")}});if(!this._hasBoxWidth()){this._applyClassForLastItem(i)}}else if(i.isA("sap.f.GridList")&&i.isGrouped()){this._flattenHeight(i)}}.bind(this)}if(!this.isGridSupportedByBrowser()&&!this._dndPolyfillAttached){i.attachEvent("_gridPolyfillAfterDragOver",i,this._polyfillAfterDragOver,this);i.attachEvent("_gridPolyfillAfterDragEnd",i,this._polyfillAfterDragEnd,this);this._dndPolyfillAttached=true}};l.prototype._setGridLayout=function(i,e){var s=sap.ui.getCore().byId(i.parentElement.id);t.prototype._setGridLayout.call(this,i,e);if(this.isGridSupportedByBrowser()&&(s&&s.isA("sap.f.GridList")&&s.isGrouped())){this._flattenHeight(s)}};l.prototype.isResponsive=function(){return true};l.prototype.onGridResize=function(t){if(!this.isGridSupportedByBrowser()||t.control&&t.control.isA("sap.f.GridList")&&t.control.isGrouped()){this._flattenHeight(t.control)}if(!this.isGridSupportedByBrowser()&&!this._hasBoxWidth()){this._applyClassForLastItem(t.control)}if(t){if(!this._hasBoxWidth()){this._applySizeClass(t.control)}}};l.prototype._calcWidth=function(t){var i;if(this._hasBoxWidth()){i=this.getBoxWidth()||this.getBoxMinWidth()}this._loopOverGridItems(t,function(t){if(!t.classList.contains("sapMGHLI")){t.style.width=i}})};l.prototype._flattenHeight=function(t){var i=0;t.$().removeClass("sapUiLayoutCSSGridBoxLayoutFlattenHeight");this._loopOverGridItems(t,function(t){i=Math.max(a(t).outerHeight(),i)});e.setItemHeight(t.getId(),i);t.$().addClass("sapUiLayoutCSSGridBoxLayoutFlattenHeight")};l.prototype._applyClassForLastItem=function(t){var i=0;var e=this.getBoxesPerRowConfig().split(" ");var a=s.media.getCurrentRange("StdExt",t.$().width());var o=n[a.name].substring("sapUiLayoutCSSGridBoxLayoutSize".length);var r;e.forEach(function(t){if(t.indexOf(o)!=-1){r=parseInt(t.substring(o.length))}});this._loopOverGridItems(t,function(t){if(t.classList.contains("sapUiLayoutCSSGridItem")){i++;if(i==r){t.classList.add("sapUiLayoutCSSGridItemLastOnRow");i=0}else{t.classList.remove("sapUiLayoutCSSGridItemLastOnRow")}}else if(t.classList.contains("sapMGHLI")){i=0}})};l.prototype._applySizeClass=function(t){var i=s.media.getCurrentRange("StdExt",t.$().width()),e=n[i.name];t.getGridDomRefs().forEach(function(t){if(!t.classList.contains(e)){Object.keys(n).map(function(i){t.classList.remove(n[i])});t.classList.add(e)}})};l.prototype._getTemplateColumns=function(){var t="";if(this.getBoxWidth()){t="repeat(auto-fit, "+this.getBoxWidth()+")"}else if(this.getBoxMinWidth()){t="repeat(auto-fit, minmax("+this.getBoxMinWidth()+", 1fr))"}return t};l.prototype._hasBoxWidth=function(){if(this.getBoxWidth()||this.getBoxMinWidth()){return true}else{return false}};l.prototype._addSpanClasses=function(t){var i,e,s=this.getBoxesPerRowConfig(),a,n,l,d;if(this._hasBoxWidth()){return}if(!s||!s.length===0){i=r}else{i=o.exec(s)}if(i){for(var u=1;u<i.length;u++){e=i[u];if(e){e=e.toUpperCase();switch(e.substr(0,1)){case"X":if(e.substr(1,1)==="L"){a=this._getBoxesPerRowClass(e,2)}break;case"L":n=this._getBoxesPerRowClass(e,1);break;case"M":l=this._getBoxesPerRowClass(e,1);break;case"S":d=this._getBoxesPerRowClass(e,1);break;default:break}}}}a=a||p.XL;n=n||p.L;l=l||p.M;d=d||p.S;t.addClass([a,n,l,d].join(" "))};l.prototype._getBoxesPerRowClass=function(t,i){var e=parseInt(t.substr(i,t.length));if(e&&e>0&&e<13){return"sapUiLayoutCSSGridBoxLayoutSpan"+t}};l.prototype._loopOverGridItems=function(t,i){t.getGridDomRefs().forEach(function(t){if(t&&t.children){for(var e=0;e<t.children.length;e++){if(t.children[e].style.display!=="none"&&t.children[e].style.visibility!=="hidden"){i(t.children[e])}}}})};l.prototype._polyfillAfterDragOver=function(t,i){t.getParameter("indicator").addClass("sapUiLayoutCSSGridItem");this._calcWidth(i);this._flattenHeight(i);this._applyClassForLastItem(i)};l.prototype._polyfillAfterDragEnd=function(t,i){t.getParameter("indicator").removeClass("sapUiLayoutCSSGridItem");this._applyClassForLastItem(i)};return l});