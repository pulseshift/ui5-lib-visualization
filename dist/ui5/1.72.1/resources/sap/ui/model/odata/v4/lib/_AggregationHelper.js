/*!
 * OpenUI5
 * (c) Copyright 2009-2019 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/thirdparty/jquery"],function(e){"use strict";var r={grandTotal:"boolean",max:"boolean",min:"boolean",name:"string",subtotals:"boolean",with:"string"},t={aggregate:"object",group:"object",groupLevels:"array"},n;function o(e,r,t){var n;function o(e){if(t){e+=" at property: "+t}throw new Error(e)}function i(e){return Array.isArray(e)?"array":typeof e}for(n in e){if(!(r&&n in r)){o("Unsupported '"+n+"'")}else if(i(e[n])!==r[n]){o("Not a "+r[n]+" value for '"+n+"'")}}}function i(e,r){var t;for(t in e){o(e[t],r,t)}}n={buildApply:function(n,a,u,g){var f,s="",l=[],p,c,d;function h(e){var r=n.aggregate[e],t=r.name||e,o=e,i=r.with;if(i){if((i==="average"||i==="countdistinct")&&(r.grandTotal||r.subtotals)){throw new Error("Cannot aggregate totals with '"+i+"'")}t+=" with "+i+" as "+e}else if(r.name){t+=" as "+e}if(!g){if(r.min){$(e,"min")}if(r.max){$(e,"max")}}if(r.grandTotal){c=true;if(!a.$skip){if(i){o+=" with "+i+" as UI5grand__"+e}l.push(o)}}return t}function y(e){return n.groupLevels.indexOf(e)<0}function $(e,r){var t="UI5"+r+"__"+e;l.push(e+" with "+r+" as "+t);if(u){u[t]={measure:e,method:r}}}function v(){var e="";if(a.$skip){e="skip("+a.$skip+")"}delete a.$skip;if(a.$top<Infinity){if(e){e+="/"}e+="top("+a.$top+")"}delete a.$top;return e}a=e.extend({},a);o(n,t);n.groupLevels=n.groupLevels||[];if(n.groupLevels.length>1){throw new Error("More than one group level: "+n.groupLevels)}n.aggregate=n.aggregate||{};i(n.aggregate,r);f=Object.keys(n.aggregate).sort().map(h);if(c&&n.groupLevels.length){throw new Error("Cannot combine visual grouping with grand total")}if(f.length){s="aggregate("+f.join(",")+")"}n.group=n.group||{};i(n.group);p=n.groupLevels.concat(Object.keys(n.group).sort().filter(y));if(p.length){s="groupby(("+p.join(",")+(s?"),"+s+")":"))")}if(g){delete a.$count}else if(a.$count){l.push("$count as UI5__count");delete a.$count}if(a.$filter){s+="/filter("+a.$filter+")";delete a.$filter}if(a.$orderby){s+="/orderby("+a.$orderby+")";delete a.$orderby}if(c){if(a.$skip){a.$skip-=1}else{a.$top-=1}}d=v();if(l.length){s+="/concat(aggregate("+l.join(",")+"),"+(d||"identity")+")"}else if(d){s+="/"+d}a.$apply=s;return a},hasGrandTotal:function(e){return!!e&&Object.keys(e).some(function(r){return e[r].grandTotal})},hasMinOrMax:function(e){return!!e&&Object.keys(e).some(function(r){var t=e[r];return t.min||t.max})}};return n},false);