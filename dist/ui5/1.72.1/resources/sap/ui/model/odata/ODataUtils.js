/*!
 * OpenUI5
 * (c) Copyright 2009-2019 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/model/Sorter","sap/ui/model/FilterProcessor","sap/ui/core/format/DateFormat","sap/base/Log","sap/base/assert","sap/ui/thirdparty/jquery","sap/base/security/encodeURL","sap/ui/core/CalendarType"],function(e,t,r,n,a,i,s,o){"use strict";var u=/^([-+]?)0*(\d+)(\.\d+|)$/,f=/\.$/,c=/0+$/;var l=function(){};l.createSortParams=function(t){var r;if(!t||t.length==0){return}r="$orderby=";for(var a=0;a<t.length;a++){var i=t[a];if(i instanceof e){r+=i.sPath;r+=i.bDescending?"%20desc":"%20asc";r+=","}else{n.error("Trying to use "+i+" as a Sorter, but it is a "+typeof i)}}r=r.slice(0,-1);return r};function m(e){if(e&&typeof e.convert==="function"){e=e.convert()}return e}l.createFilterParams=function(e,r,n){var a;if(Array.isArray(e)){e=e.map(m);a=t.groupFilters(e)}else{a=m(e)}if(!a){return}return"$filter="+this._createFilterParams(a,r,n)};l._createFilterParams=function(e,r,n){var a=this,i=Array.isArray(e)?t.groupFilters(e):e;function s(e,t){e=m(e);if(e.aFilters){return o(e,t)}return a._createFilterSegment(e.sPath,r,n,e.sOperator,e.oValue1,e.oValue2,e.bCaseSensitive)}function o(e,t){var r=e.aFilters,n=!!e.bAnd,a="";if(r.length===0){return n?"true":"false"}if(r.length===1){if(r[0]._bMultiFilter){return s(r[0])}return s(r[0],true)}if(!t){a+="("}a+=s(r[0]);for(var i=1;i<r.length;i++){a+=n?"%20and%20":"%20or%20";a+=s(r[i])}if(!t){a+=")"}return a}if(!i){return}return s(i,true)};l._createUrlParamsArray=function(e){var t,r=i.type(e),n;if(r==="array"){return e}t=[];if(r==="object"){n=this._encodeURLParameters(e);if(n){t.push(n)}}else if(r==="string"){if(e){t.push(e)}}return t};l._encodeURLParameters=function(e){if(!e){return""}var t=[];i.each(e,function(e,r){if(i.type(r)==="string"){r=encodeURIComponent(r)}e=e.startsWith("$")?e:encodeURIComponent(e);t.push(e+"="+r)});return t.join("&")};l.setOrigin=function(e,t){var r,a,i;if(!e||!t||e.indexOf(";mo")>0){return e}if(typeof t=="string"){r=t}else{r=t.alias;if(!r){a=t.system;i=t.client;if(!a||!i){n.warning("ODataUtils.setOrigin: No Client or System ID given for Origin");return e}r="sid("+a+"."+i+")"}}var s=e.split("?");var o=s[0];var u=s[1]?"?"+s[1]:"";var f="";if(o[o.length-1]==="/"){o=o.substring(0,o.length-1);f="/"}var c=/(\/[^\/]+)$/g;var l=/(;o=[^\/;]+)/g;var m=o.match(c)[0];var d=m.match(l);var g=d?d[0]:null;if(g){if(t.force){var p=m.replace(g,";o="+r);o=o.replace(m,p);return o+f+u}return e}o=o+";o="+r+f;return o+u};l.setAnnotationOrigin=function(e,t){var r;var a=e.indexOf("/Annotations(");var i=t&&t.preOriginBaseUri?t.preOriginBaseUri.indexOf(".xsodata"):-1;if(a===-1){a=e.indexOf("/Annotations%28")}if(a>=0){if(e.indexOf("/$value",a)===-1){n.warning("ODataUtils.setAnnotationOrigin: Annotation url is missing $value segment.");r=e}else{var s=e.substring(0,a);var o=e.substring(a,e.length);var u=l.setOrigin(s,t);r=u+o}}else if(i>=0){r=l.setOrigin(e,t)}else{r=e.replace(t.preOriginBaseUri,t.postOriginBaseUri)}return r};l._resolveMultiFilter=function(e,t,r){var n=this,a=e.aFilters,s="";if(a){s+="(";i.each(a,function(i,o){if(o._bMultiFilter){s+=n._resolveMultiFilter(o,t,r)}else if(o.sPath){s+=n._createFilterSegment(o.sPath,t,r,o.sOperator,o.oValue1,o.oValue2,"",o.bCaseSensitive)}if(i<a.length-1){if(e.bAnd){s+="%20and%20"}else{s+="%20or%20"}}});s+=")"}return s};l._createFilterSegment=function(e,t,r,i,o,u,f){var c,l;if(f===undefined){f=true}if(r){c=t._getPropertyMetadata(r,e);l=c&&c.type;a(c,"PropertyType for property "+e+" of EntityType "+r.name+" not found!")}if(l){o=this.formatValue(o,l,f);u=u!=null?this.formatValue(u,l,f):null}else{a(null,"Type for filter property could not be found in metadata!")}if(o){o=s(String(o))}if(u){u=s(String(u))}if(!f&&l==="Edm.String"){e="toupper("+e+")"}switch(i){case"EQ":case"NE":case"GT":case"GE":case"LT":case"LE":return e+"%20"+i.toLowerCase()+"%20"+o;case"BT":return"("+e+"%20ge%20"+o+"%20and%20"+e+"%20le%20"+u+")";case"NB":return"not%20("+e+"%20ge%20"+o+"%20and%20"+e+"%20le%20"+u+")";case"Contains":return"substringof("+o+","+e+")";case"NotContains":return"not%20substringof("+o+","+e+")";case"StartsWith":return"startswith("+e+","+o+")";case"NotStartsWith":return"not%20startswith("+e+","+o+")";case"EndsWith":return"endswith("+e+","+o+")";case"NotEndsWith":return"not%20endswith("+e+","+o+")";default:n.error("ODataUtils :: Unknown filter operator "+i);return"true"}};l.formatValue=function(e,t,n){if(n===undefined){n=true}if(!this.oDateTimeFormat){this.oDateTimeFormat=r.getDateInstance({pattern:"'datetime'''yyyy-MM-dd'T'HH:mm:ss''",calendarType:o.Gregorian});this.oDateTimeFormatMs=r.getDateInstance({pattern:"'datetime'''yyyy-MM-dd'T'HH:mm:ss.SSS''",calendarType:o.Gregorian});this.oDateTimeOffsetFormat=r.getDateInstance({pattern:"'datetimeoffset'''yyyy-MM-dd'T'HH:mm:ss'Z'''",calendarType:o.Gregorian});this.oTimeFormat=r.getTimeInstance({pattern:"'time''PT'HH'H'mm'M'ss'S'''",calendarType:o.Gregorian})}if(e===null||e===undefined){return"null"}var a;switch(t){case"Edm.String":e=n?e:e.toUpperCase();a="'"+String(e).replace(/'/g,"''")+"'";break;case"Edm.Time":if(typeof e==="object"){a=this.oTimeFormat.format(new Date(e.ms),true)}else{a="time'"+e+"'"}break;case"Edm.DateTime":var i=new Date(e);if(i.getMilliseconds()>0){a=this.oDateTimeFormatMs.format(i,true)}else{a=this.oDateTimeFormat.format(i,true)}break;case"Edm.DateTimeOffset":var i=new Date(e);a=this.oDateTimeOffsetFormat.format(i,true);break;case"Edm.Guid":a="guid'"+e+"'";break;case"Edm.Decimal":a=e+"m";break;case"Edm.Int64":a=e+"l";break;case"Edm.Double":a=e+"d";break;case"Edm.Float":case"Edm.Single":a=e+"f";break;case"Edm.Binary":a="binary'"+e+"'";break;default:a=String(e);break}return a};function d(e,t){if(e===t){return 0}if(e===null||t===null||e===undefined||t===undefined){return NaN}return e>t?1:-1}function g(e){var t;if(typeof e!=="string"){return undefined}t=u.exec(e);if(!t){return undefined}return{sign:t[1]==="-"?-1:1,integerLength:t[2].length,abs:t[2]+t[3].replace(c,"").replace(f,"")}}function p(e,t){var r,n,a;if(e===t){return 0}r=g(e);n=g(t);if(!r||!n){return NaN}if(r.sign!==n.sign){return r.sign>n.sign?1:-1}a=d(r.integerLength,n.integerLength)||d(r.abs,n.abs);return r.sign*a}var h=/^PT(\d\d)H(\d\d)M(\d\d)S$/;function y(e){if(typeof e==="string"&&h.test(e)){e=parseInt(RegExp.$1)*36e5+parseInt(RegExp.$2)*6e4+parseInt(RegExp.$3)*1e3}if(e instanceof Date){return e.getTime()}if(e&&e.__edmType==="Edm.Time"){return e.ms}return e}l.compare=function(e,t,r){return r?p(e,t):d(y(e),y(t))};l.getComparator=function(e){switch(e){case"Edm.Date":case"Edm.DateTime":case"Edm.DateTimeOffset":case"Edm.Time":return l.compare;case"Edm.Decimal":case"Edm.Int64":return p;default:return d}};var v=/([(=,])('.*?')([,)])/g,b=/[MLDF](?=[,)](?:[^']*'[^']*')*[^']*$)/g,T=/([(=,])(X')/g,D=function(e,t,r,n){return t+encodeURIComponent(decodeURIComponent(r))+n},E=function(e){return e.toLowerCase()},F=function(e,t){return t+"binary'"};l._normalizeKey=function(e){return e.replace(v,D).replace(b,E).replace(T,F)};return l},true);