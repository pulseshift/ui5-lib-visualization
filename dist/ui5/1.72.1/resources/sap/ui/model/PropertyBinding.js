/*!
 * OpenUI5
 * (c) Copyright 2009-2019 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["./Binding","./SimpleType","./DataState","sap/ui/base/SyncPromise","sap/base/Log","sap/base/assert"],function(t,e,n,a,o,r){"use strict";var i=t.extend("sap.ui.model.PropertyBinding",{constructor:function(e,n,a,o){t.apply(this,arguments)},metadata:{abstract:true,publicMethods:["getValue","setValue","setType","getType","setFormatter","getFormatter","getExternalValue","setExternalValue","getBindingMode"]}});i.prototype._getBoundValue=function(t){var e=this.getValue();return t(e)};i.prototype._setBoundValue=function(t,e){var n=this.getDataState(),o=this;if(this.oType){return a.resolve(t).then(function(t){return e(t)}).then(function(t){return a.all([t,o.oType.validateValue(t)])}).then(function(t){return t[0]}).then(function(t){n.setInvalidValue(undefined);o.setValue(t)}).catch(function(e){n.setInvalidValue(t);o.checkDataState();throw e}).unwrap()}else{n.setInvalidValue(undefined);o.setValue(t)}};i.prototype._rawToExternal=function(t){if(this.oType){t=this.oType.formatValue(t,this.sInternalType)}if(this.fnFormatter){t=this.fnFormatter(t)}return t};i.prototype._externalToRaw=function(t){if(this.oType){t=this.oType.parseValue(t,this.sInternalType)}return t};i.prototype._rawToInternal=function(t){var e;if(this.oType&&t!==null&&t!==undefined){e=this.oType.getModelFormat();r(e&&typeof e.parse==="function","The input format of "+this.oType+" should be an object with the 'parse' method");t=e.parse(t)}return t};i.prototype._internalToRaw=function(t){var e;if(t!==null&&t!==undefined){e=this.oType.getModelFormat();r(e&&typeof e.format==="function","The model format of "+this.oType+" should be an object with the 'format' method");t=e.format(t)}return t};i.prototype.getExternalValue=function(){switch(this.sInternalType){case"raw":return this.getRawValue();case"internal":return this.getInternalValue();default:return this._getBoundValue(this._rawToExternal.bind(this))}};i.prototype.setExternalValue=function(t){switch(this.sInternalType){case"raw":return this.setRawValue(t);case"internal":return this.setInternalValue(t);default:if(this.fnFormatter){o.warning("Tried to use twoway binding, but a formatter function is used");return}return this._setBoundValue(t,this._externalToRaw.bind(this))}};i.prototype.getInternalValue=function(){return this._getBoundValue(this._rawToInternal.bind(this))};i.prototype.setInternalValue=function(t){return this._setBoundValue(t,this._internalToRaw.bind(this))};i.prototype.getRawValue=function(){return this._getBoundValue(function(t){return t})};i.prototype.setRawValue=function(t){return this._setBoundValue(t,function(t){return t})};i.prototype.setType=function(t,e){this.oType=t;this.sInternalType=e};i.prototype.getType=function(){return this.oType};i.prototype.setFormatter=function(t){this.fnFormatter=t};i.prototype.getFormatter=function(){return this.fnFormatter};i.prototype.getBindingMode=function(){return this.sMode};i.prototype.setBindingMode=function(t){this.sMode=t};i.prototype.resume=function(){this.bSuspended=false;this.checkUpdate(true)};i.prototype.checkDataState=function(t){var e=this.oModel?this.oModel.resolve(this.sPath,this.oContext):null;this._checkDataState(e,t)};i.prototype._checkDataState=function(t,e){var n=this;if(!e||t&&t in e){var a=this.getDataState();var o=function(){n.fireEvent("AggregatedDataStateChange",{dataState:a});a.changed(false);n._sDataStateTimout=null};if(t){a.setModelMessages(this.oModel.getMessagesByPath(t))}if(a&&a.changed()){if(this.mEventRegistry["DataStateChange"]){this.fireEvent("DataStateChange",{dataState:a})}if(this.bIsBeingDestroyed){o()}else if(this.mEventRegistry["AggregatedDataStateChange"]){if(!this._sDataStateTimout){this._sDataStateTimout=setTimeout(o,0)}}}}};return i});