/*!
 * OpenUI5
 * (c) Copyright 2009-2019 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/core/Core","./Template","./TemplateControl","sap/ui/thirdparty/handlebars","sap/ui/base/ManagedObject","sap/base/util/ObjectPath","sap/base/security/encodeXML","sap/ui/thirdparty/jquery","sap/base/util/isEmptyObject"],function(e,t,a,r,n,o,i,s,h){"use strict";var l=t.extend("sap.ui.core.tmpl.HandlebarsTemplate",{constructor:function(e,a){t.apply(this,arguments)}});t.registerType("text/x-handlebars-template","sap.ui.core.tmpl.HandlebarsTemplate");function p(e){for(var t in e){e[t]=e[t].replace("&gt;",">").replace("&lt;","<").replace("&quot;",'"').replace("&amp;","&")}}function g(e,t){var a=/^((\w+)>)?(.*)/,r=a.exec(e),n=r[2],o=a.exec(t),i=o[2];var r=a.exec(e);if(t&&n==i){return t+r[3]}else{return e}}l.RENDER_HELPERS=function(){var e=r.helpers["each"],t=r.helpers["with"],a=r.helpers["if"],l=r.helpers["unless"],f=sap.ui.getCore().createRenderManager();f.renderControl=function(e){this.writeControlData(e);this.writeClasses(e);this.writeStyles(e)};var d={each:function(t,a){a=a||t;if(!a.hash.path){return e.apply(this,arguments)}else{p(a.hash);var n=a.data.renderManager,o=a.data.rootControl,i=a.data.path,s=a.data.parentControl,h=g(a.hash.path,i),l=o.bindList(h),f=[],d;if(a.data){d=r.createFrame(a.data)}if(l){for(var u in l){if(d){d.renderManager=n;d.rootControl=o;d.path=h+"/"+u+"/";d.parentControl=s}f.push(a.fn({},{data:d}))}}if(!s){return new r.SafeString(f.join(""))}}},with:function(e,a){a=a||e;if(!a.hash.path){return t.apply(this,arguments)}},if:function(e,t){t=t||e;if(!t.hash.path){return a.apply(this,arguments)}else{p(t.hash);var r=t.data.rootControl,n=t.data.path,o=g(t.hash.path,n);if(o){var i=r.bindProp(o);if(i){return t.fn(this)}else{return t.inverse(this)}}}},unless:function(e,t){t=t||e;if(!t.hash.path){return l.apply(this,arguments)}else{p(t.hash);var a=t.data.rootControl,r=t.data.path,n=g(t.hash.path,r);if(n){var o=a.bindProp(n);if(!o){return t.fn(this)}else{return t.inverse(this)}}}},text:function(e,t){t=t||e;p(t.hash);var a=t.data.rootControl,n=t.data.path,o=g(t.hash.path,n);if(o){var s=a.bindProp(o);return s&&new r.SafeString(i(s))}else{throw new Error('The expression "text" requires the option "path"!')}},element:function(e,t){t=t||e;p(t.hash);var a=t.data.renderManager,n=t.data.rootControl,o=n.createDOMElement(t.hash,t.data.path),i=t.data.parentElement;if(t.fn){t.fn({},{data:{renderManager:a,rootControl:n,parentElement:o}})}if(i){i.addElement(o);return}return new r.SafeString(a.getHTML(o))},control:function(e,t){t=t||e;p(t.hash);var a=t.data.renderManager,i=t.data.control;if(i){return new r.SafeString(a.getHTML(i))}var l=t.data.rootControl,g=t.data.path,f=t.data.children,d=t.hash["sap-ui-type"],u=o.get(d||""),c=u&&u.getMetadata(),v=t.hash["sap-ui-default-aggregation"]||c&&c.getDefaultAggregationName(),m=t.data.view;if(!u){throw new Error("Control of type "+d+" cannot be found.")}var C={};if(t.fn){t.fn({},{data:{rootControl:l,path:g,children:C,defaultAggregation:v,view:m}})}var w=s.extend({},t.hash),y;for(var M in w){if(M==="sap-ui-class"&&typeof w[M]==="string"){y=w["sap-ui-class"]&&w["sap-ui-class"].split(" ");delete w[M]}else if(C[M]){delete w[M]}}var b=l.createControl(w,t.data.path,!!f,m);if(y&&y.length>0){y.forEach(b.addStyleClass.bind(b))}if(!h(C)){w=t.hash;var E=c.getAllAggregations();for(var S in C){var T=C[S];for(var x=0,A=T.length;x<A;x++){var H=T[x],L=E[S],P=L&&L.multiple;if(typeof w[S]==="string"){var _=n.bindingParser(w[S],m&&m.getController());_.template=H;b.bindAggregation(S,_)}else{if(P){b.addAggregation(S,H)}else{b.setAggregation(S,H)}}}}}if(f){var S=t.hash["sap-ui-aggregation"]||t.data.defaultAggregation;f[S]=f[S]||[];f[S].push(b);return}return new r.SafeString(a.getHTML(b))},property:function(e,t){t=t||e;p(t.hash);var a=t.data.rootControl,r=a.getMetadata(),n=t.hash.name,o=r.getProperty(n)._sGetter;return a[o]()},aggregation:function(e,t){t=t||e;p(t.hash);if(t.data.children){var a=t.hash.name;if(t.fn){var n=s.extend({},t.data,{defaultAggregation:a});t.fn({},{data:n})}}else{var o=t.data.renderManager,i=t.data.rootControl,h=i.getMetadata(),a=t.hash.name,l=h.getAggregation(a)._sGetter,g=[];var f=i[l]();if(f){for(var d=0,u=f.length;d<u;d++){if(t.fn){g.push(t.fn({},{data:{renderManager:o,rootControl:i,control:f[d]}}))}else{g.push(o.getHTML(f[d]))}}}return new r.SafeString(g.join(""))}},event:function(e,t){t=t||e},controlData:function(e,t){t=t||e;var a=t.data.rootControl;return new r.SafeString(f.getHTML(a))}};return d}();l.prototype.createMetadata=function(){var e=this.getContent(),t=this._fnTemplate=this._fnTemplate||r.compile(e);var n={},o=a.getMetadata().getAllSettings(),i=a.getMetadata().getAllPrivateAggregations();var h={property:function(e,t){t=t||e;p(t.hash);var a=t.hash.name;if(a&&a!=="id"&&!o[a]){n.properties=n.properties||{};n.properties[a]=s.extend({},{type:"string"},t.hash)}else{throw new Error('The property name "'+a+'" is reserved.')}},aggregation:function(e,t){t=t||e;p(t.hash);var a=t.hash.name;if(a&&!o[a]&&!i[a]){t.hash.multiple=t.hash.multiple=="true";n.aggregations=n.aggregations||{};n.aggregations[a]=s.extend({},t.hash)}else{throw new Error('The aggregation name "'+a+'" is reserved.')}},event:function(e,t){t=t||e},controlData:function(e,t){t=t||e;n._hasControlData=true}};["each","if","unless","with"].forEach(function(e){h[e]=function(){}});t({},{helpers:h});return n};l.prototype.createRenderer=function(e){var t=this.getContent(),a=this._fnTemplate=this._fnTemplate||r.compile(t);var n=function(t,r){var n=a(r.getContext()||{},{data:{renderManager:t,rootControl:r,view:e},helpers:l.RENDER_HELPERS});t.write(n)};return n};return l});