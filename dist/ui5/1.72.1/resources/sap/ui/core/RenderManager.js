/*!
 * OpenUI5
 * (c) Copyright 2009-2019 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["./LabelEnablement","sap/ui/base/Object","sap/ui/performance/trace/Interaction","sap/base/util/uid","sap/ui/util/ActivityDetection","sap/ui/thirdparty/jquery","sap/base/security/encodeXML","sap/base/security/encodeCSS","sap/base/assert","sap/ui/performance/Measurement","sap/base/Log","./InvisibleRenderer","./Patcher"],function(e,t,n,r,i,s,a,o,l,u,f,d,c){"use strict";var p=["renderControl","cleanupControlWithoutRendering","accessibilityState","icon"];var h=["write","writeEscaped","writeAcceleratorKey","writeControlData","writeElementData","writeAttribute","writeAttributeEscaped","addClass","writeClasses","addStyle","writeStyles","writeAccessibilityState","writeIcon","translate","getConfiguration","getHTML"];var g=["openStart","voidStart","attr","class","style","openEnd","voidEnd","text","unsafeHtml","close"];var m=["render","flush","destroy"];function y(){var e=this,r,o,b,C,I,w,E="",A=false,S,P="",D={},T={};this._setFocusHandler=function(e){l(e&&t.isA(e,"sap.ui.core.FocusHandler"),"oFocusHandler must be an sap.ui.core.FocusHandler");r=e};function N(){o=e.aBuffer=[];b=e.aRenderedControls=[];C=e.aStyleStack=[{}];S=undefined;A=false;E=""}function x(e,t){l(e&&typeof e=="string"&&/^[a-z_][a-zA-Z0-9_\-]*$/.test(e),"The "+t+" name provided '"+e+"' is not valid; it must contain alphanumeric characters, hyphens or underscores")}function M(e){l(E,"There is no open tag; '"+e+"' must not be called without an open tag")}function H(e){var t=e===undefined?!E:e;l(t,"There is an open tag; '"+E+"' tag has not yet ended with '"+(A?"voidEnd":"openEnd")+"'")}function _(e){x(e,"attr");l(e!="class"&&e!="style","Attributes 'class' and 'style' must not be written, instead use dedicated 'class' or 'style' method")}function B(e){l(typeof e=="string"&&!/\s/.test(e)&&arguments.length===1,"Method 'class' must be called with exactly one class name")}function O(e){l(e&&typeof e=="string"&&!/\s/.test(e),"Method 'style' must be called with a non-empty string name")}this.write=function(e){l(typeof e==="string"||typeof e==="number","sText must be a string or number");o.push.apply(o,arguments);return this};this.writeEscaped=function(e,t){if(e!=null){e=a(String(e));if(t){e=e.replace(/&#xa;/g,"<br>")}o.push(e)}return this};this.writeAttribute=function(e,t){l(typeof e==="string","sName must be a string");l(typeof t==="string"||typeof t==="number"||typeof t==="boolean","value must be a string, number or boolean");o.push(" ",e,'="',t,'"');return this};this.writeAttributeEscaped=function(e,t){l(typeof e==="string","sName must be a string");o.push(" ",e,'="',a(String(t)),'"');return this};this.addStyle=function(e,t){l(typeof e==="string","sName must be a string");if(t!=null&&t!=""){l(typeof t==="string"||typeof t==="number","value must be a string or number");var n=C[C.length-1];if(!n.aStyle){n.aStyle=[]}n.aStyle.push(e+": "+t+";")}return this};this.writeStyles=function(){var e=C[C.length-1];if(e.aStyle&&e.aStyle.length){this.writeAttribute("style",e.aStyle.join(" "))}e.aStyle=null;return this};this.addClass=function(e){if(e){l(typeof e==="string","sName must be a string");var t=C[C.length-1];if(!t.aClasses){t.aClasses=[]}t.aClasses.push(e)}return this};this.writeClasses=function(e){l(!e||typeof e==="boolean"||t.isA(e,"sap.ui.core.Element"),"oElement must be empty, a boolean, or an sap.ui.core.Element");var n=C[C.length-1];var r;if(e){r=e.aCustomStyleClasses}else if(e===false){r=[]}else{r=n.aCustomStyleClasses}if(n.aClasses||r){var i=[].concat(n.aClasses||[],r||[]);if(i.length){this.writeAttribute("class",i.join(" "))}}if(!e){n.aCustomStyleClasses=null}n.aClasses=null;return this};this.openStart=function(e,t){x(e,"tag");H();E=e;this.write("<"+e);if(t){if(typeof t=="string"){this.attr("id",t)}else{this.writeElementData(t)}}return this};this.openEnd=function(e){M("openEnd");H(!A);E="";this.writeClasses(e?false:undefined);this.writeStyles();this.write(">");return this};this.close=function(e){x(e,"tag");H();this.write("</"+e+">");return this};this.voidStart=function(e,t){this.openStart(e,t);A=true;return this};this.voidEnd=function(e){M("voidEnd");H(A||!E);A=false;E="";this.writeClasses(e?false:undefined);this.writeStyles();this.write(">");return this};this.unsafeHtml=function(e){H();this.write(e);return this};this.text=function(e){H();this.writeEscaped(e);return this};this.attr=function(e,t){_(e);this.writeAttributeEscaped(e,t);return this};this.class=function(e){if(e){B.apply(this,arguments);this.addClass(a(e))}return this};this.style=function(e,t){O(e);this.addStyle(e,t);return this};this.accessibilityState=this.writeAccessibilityState;this.icon=this.writeIcon;T.openStart=function(e,t){x(e,"tag");H();E=e;if(!t){c.openStart(e)}else if(typeof t=="string"){c.openStart(e,t)}else{c.openStart(e,t.getId());R(this,t)}return this};T.voidStart=function(e,t){this.openStart(e,t);A=true;return this};T.attr=function(e,t){_(e);M("attr");c.attr(e,t);return this};T.class=function(e){if(e){B.apply(this,arguments);M("class");c.class(e)}return this};T.style=function(e,t){O(e);M("style");c.style(e,t);return this};T.openEnd=function(e){if(!e){var t=C[C.length-1];var n=t.aCustomStyleClasses;if(n){n.forEach(c.class,c);t.aCustomStyleClasses=null}}M("openEnd");H(!A);E="";c.openEnd();return this};T.voidEnd=function(e){if(!e){var t=C[C.length-1];var n=t.aCustomStyleClasses;if(n){n.forEach(c.class,c);t.aCustomStyleClasses=null}}M("voidEnd");H(A||!E);A=false;E="";c.voidEnd();return this};T.text=function(e){H();if(e!=null){c.text(e)}return this};T.unsafeHtml=function(e){H();c.unsafeHtml(e);return this};T.close=function(e){x(e,"tag");H();c.close(e);return this};function j(e){w=true;try{var t=s.Event("BeforeRendering");t.srcControl=e;e._handleEvent(t)}finally{w=false}}this.cleanupControlWithoutRendering=function(e){l(!e||t.isA(e,"sap.ui.core.Control"),"oControl must be an sap.ui.core.Control or empty");if(!e||!e.getDomRef()){return}j(e);e.bOutput=false};this.renderControl=function(e){l(!e||t.isA(e,"sap.ui.core.Control"),"oControl must be an sap.ui.core.Control or empty");if(!e){return this}if(!I){I=[]}if(I&&I.length>0){u.pause(I[0]+"---renderControl")}else if(e.getParent()&&e.getParent().getMetadata().getName()=="sap.ui.core.UIArea"){u.pause(e.getParent().getId()+"---rerender")}I.unshift(e.getId());u.start(e.getId()+"---renderControl","Rendering of "+e.getMetadata().getName(),["rendering","control"]);j(e);u.pause(e.getId()+"---renderControl");var n;var i=e.getMetadata();var a=e.getVisible();if(a){n=i.getRenderer()}else{var p=i.getProperty("visible");var h=p&&p._oParent&&p._oParent.getName()=="sap.ui.core.Control";n=h?d:i.getRenderer()}u.resume(e.getId()+"---renderControl");var g=e.aBindParameters;if(g&&g.length>0){var m=s(e.getDomRef());if(m&&m[0]){for(var v=0;v<g.length;v++){var w=g[v];m.unbind(w.sEventType,w.fnProxy)}}}if(n&&typeof n.render==="function"){if(o.length){S=false}else if(S===undefined){var E=e.getDomRef();if(!E&&!a){E=document.getElementById(d.createInvisiblePlaceholderId(e))}if(E&&y.getApiVersion(n)==2&&!y.isPreservedContent(E)){r&&r.storePatchingControlFocusInfo(E);c.setRootNode(E);S=true}else{S=false}}else if(!P&&S){if(y.getApiVersion(n)!=2){P=e.getId();S=false}}var A={};if(e.aCustomStyleClasses&&e.aCustomStyleClasses.length>0){A.aCustomStyleClasses=e.aCustomStyleClasses}C.push(A);if(S){var R=c.getCurrentNode();n.render(T,e);if(c.getCurrentNode()==R){c.unsafeHtml("",e.getId());e.bOutput=false}else{e.bOutput=true}}else{var N=o.length;n.render(D,e);e.bOutput=o.length!==N}C.pop();if(P&&P===e.getId()){c.unsafeHtml(o.join(""),P);P="";S=true;o=[]}}else{f.error("The renderer for class "+i.getName()+" is not defined or does not define a render function! Rendering of "+e.getId()+" will be skipped!")}b.push(e);if(e.getUIArea&&e.getUIArea()){e.getUIArea()._onControlRendered(e)}if(n===d){e.bOutput="invisible"}u.end(e.getId()+"---renderControl");I.shift();if(I&&I.length>0){u.resume(I[0]+"---renderControl")}else if(e.getParent()&&e.getParent().getMetadata().getName()=="sap.ui.core.UIArea"){u.resume(e.getParent().getId()+"---rerender")}return this};this.getHTML=function(e){l(e&&t.isA(e,"sap.ui.core.Control"),"oControl must be an sap.ui.core.Control");var n=o;var r=o=this.aBuffer=[];this.renderControl(e);o=this.aBuffer=n;return r.join("")};function L(e){var t,n=b.length;for(t=0;t<n;t++){b[t]._sapui_bInAfterRenderingPhase=true}w=true;try{for(t=0;t<n;t++){var i=b[t];if(i.bOutput&&i.bOutput!=="invisible"){var a=s.Event("AfterRendering");a.srcControl=i;u.start(i.getId()+"---AfterRendering","AfterRendering of "+i.getMetadata().getName(),["rendering","after"]);i._handleEvent(a);u.end(i.getId()+"---AfterRendering")}}}finally{for(t=0;t<n;t++){delete b[t]._sapui_bInAfterRenderingPhase}w=false}try{r.restoreFocus(e)}catch(e){f.warning("Problems while restoring the focus after rendering: "+e,null)}for(t=0;t<n;t++){var i=b[t],o=i.aBindParameters;if(o&&o.length>0){var l=s(i.getDomRef());if(l&&l[0]){for(var d=0;d<o.length;d++){var c=o[d];l.bind(c.sEventType,c.fnProxy)}}}}}function U(e){var t;if(!S){t=r&&r.getControlFocusInfo();e(o.join(""))}else{t=r&&r.getPatchingControlFocusInfo();c.reset()}L(t);N();i.refresh();n.notifyStepEnd()}this.flush=function(e,t,n){l(typeof e==="object"&&e.ownerDocument==document,"oTargetDomNode must be a DOM element");if(!t&&typeof n!=="number"&&!n){y.preserveContent(e)}U(function(t){for(var r=0;r<b.length;r++){var i=b[r].getDomRef();if(i&&!y.isPreservedContent(i)){if(y.isInlineTemplate(i)){s(i).empty()}else{s(i).remove()}}}if(typeof n==="number"){if(n<=0){s(e).prepend(t)}else{var a=s(e).children().eq(n-1);if(a.length===1){a.after(t)}else{s(e).append(t)}}}else if(!n){s(e).html(t)}else{s(e).append(t)}})};this.render=function(e,n){l(e&&t.isA(e,"sap.ui.core.Control"),"oControl must be a control");l(typeof n==="object"&&n.ownerDocument==document,"oTargetDomNode must be a DOM element");if(w){f.error("Render must not be called within Before or After Rendering Phase. Call ignored.",null,this);return}N();this.renderControl(e);U(function(t){if(e&&n){var r=e.getDomRef();if(!r||y.isPreservedContent(r)){r=document.getElementById(d.createInvisiblePlaceholderId(e))||document.getElementById(v.Dummy+e.getId())}var i=r&&r.parentNode!=n;var a=function(){var e=s(n);if(n.innerHTML==""){e.html(t)}else{e.append(t)}};if(i){if(!y.isPreservedContent(r)){if(y.isInlineTemplate(r)){s(r).empty()}else{s(r).remove()}}if(t){a()}}else{if(t){if(r){if(y.isInlineTemplate(r)){s(r).html(t)}else{s(r).replaceWith(t)}}else{a()}}else{if(y.isInlineTemplate(r)){s(r).empty()}else{if(!e.getParent()||!e.getParent()._onChildRerenderedEmpty||!e.getParent()._onChildRerenderedEmpty(e,r)){s(r).remove()}}}}}})};this.destroy=function(){N()};var k={};p.forEach(function(e){D[e]=T[e]=k[e]=this[e]},this);g.forEach(function(e){D[e]=k[e]=this[e]},this);h.forEach(function(e){D[e]=k[e]=this[e]},this);m.forEach(function(e){k[e]=this[e]},this);this.getRendererInterface=function(){return D};this.getInterface=function(){return k};N()}y.prototype.getConfiguration=function(){return sap.ui.getCore().getConfiguration()};y.prototype.translate=function(e){};y.prototype.writeAcceleratorKey=function(){return this};y.prototype.writeControlData=function(e){l(e&&t.isA(e,"sap.ui.core.Control"),"oControl must be an sap.ui.core.Control");this.writeElementData(e);return this};y.prototype.writeElementData=function(e){l(e&&t.isA(e,"sap.ui.core.Element"),"oElement must be an sap.ui.core.Element");this.attr("id",e.getId());R(this,e);return this};y.prototype.writeAccessibilityState=function(n,r){if(!sap.ui.getCore().getConfiguration().getAccessibility()){return this}if(arguments.length==1&&!t.isA(n,"sap.ui.core.Element")){r=n;n=null}var i={};if(n!=null){var a=n.getMetadata();var o=function(e,t,r){var s=a.getProperty(e);if(s&&n[s._sGetter]()===r){i[t]="true"}};var l=function(t,r){var s=a.getAssociation(t);if(s&&s.multiple){var o=n[s._sGetter]();if(t=="ariaLabelledBy"){var l=e.getReferencingLabels(n);var u=l.length;if(u){var f=[];for(var d=0;d<u;d++){if(o.indexOf(l[d])<0){f.push(l[d])}}o=f.concat(o)}}if(o.length>0){i[r]=o.join(" ")}}};o("editable","readonly",false);o("enabled","disabled",false);o("visible","hidden",false);if(e.isRequired(n)){i["required"]="true"}o("selected","selected",true);o("checked","checked",true);l("ariaDescribedBy","describedby");l("ariaLabelledBy","labelledby")}if(r){var u=function(e){var t=typeof e;return e===null||e===""||t==="number"||t==="string"||t==="boolean"};var f={};var d,c,p;for(d in r){c=r[d];if(u(c)){f[d]=c}else if(typeof c==="object"&&u(c.value)){p="";if(c.append&&(d==="describedby"||d==="labelledby")){p=i[d]?i[d]+" ":""}f[d]=p+c.value}}s.extend(i,f)}if(t.isA(n,"sap.ui.core.Element")&&n.getParent()&&n.getParent().enhanceAccessibilityState){n.getParent().enhanceAccessibilityState(n,i)}for(var h in i){if(i[h]!=null&&i[h]!==""){this.attr(h==="role"?h:"aria-"+h,i[h])}}return this};y.prototype.writeIcon=function(e,t,n){var i=sap.ui.requireSync("sap/ui/core/IconPool"),a=i.isIconURI(e),l=false,u,d,c,p,h;if(typeof t==="string"){t=[t]}if(a){d=i.getIconInfo(e);if(!d){f.error("An unregistered icon: "+e+" is used in sap.ui.core.RenderManager's writeIcon method.");return this}if(!t){t=[]}t.push("sapUiIcon");if(!d.suppressMirroring){t.push("sapUiIconMirrorInRTL")}}if(a){this.openStart("span")}else{this.voidStart("img")}if(Array.isArray(t)){t.forEach(function(e){this.class(e)},this)}if(a){c={"data-sap-ui-icon-content":d.content,role:"presentation",title:d.text||null};this.style("font-family","'"+o(d.fontFamily)+"'")}else{c={role:"presentation",alt:"",src:e}}n=s.extend(c,n);if(!n.id){n.id=r()}if(a){p=n.alt||n.title||d.text||d.name;h=n.id+"-label";if(n["aria-labelledby"]){l=true;n["aria-labelledby"]+=" "+h}else if(!n.hasOwnProperty("aria-label")){n["aria-label"]=p}}if(typeof n==="object"){for(u in n){if(n.hasOwnProperty(u)&&n[u]!==null){this.attr(u,n[u])}}}if(a){this.openEnd();if(l){this.openStart("span");this.style("display","none");this.attr("id",h);this.openEnd("span");this.text(p);this.close("span")}this.close("span")}else{this.voidEnd()}return this};y.prototype.getRenderer=function(e){l(e&&t.isA(e,"sap.ui.core.Control"),"oControl must be an sap.ui.core.Control");return y.getRenderer(e)};var v=y.RenderPrefixes={Invisible:d.PlaceholderPrefix,Dummy:"sap-ui-dummy-",Temporary:"sap-ui-tmp-"};y.getRenderer=function(e){l(e&&t.isA(e,"sap.ui.core.Control"),"oControl must be an sap.ui.core.Control");return e.getMetadata().getRenderer()};y.forceRepaint=function(e){var t=e?window.document.getElementById(e):null;var n=typeof e=="string"?t:e;if(n){f.debug("forcing a repaint for "+(n.id||String(n)));var r=n.style.display;var i=document.activeElement;n.style.display="none";n.offsetHeight;n.style.display=r;if(document.activeElement!==i&&i){i.focus()}}};y.createInvisiblePlaceholderId=function(e){return d.createInvisiblePlaceholderId(e)};var b="sap-ui-preserve",C="sap-ui-static",I="data-sap-ui-preserve",w="data-sap-ui-area";function E(){var e=s(document.getElementById(b));if(e.length===0){e=s("<DIV/>",{"aria-hidden":"true",id:b}).addClass("sapUiHidden").addClass("sapUiForcedHidden").css("width","0").css("height","0").css("overflow","hidden").appendTo(document.body)}return e}function A(e){s("<DIV/>",{id:v.Dummy+e.id}).addClass("sapUiHidden").insertBefore(e)}var S=[];y.attachPreserveContent=function(e,t){y.detachPreserveContent(e);S.push({fn:e,context:t})};y.detachPreserveContent=function(e){S=S.filter(function(t){return t.fn!==e})};y.preserveContent=function(e,t,n){l(typeof e==="object"&&e.ownerDocument==document,"oRootNode must be a DOM element");S.forEach(function(t){t.fn.call(t.context||y,{domNode:e})});var r=E();function i(t){while(t&&t!=e&&t.parentNode){t=t.parentNode;if(t.hasAttribute(I)){return true}if(t.hasAttribute("data-sap-ui")){break}}}function a(t){if(t.id===b||t.id===C){return}if(t.hasAttribute(I)){if(t===e||i(t)){A(t)}r.append(t)}else if(n&&t.id){y.markPreservableContent(s(t),t.id);r.append(t);return}if(!t.hasAttribute(w)){var o=t.firstChild;while(o){t=o;o=o.nextSibling;if(t.nodeType===1){a(t)}}}}u.start(e.id+"---preserveContent","preserveContent for "+e.id,["rendering","preserve"]);if(t){a(e)}else{s(e).children().each(function(e,t){a(t)})}u.end(e.id+"---preserveContent")};y.findPreservedContent=function(e){l(typeof e==="string","sId must be a string");var t=E(),n=t.children("["+I+"='"+e.replace(/(:|\.)/g,"\\$1")+"']");return n};y.markPreservableContent=function(e,t){e.attr(I,t)};y.isPreservedContent=function(e){return e&&e.getAttribute(I)&&e.parentNode&&e.parentNode.id==b};y.getPreserveAreaRef=function(){return E()[0]};var P="data-sap-ui-template";y.markInlineTemplate=function(e){e.attr(P,"")};y.isInlineTemplate=function(e){return e&&e.hasAttribute(P)};y.getApiVersion=function(e){if(e.hasOwnProperty("apiVersion")){return e.apiVersion}return 1};function R(e,t){var n=t.getId();e.attr("data-sap-ui",n);t.getCustomData().forEach(function(n){var r=n._checkWriteToDom(t);if(r){e.attr(r.key.toLowerCase(),r.value)}});var r=t.getDragDropConfig().some(function(e){return e.isDraggable(t)});if(!r){var i=t.getParent();if(i&&i.getDragDropConfig){r=i.getDragDropConfig().some(function(e){return e.isDraggable(t)})}}if(r){e.attr("draggable","true");e.attr("data-sap-ui-draggable","true")}return this}return y},true);