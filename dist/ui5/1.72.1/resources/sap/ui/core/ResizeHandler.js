/*!
 * OpenUI5
 * (c) Copyright 2009-2019 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/base/Object","sap/base/Log","sap/ui/util/ActivityDetection","sap/ui/core/IntervalTrigger","sap/ui/thirdparty/jquery"],function(e,t,i,s,r){"use strict";var n=t.getLogger("sap.ui.core.ResizeHandler",t.Level.ERROR);var o=null;var d=e.extend("sap.ui.core.ResizeHandler",{constructor:function(t){e.apply(this);o=t;this.aResizeListeners=[];this.aSuspendedDomRefs=[];this.bRegistered=false;this.iIdCounter=0;this.fDestroyHandler=this.destroy.bind(this);r(window).bind("unload",this.fDestroyHandler);i.attachActivate(u,this)}});function a(){if(this.bRegistered){this.bRegistered=false;s.removeListener(this.checkSizes,this)}}function u(){if(!this.bRegistered&&this.aResizeListeners.length>0){this.bRegistered=true;s.addListener(this.checkSizes,this)}}d.prototype.destroy=function(e){i.detachActivate(u,this);r(window).unbind("unload",this.fDestroyHandler);o=null;this.aResizeListeners=[];this.aSuspendedDomRefs=[];a.call(this)};d.prototype.attachListener=function(t,i){var s=e.isA(t,"sap.ui.core.Control"),r=s?t.getDomRef():t,o=r?r.offsetWidth:0,d=r?r.offsetHeight:0,a="rs-"+Date.now()+"-"+this.iIdCounter++,f;if(s){f="Control "+t.getId()}else if(t.id){f=t.id}else{f=String(t)}this.aResizeListeners.push({sId:a,oDomRef:s?null:t,oControl:s?t:null,fHandler:i,iWidth:o,iHeight:d,dbg:f});n.debug("registered "+f);u.call(this);return a};d.prototype.detachListener=function(e){var t=this.aResizeListeners;for(var i=0;i<t.length;i++){if(t[i].sId===e){t.splice(i,1);n.debug("deregistered "+e);break}}if(t.length===0){a.call(this)}};d.prototype.checkSizes=function(){var e=n.isLoggable();if(e){n.debug("checkSizes:")}this.aResizeListeners.forEach(function(t){if(t){var i=!!t.oControl,s=i?t.oControl.getDomRef():t.oDomRef;if(s&&r.contains(document.documentElement,s)&&!this._isSuspended(s)){var o=t.iWidth,d=t.iHeight,a=s.offsetWidth,u=s.offsetHeight;if(o!=a||d!=u){t.iWidth=a;t.iHeight=u;var f=r.Event("resize");f.target=s;f.currentTarget=s;f.size={width:a,height:u};f.oldSize={width:o,height:d};f.control=i?t.oControl:null;if(e){n.debug("resize detected for '"+t.dbg+"': "+f.oldSize.width+"x"+f.oldSize.height+" -> "+f.size.width+"x"+f.size.height)}t.fHandler(f)}}}},this);if(d._keepActive!=true&&d._keepActive!=false){d._keepActive=false}if(!i.isActive()&&!d._keepActive){a.call(this)}};d.register=function(e,t){if(!o||!o.oResizeHandler){return null}return o.oResizeHandler.attachListener(e,t)};d.deregister=function(e){if(!o||!o.oResizeHandler){return}o.oResizeHandler.detachListener(e)};d.deregisterAllForControl=function(e){if(!o||!o.oResizeHandler){return}o.oResizeHandler.aResizeListeners.filter(function(t){return t&&t.oControl&&t.oControl.getId()===e}).forEach(function(e){d.deregister(e.sId)})};d.suspend=function(e){if(!o||!o.oResizeHandler){return false}if(!e||!r.contains(document.documentElement,e)){return false}var t=o.oResizeHandler;if(t.aSuspendedDomRefs.indexOf(e)===-1){t.aSuspendedDomRefs.push(e)}return true};d.resume=function(e){if(!o||!o.oResizeHandler){return false}var t=o.oResizeHandler,i=t.aSuspendedDomRefs.indexOf(e);if(i===-1){return false}t.aSuspendedDomRefs.splice(i,1);t.checkSizes();return true};d.prototype._isSuspended=function(e){var t=this.aSuspendedDomRefs,i;for(var s=0;s<t.length;s++){i=t[s];if(i===e||r.contains(i,e)){return true}}return false};return d});