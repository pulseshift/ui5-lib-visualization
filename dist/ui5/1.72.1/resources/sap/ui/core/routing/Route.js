/*!
 * OpenUI5
 * (c) Copyright 2009-2019 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/base/EventProvider","sap/ui/core/routing/Target","sap/ui/core/routing/async/Route","sap/ui/core/routing/sync/Route","sap/ui/core/Component","sap/base/Log","sap/base/assert","sap/ui/thirdparty/jquery"],function(t,e,r,n,a,o,i,s){"use strict";var u=t.extend("sap.ui.core.routing.Route",{metadata:{publicMethods:["getURL","getPattern"]},constructor:function(a,i,u){t.apply(this,arguments);this._validateConfig(i);this._aPattern=[];this._aRoutes=[];this._oParent=u;this._oConfig=i;this._oRouter=a;var h=this,c=i.pattern,f,g,d=a._isAsync();g=d?r:n;for(var _ in g){this[_]=g[_]}if(!Array.isArray(c)){c=[c]}if(i.parent){var p=this._getParentRoute(i.parent);if(!p){o.error("No parent route with '"+i.parent+"' could be found",this)}else if(p._aPattern.length>1){o.error("Routes with multiple patterns cannot be used as parent for nested routes",this);return}else{this._oNestingParent=p;c.forEach(function(t,e){var r=p._aPattern[0];r=r.charAt(r.length)==="/"?r:r+"/";c[e]=r+t})}}if(Array.isArray(i.subroutes)){f=i.subroutes;i.subroutes={};s.each(f,function(t,e){i.subroutes[e.name]=e})}if(!i.target){var l=this._convertToTargetOptions(i);l._async=d;this._oTarget=new e(l,a._oViews,u&&u._oTarget);this._oTarget._bUseRawViewId=true}if(i.subroutes){s.each(i.subroutes,function(t,e){if(e.name===undefined){e.name=t}a.addRoute(e,h)})}if(i.pattern===undefined){return}s.each(c,function(t,e){h._aPattern[t]=e;h._aRoutes[t]=a._oRouter.addRoute(e);h._aRoutes[t].greedy=i.greedy;h._aRoutes[t].matched.add(function(){var e={};s.each(arguments,function(r,n){e[h._aRoutes[t]._paramsIds[r]]=n});h._routeMatched(e,true)});h._aRoutes[t].switched.add(function(){h._routeSwitched()})})},_routeSwitched:function(){this._suspend();this.fireEvent("switched",{name:this._oConfig.name})},_suspend:function(){if(this._oRouter._oTargets){this._oRouter._oTargets.suspend(this._oConfig.target)}},destroy:function(){t.prototype.destroy.apply(this);this._aPattern=null;this._aRoutes=null;this._oParent=null;this._oConfig=null;this.bIsDestroyed=true;return this},getURL:function(t){return this._aRoutes[0].interpolate(t||{})},_alignTargetsConfig:function(t){if(!t){return[]}if(!Array.isArray(t)){return typeof t==="string"?[{name:t}]:[t]}return t.map(function(t){if(typeof t==="string"){t={name:t}}return t})},_changeHashWithComponentTargets:function(t,e){var r=this._alignTargetsConfig(this._oConfig.target),n=this._oRouter._oTargets,a,i;if(r&&r.length>0&&n){a=n.getTarget(r);if(!Array.isArray(a)){a=[a]}}else{a=[]}i=a.map(function(n,a){if(n._oOptions.type==="Component"){var i=n._load({prefix:r[a].prefix});return i.then(function(n){var i=n.getRouter(),s=i&&i.getHashChanger(),u=t&&t[r[a].name],h=u&&u.route,c=i&&i.getRoute(h),f;if(u){if(c){f=i._getLastMatchedRouteName()!==h;s.setHash(c.getURL(u.parameters),e||!f);return c._changeHashWithComponentTargets(u.componentTargetInfo,e||f)}else{o.error("Can not navigate to route with name '"+h+"' because the route does not exist in component with id '"+n.getId()+"'")}}})}});return Promise.all(i)},getPattern:function(){return this._aPattern[0]},match:function(t){return this._aRoutes.some(function(e){return e.match(t)})},attachMatched:function(t,e,r){return this.attachEvent("matched",t,e,r)},detachMatched:function(t,e){return this.detachEvent("matched",t,e)},attachBeforeMatched:function(t,e,r){return this.attachEvent("beforeMatched",t,e,r)},detachBeforeMatched:function(t,e){return this.detachEvent("beforeMatched",t,e)},fireBeforeMatched:function(t){this.fireEvent("beforeMatched",t);return this},attachPatternMatched:function(t,e,r){return this.attachEvent("patternMatched",t,e,r)},detachPatternMatched:function(t,e){return this.detachEvent("patternMatched",t,e)},_validateConfig:function(t){if(!t.name){o.error("A name has to be specified for every route",this)}if(t.viewName){o.error("The 'viewName' option shouldn't be used in Route. please use 'view' instead",this)}},_convertToTargetOptions:function(t){return s.extend(true,{},t,{rootView:t.targetParent,controlId:t.targetControl,controlAggregation:t.targetAggregation,clearControlAggregation:t.clearTarget,viewName:t.view,viewType:t.viewType,viewId:t.viewId})},_getParentRoute:function(t){var e=t.split(":");if(e.length===1||e.length===2&&!e[0]){return this._oRouter.getRoute(e[e.length-1])}else{i(this._oRouter._oOwner,"No owner component for "+this._oRouter._oOwner.getId());var r=a.getOwnerComponentFor(this._oRouter._oOwner);while(r){if(r.getMetadata().getName()===e[0]){var n=r.getRouter();return n.getRoute(e[1])}r=a.getOwnerComponentFor(r)}return null}}});u.M_EVENTS={BeforeMatched:"beforeMatched",Matched:"matched",PatternMatched:"patternMatched"};return u});