/*!
 * OpenUI5
 * (c) Copyright 2009-2019 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["./LRUPersistentCache","./CacheManagerNOP","sap/ui/Device","sap/base/Log","sap/ui/performance/Measurement"],function(e,n,t,a,r){"use strict";var s={_instance:null,_getInstance:function(){var e,n=h("_getInstance"),t=this;e=new Promise(function(e,o){var u;a.debug("Cache Manager: Initialization...");if(!s._instance){u=t._findImplementation();r.start(c,"CM",i);u.init().then(d,o);r.end(c,"CM")}else{d(s._instance)}function d(t){s._instance=t;n.endAsync();a.debug("Cache Manager initialized with implementation ["+s._instance.name+"], resolving _getInstance promise");e(t)}});n.endSync();return e},_findImplementation:function(){if(u()&&this._isSupportedEnvironment()){return e}else{a.warning("UI5 Cache Manager is switched off");return n}},set:function(e,n){var t,r=h("set",e);a.debug("Cache Manager: Setting value of type["+typeof n+"] with key ["+e+"]");t=this._callInstanceMethod("set",arguments).then(function n(){a.debug("Cache Manager: Setting key ["+e+"] completed successfully");r.endAsync()},function(n){a.error("Cache Manager: Setting key ["+e+"] failed. Error:"+n);r.endAsync();throw n});r.endSync();return t},get:function(e){var n,t=h("get",e);a.debug("Cache Manager: Getting key ["+e+"]");n=this._callInstanceMethod("get",arguments).then(function n(r){a.debug("Cache Manager: Getting key ["+e+"] done");t.endAsync();return r},function(n){a.debug("Cache Manager: Getting key ["+e+"] failed. Error: "+n);t.endAsync();throw n});t.endSync();return n},has:function(e){var n,t=h("has",e);a.debug("Cache Manager: has key ["+e+"] called");n=this._callInstanceMethod("has",arguments).then(function n(r){t.endAsync();a.debug("Cache Manager: has key ["+e+"] returned "+r);return r});t.endSync();return n},del:function(e){var n,t=h("del",e);a.debug("Cache Manager: del called.");n=this._callInstanceMethod("del",arguments).then(function e(){a.debug("Cache Manager: del completed successfully.");t.endAsync()},function(e){a.debug("Cache Manager: del failed. Error: "+e);t.endAsync();throw e});t.endSync();return n},reset:function(){var e,n=h("reset");a.debug("Cache Manager: Reset called.");e=this._callInstanceMethod("reset",arguments).then(function e(){a.debug("Cache Manager: Reset completed successfully.");n.endAsync()},function(e){a.debug("Cache Manager: Reset failed. Error: "+e);n.endAsync();throw e});n.endSync();return e},_switchOff:function(){var e=this;return Promise.resolve().then(function(){d(e);sap.ui.getCore().getConfiguration().setUI5CacheOn(false)})},_switchOn:function(){var e=this;return Promise.resolve().then(function(){var n=sap.ui.getCore().getConfiguration();if(!n.isUI5CacheOn()){d(e);sap.ui.getCore().getConfiguration().setUI5CacheOn(true)}return Promise.resolve()})},_callInstanceMethod:function(e,n){var t,s="[sync ] _callInstanceMethod";r.start(s,"CM",i);if(this._instance){a.debug("Cache Manager: calling instance...");return this._instance[e].apply(this._instance,n)}a.debug("Cache Manager: getting instance...");t=this._getInstance().then(function t(a){return a[e].apply(a,n)});r.end(s);return t},_isSupportedEnvironment:function(){var e=[];if(this._bSupportedEnvironment==undefined){e.push({system:t.system.SYSTEMTYPE.DESKTOP,browserName:t.browser.BROWSER.CHROME,browserVersion:49});e.push({system:t.system.SYSTEMTYPE.DESKTOP,browserName:t.browser.BROWSER.INTERNET_EXPLORER,browserVersion:11});this._bSupportedEnvironment=e.some(function(e){var n=t.system[e.system],a=e.browserName===t.browser.name,r=t.browser.version>=e.browserVersion;return n&&a&&r&&window.indexedDB})}return this._bSupportedEnvironment}};var i="CacheManager",c="[sync ] _initImplementation",o=0;function u(){return sap.ui.getCore().getConfiguration().isUI5CacheOn()}function d(e){if(e._instance){e._instance._destroy();e._instance=null}}function h(e,n){o++;var t="[async]  "+e+"["+n+"]- #"+o,a="[sync ]  "+e+"["+n+"]- #"+o;r.start(t,"CM",[i,e]);r.start(a,"CM",[i,e]);return{sMeasureAsync:t,sMeasureSync:a,endAsync:function(){r.end(this.sMeasureAsync)},endSync:function(){r.end(this.sMeasureSync)}}}return s},false);