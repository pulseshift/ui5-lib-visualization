/*!
 * OpenUI5
 * (c) Copyright 2009-2019 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/thirdparty/URI","sap/ui/Device","sap/ui/performance/trace/Passport","sap/ui/performance/trace/Interaction","sap/ui/performance/XHRInterceptor","sap/ui/performance/BeaconRequest","sap/base/util/Version"],function(e,t,n,r,i,o,s){"use strict";var a=false,u,p,c,f=n.getRootId(),m=window.location.host,d=t.os.name+"_"+t.os.version,l=t.browser.name+"_"+t.browser.version,g=E(),S="",R="",v,P=0,h="undetermined",A="undetermined_startup_0",T,I;function E(){var e=0;if(t.system.combi){e=1}else if(t.system.desktop){e=2}else if(t.system.tablet){e=4}else if(t.system.phone){e=3}return e}function N(e){var t=new Date(e);return t.toISOString().replace(/[^\d]/g,"")}function b(t){var n=new e(t).host();return n&&n!==m}function _(){if(!b(arguments[1])){if(!v){v=n.getTransactionId()}this.setRequestHeader("SAP-PASSPORT",n.header(n.traceFlags(),f,n.getTransactionId(),h,A))}}function F(){if(!b(arguments[1])){if(T&&I){this.setRequestHeader("SAP-Perf-FESRec",T);this.setRequestHeader("SAP-Perf-FESRec-opt",I);T=null;I=null;v=n.getTransactionId()}}}function w(e,t){return[q(f,32),q(v,32),q(e.navigation,16),q(e.roundtrip,16),q(t.timeToInteractive,16),q(e.completeRoundtrips,8),q(A,40,true),q(e.networkTime,16),q(e.requestTime,16),q(d,20),"SAP_UI5"].join(",")}function y(e,t){return[q(t.appNameShort,20,true),q(t.stepName,20,true),"",q(l,20),q(e.bytesSent,16),q(e.bytesReceived,16),"","",q(e.processing,16),e.requestCompression?"X":"","","","","",q(e.busyDuration,16),"",q(g,1),"",q(N(e.start),20),q(t.appNameLong,70,true)].join(",")}function q(e,t,n){if(!e){e=e===0?"0":""}else if(typeof e==="number"){var r=e;e=Math.round(e).toString();if(e.length>t||r<0){e="-1"}}else{e=n?e.substr(-t,t):e.substr(0,t)}return e}function H(e){var t=new s(e);return"@"+t.getMajor()+"."+t.getMinor()+"."+t.getPatch()}function D(e,t){T=w(e,t);I=y(e,t)}function O(e,t){var n=L.onBeforeCreated({stepName:e.trigger+"_"+e.event,appNameLong:e.stepComponent||e.component,appNameShort:e.stepComponent||e.component,timeToInteractive:e.duration},e);if(p||e.requests.length>0||t){D(e,n);if(p){v=null}}if(p&&T&&I){p.append("SAP-Perf-FESRec",T+"SAP-Perf-FESRec-opt"+I);clearTimeout(c);c=setTimeout(C,6e4)}var i=r.getPending();if(i){if(R!=i.appVersion){R=i.appVersion;S=R?H(R):""}}h=i?i.component+S:undefined;A=i?i.trigger+"_"+i.event+"_"+P:undefined;P++}function C(){p.send();clearTimeout(c);c=setTimeout(C,6e4)}var L={};L.getBeaconURL=function(){return u};L.setActive=function(e,t){if(e&&!a){p=t?o.isSupported()&&new o({url:t}):null;u=t;a=true;n.setActive(true);r.setActive(true);i.register("PASSPORT_HEADER","open",_);if(!p){i.register("FESR","open",F)}r.onInteractionFinished=O}else if(!e&&a){a=false;r.setActive(false);i.unregister("FESR","open");if(i.isRegistered("PASSPORT_HEADER","open")){i.register("PASSPORT_HEADER","open",function(){this.setRequestHeader("SAP-PASSPORT",n.header(n.traceFlags(),f,n.getTransactionId()))})}if(p){p.send();clearTimeout(c);c=null;p=null;u=null}r.onInteractionFinished=null}};L.getActive=function(){return a};L.onBeforeCreated=function(e,t){return{stepName:e.stepName,appNameLong:e.appNameLong,appNameShort:e.appNameShort,timeToInteractive:e.timeToInteractive}};return L});