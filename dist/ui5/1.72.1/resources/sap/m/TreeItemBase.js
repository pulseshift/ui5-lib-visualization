/*!
 * OpenUI5
 * (c) Copyright 2009-2019 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["./ListItemBase","./library","sap/ui/core/IconPool","sap/ui/core/Icon","./TreeItemBaseRenderer","sap/ui/events/KeyCodes"],function(e,t,i,r,n,o){"use strict";var s=t.ListMode;var a=e.extend("sap.m.TreeItemBase",{metadata:{library:"sap.m"}});a.prototype.ExpandedIconURI=i.getIconURI("navigation-down-arrow");a.prototype.CollapsedIconURI=i.getIconURI("navigation-right-arrow");a.prototype.getTree=function(){var e=this.getParent();if(e&&e.isA("sap.m.Tree")){return e}};a.prototype.getList=a.prototype.getTree;a.prototype.informTree=a.prototype.informList;a.prototype.getItemNodeContext=function(){var e=this.getTree();var t=null;var i=e?e.getBinding("items"):null;if(e&&i){i=e.getBinding("items");t=i.getNodeByIndex(e.indexOfItem(this))}return t};a.prototype.getParentNode=function(){if(this.isTopLevel()){return}var e=this.getTree(),t=this.getLevel(),i=null,r=e.indexOfItem(this)-1,n=e.getItems(),o;while(r>=0){o=n[r].getLevel();if(o===t-1){i=n[r];break}r--}return i};a.prototype.getParentNodeContext=function(){return this.getItemNodeContext().parent};a.prototype.isLeaf=function(){var e=this.getTree(),t=this.getItemNodeContext();return t?!e.getBinding("items").nodeHasChildren(t):false};a.prototype.isTopLevel=function(){return this.getLevel()===0};a.prototype.getLevel=function(){return(this.getItemNodeContext()||{}).level};a.prototype.getExpanded=function(){var e=this.getTree();if(!e){return false}var t=e.indexOfItem(this);var i=e.getBinding("items");return i&&i.isExpanded(t)};a.prototype.setSelected=function(t){e.prototype.setSelected.apply(this,arguments);var i=this.getTree();var r=i?i.getBinding("items"):null;var n=-1;if(i&&r){n=i.indexOfItem(this);if(i.getMode()===s.SingleSelect){r.setSelectedIndex(n)}if(i.getMode()===s.MultiSelect){if(t){r.addSelectionInterval(n,n)}else{r.removeSelectionInterval(n,n)}}}return this};a.prototype._getExpanderControl=function(){var e=this.CollapsedIconURI;if(this.getExpanded()){e=this.ExpandedIconURI}if(this._oExpanderControl){this._oExpanderControl.setSrc(e);return this._oExpanderControl}this._oExpanderControl=new r({id:this.getId()+"-expander",src:e,useIconTooltip:false,noTabStop:true}).setParent(this,null,true).addStyleClass("sapMTreeItemBaseExpander").attachPress(function(e){this.informTree("ExpanderPressed")},this);return this._oExpanderControl};a.prototype._updateItem=function(){if(this._bInvalidated){return}var e=this.getTree();if(e&&e._bInvalidated){return}if(this._oExpanderControl){var t=this.CollapsedIconURI;if(this.getExpanded()){t=this.ExpandedIconURI}this._oExpanderControl.setSrc(t);var i=this.$();if(!this.isLeaf()){i.removeClass("sapMTreeItemBaseLeaf");i.attr("aria-expanded",this.getExpanded())}else{i.addClass("sapMTreeItemBaseLeaf");i.removeAttr("aria-expanded")}i.toggleClass("sapMTreeItemBaseChildren",!this.isTopLevel());i.attr("aria-level",this.getLevel()+1);var r=this._getPadding(),n=sap.ui.getCore().getConfiguration().getRTL()?"paddingRight":"paddingLeft";i.css(n,r+"rem")}};a.prototype.invalidate=function(){e.prototype.invalidate.apply(this,arguments);this._bInvalidated=true};a.prototype.onAfterRendering=function(){e.prototype.onAfterRendering.apply(this,arguments);this._bInvalidated=false};a.prototype.setBindingContext=function(){e.prototype.setBindingContext.apply(this,arguments);this._updateItem();return this};a.prototype._getPadding=function(){var e=this.getTree(),t=this.getLevel(),i=0,r;if(e){r=e.getDeepestLevel()}if(r<t){e._iDeepestLevel=t;r=e._iDeepestLevel}if(r<2){i=t*1.5}else if(r===2){i=t*1}else if(r<6){i=t*.5}else{i=t*.25}return i};a.prototype.onsapplus=function(e){this.informTree("ExpanderPressed",true)};a.prototype.onsapminus=function(e){this.informTree("ExpanderPressed",false)};a.prototype.onsapright=function(e){if(e.srcControl!==this||this.isLeaf()){return}if(!this.getExpanded()){this.informTree("ExpanderPressed",true)}else{e.keyCode=o.ARROW_DOWN}};a.prototype.onsapleft=function(e){if(e.srcControl!==this||this.isTopLevel()&&!this.getExpanded()){return}if(!this.isLeaf()){if(this.getExpanded()){this.informTree("ExpanderPressed",false)}else{this.getParentNode().focus()}}else{this.getParentNode().focus()}};a.prototype.onsapbackspace=function(e){if(e.srcControl!==this){return}if(!this.isTopLevel()){this.getParentNode().focus()}};a.prototype.getAccessibilityType=function(e){return e.getText("ACC_CTR_TYPE_TREEITEM")};a.prototype.exit=function(){e.prototype.exit.apply(this,arguments);this.destroyControls(["Expander"])};a.prototype.onlongdragover=function(e){this.informTree("LongDragOver")};return a});