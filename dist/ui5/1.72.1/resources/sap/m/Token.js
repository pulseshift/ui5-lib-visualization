/*!
 * OpenUI5
 * (c) Copyright 2009-2019 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["./library","sap/ui/core/Control","./Tokenizer","sap/ui/core/library","sap/ui/core/Icon","./TokenRenderer","sap/ui/core/InvisibleText","sap/ui/events/KeyCodes","sap/ui/core/theming/Parameters","sap/ui/core/Core"],function(e,t,i,o,n,s,r,a,l,c){"use strict";var p=o.TextDirection;var u=t.extend("sap.m.Token",{metadata:{library:"sap.m",properties:{selected:{type:"boolean",group:"Misc",defaultValue:false},key:{type:"string",group:"Misc",defaultValue:""},text:{type:"string",group:"Misc",defaultValue:""},editable:{type:"boolean",group:"Misc",defaultValue:true},textDirection:{type:"sap.ui.core.TextDirection",group:"Appearance",defaultValue:p.Inherit},editableParent:{type:"boolean",group:"Behavior",defaultValue:true,visibility:"hidden"}},aggregations:{deleteIcon:{type:"sap.ui.core.Icon",multiple:false,visibility:"hidden"}},associations:{ariaDescribedBy:{type:"sap.ui.core.Control",multiple:true,singularName:"ariaDescribedBy"},ariaLabelledBy:{type:"sap.ui.core.Control",multiple:true,singularName:"ariaLabelledBy"}},events:{delete:{},press:{},select:{},deselect:{}}}});u.prototype.init=function(){var e=this,t=l.get("_sap_m_Token_Sys_Cancel_Icon")==="true",i=t?"sap-icon://sys-cancel":"sap-icon://decline";this._deleteIcon=new n({id:e.getId()+"-icon",src:i,noTabStop:true,press:this._tokenIconPress.bind(this)});this._deleteIcon.addStyleClass("sapMTokenIcon");this.setAggregation("deleteIcon",this._deleteIcon);this._deleteIcon.setUseIconTooltip(false)};u.prototype.ontouchstart=function(e){if(e.target.id===this.getId()+"-icon"){e.preventDefault()}};u.prototype._getTooltip=function(e,t){var i=e.getTooltip_AsString(),o=c.getLibraryResourceBundle("sap.m").getText("TOKEN_ARIA_DELETABLE");if(t&&!i){return o}return i};u.prototype._onTokenPress=function(e){var t=this.getSelected(),o=e.ctrlKey||e.metaKey,n=e.shiftKey,s=true,r;if(o||e.which===a.SPACE){s=!t}this.setSelected(s);this.firePress();if(t!=s){if(s){this.fireSelect()}else{this.fireDeselect()}}r=this.getParent();if(r instanceof i){r._onTokenSelect(this,o,n)}if(this.getSelected()){this.focus()}};u.prototype._tokenIconPress=function(e){var t=this.getParent();if(!t.getEnabled()){return}this.fireDelete({token:this});if(t.isA("sap.m.Tokenizer")){t._onTokenDelete(this)}e.preventDefault()};u.prototype._changeSelection=function(e){if(this.getSelected()==e){return}this.setSelected(e);if(e){this.fireSelect()}else{this.fireDeselect()}};u.prototype.ontap=function(e){if(e.target.id==this._deleteIcon.getId()){e.setMark("tokenDeletePress",true);return}this._onTokenPress(e)};u.prototype.onsapfocusleave=function(e){if(this.getParent()instanceof i){return}this.setSelected(false)};u.prototype.onsapbackspace=function(e){this._deleteToken(e)};u.prototype.onsapdelete=function(e){this._deleteToken(e)};u.prototype._deleteToken=function(e){if(this.getParent()instanceof i){return}if(this.getEditable()){this.fireDelete({token:this})}e.preventDefault()};u.prototype.onsapspace=function(e){this._onTokenPress(e);if(e){e.preventDefault();e.stopPropagation()}};u.prototype.onkeydown=function(e){if((e.ctrlKey||e.metaKey)&&e.which===a.SPACE){this.onsapspace(e);e.preventDefault()}};return u});