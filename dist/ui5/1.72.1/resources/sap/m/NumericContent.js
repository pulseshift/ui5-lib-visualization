/*!
 * OpenUI5
 * (c) Copyright 2009-2019 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["./library","sap/ui/core/Control","sap/ui/core/IconPool","sap/ui/core/ResizeHandler","sap/m/Image","./NumericContentRenderer","sap/ui/events/KeyCodes","sap/base/util/deepEqual"],function(e,t,i,o,n,a,r,s){"use strict";var p={ar:4,ar_EG:4,ar_SA:4,bg:4,ca:6,cs:4,da:4,de:8,de_AT:8,de_CH:8,el:4,el_CY:4,en:4,en_AU:4,en_GB:4,en_HK:4,en_IE:4,en_IN:4,en_NZ:4,en_PG:4,en_SG:4,en_ZA:4,es:6,es_AR:4,es_BO:4,es_CL:4,es_CO:4,es_MX:6,es_PE:4,es_UY:4,es_VE:4,et:4,fa:4,fi:4,fr:4,fr_BE:4,fr_CA:4,fr_CH:4,fr_LU:4,he:4,hi:4,hr:4,hu:4,id:4,it:8,it_CH:8,ja:6,kk:4,ko:6,lt:4,lv:4,ms:4,nb:4,nl:4,nl_BE:4,pl:4,pt:4,pt_PT:4,ro:4,ru:4,ru_UA:4,sk:4,sl:4,sr:4,sv:4,th:4,tr:4,uk:4,vi:4,zh_CN:6,zh_HK:6,zh_SG:6,zh_TW:6};var l=t.extend("sap.m.NumericContent",{metadata:{library:"sap.m",properties:{animateTextChange:{type:"boolean",group:"Behavior",defaultValue:true},formatterValue:{type:"boolean",group:"Data",defaultValue:false},icon:{type:"sap.ui.core.URI",group:"Appearance",defaultValue:null},iconDescription:{type:"string",group:"Accessibility",defaultValue:null},indicator:{type:"sap.m.DeviationIndicator",group:"Appearance",defaultValue:"None"},nullifyValue:{type:"boolean",group:"Behavior",defaultValue:true},scale:{type:"string",group:"Appearance",defaultValue:null},size:{type:"sap.m.Size",group:"Appearance",defaultValue:"Auto"},truncateValueTo:{type:"int",group:"Appearance",defaultValue:4},value:{type:"string",group:"Data",defaultValue:null},valueColor:{type:"sap.m.ValueColor",group:"Appearance",defaultValue:"Neutral"},width:{type:"sap.ui.core.CSSSize",group:"Appearance",defaultValue:null},withMargin:{type:"boolean",group:"Appearance",defaultValue:true},state:{type:"sap.m.LoadState",group:"Behavior",defaultValue:"Loaded"}},events:{press:{}}}});l.prototype.init=function(){this._rb=sap.ui.getCore().getLibraryResourceBundle("sap.m");this.setTooltip("{AltText}");sap.ui.getCore().attachInit(this._registerResizeHandler.bind(this))};l.prototype._getParentTile=function(){var e=this.getParent();while(e){if(e.isA("sap.m.GenericTile")){return e}e=e.getParent()}return null};l.prototype._getMaxDigitsData=function(){var e=this._getParentTile(),t=null,i=null;if(e){var o=sap.ui.getCore().getConfiguration().getLanguage(),n=e._isSmall();t=p[o]||t;if(!n){switch(t){case 6:i="sapMNCMediumFontSize";break;case 8:i="sapMNCSmallFontSize";break;default:i="sapMNCLargeFontSize";break}}}return{fontClass:i,maxLength:t}};l.prototype._registerResizeHandler=function(){o.register(this,this.invalidate.bind(this))};l.prototype.onBeforeRendering=function(){this.$().unbind("mouseenter");this.$().unbind("mouseleave");this._iMaxLength=null};l.prototype.onAfterRendering=function(){this.$().bind("mouseenter",this._addTooltip.bind(this));this.$().bind("mouseleave",this._removeTooltip.bind(this));if(!sap.ui.getCore().isThemeApplied()){sap.ui.getCore().attachThemeChanged(this._checkIfIconFits,this)}else{this._checkIfIconFits()}};l.prototype._addTooltip=function(){this.$().attr("title",this.getTooltip_AsString())};l.prototype._checkIfIconFits=function(){var e=this._getParentTile();if(e&&(e.isA("sap.m.GenericTile")||e.isA("sap.m.SlideTile"))){e._setupResizeClassHandler()}var t=this.$("icon-image"),i=this.$("value-inner"),o=this.$("value-scr");var n=t.outerWidth()+i.width(),a=o.width();n>a?t.hide():t.show()};l.prototype._removeTooltip=function(){this.$().attr("title",null)};l.prototype.exit=function(){if(this._oIcon){this._oIcon.destroy()}};l.prototype.getAltText=function(){var t=this.getValue();var i=this.getScale();var o;var n=this._rb.getText(("SEMANTIC_COLOR_"+this.getValueColor()).toUpperCase());var a="";if(this.getNullifyValue()){o="0"}else{o=""}if(this.getIconDescription()){a=a.concat(this.getIconDescription());a=a.concat("\n")}if(t){a=a.concat(t+i)}else{a=a.concat(o)}a=a.concat("\n");if(this.getIndicator()&&this.getIndicator()!==e.DeviationIndicator.None){a=a.concat(this._rb.getText(("NUMERICCONTENT_DEVIATION_"+this.getIndicator()).toUpperCase()));a=a.concat("\n")}a=a.concat(n);return a};l.prototype.getTooltip_AsString=function(){var e=this.getTooltip();var t=this.getAltText();if(typeof e==="string"||e instanceof String){t=e.split("{AltText}").join(t).split("((AltText))").join(t);return t}if(e){return e}else{return""}};l.prototype.setIcon=function(e){var t=!s(this.getIcon(),e);if(t){if(this._oIcon){this._oIcon.destroy();this._oIcon=undefined}if(e){this._oIcon=i.createControlByURI({id:this.getId()+"-icon-image",src:e},n)}}this._setPointerOnIcon();return this.setProperty("icon",e)};l.prototype._setPointerOnIcon=function(){if(this._oIcon&&this.hasListeners("press")){this._oIcon.addStyleClass("sapMPointer")}else if(this._oIcon&&this._oIcon.hasStyleClass("sapMPointer")){this._oIcon.removeStyleClass("sapMPointer")}};l.prototype.ontap=function(e){this.$().focus();this.firePress();e.preventDefault()};l.prototype.onkeyup=function(e){if(e.which===r.ENTER||e.which===r.SPACE){this.firePress();e.preventDefault()}};l.prototype.onkeydown=function(e){if(e.which===r.SPACE){e.preventDefault()}};l.prototype.attachEvent=function(e,i,o,n){t.prototype.attachEvent.call(this,e,i,o,n);if(this.hasListeners("press")){this.$().attr("tabindex",0).addClass("sapMPointer");this._setPointerOnIcon()}return this};l.prototype.detachEvent=function(e,i,o){t.prototype.detachEvent.call(this,e,i,o);if(!this.hasListeners("press")){this.$().removeAttr("tabindex").removeClass("sapMPointer");this._setPointerOnIcon()}return this};l.prototype._parseFormattedValue=function(e){var t=e.replace(String.fromCharCode(8206),"").replace(String.fromCharCode(8207),"");return{scale:t.replace(/[+-., \d]*(.*)$/g,"$1").trim().replace(/\.$/,""),value:t.replace(/([+-., \d]*).*$/g,"$1").trim()}};return l});