/*!
 * OpenUI5
 * (c) Copyright 2009-2019 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["./library","sap/ui/Device","./NotificationListBase","sap/ui/core/InvisibleText","sap/ui/core/IconPool","sap/ui/core/ResizeHandler","sap/m/Button","sap/m/Text","./NotificationListItemRenderer"],function(e,t,i,s,r,a,o,n,p){"use strict";var l=e.ButtonType;var u=i.extend("sap.m.NotificationListItem",{metadata:{library:"sap.m",properties:{description:{type:"string",group:"Appearance",defaultValue:""},truncate:{type:"boolean",group:"Appearance",defaultValue:true},hideShowMoreButton:{type:"boolean",group:"Appearance",defaultValue:false}},aggregations:{processingMessage:{type:"sap.m.MessageStrip",multiple:false},_bodyText:{type:"sap.m.Text",multiple:false,visibility:"hidden"}}}});u.prototype.init=function(){i.prototype.init.call(this);var e=sap.ui.getCore().getLibraryResourceBundle("sap.m");this._expandText=e.getText("NOTIFICATION_LIST_ITEM_SHOW_MORE");this._collapseText=e.getText("NOTIFICATION_LIST_ITEM_SHOW_LESS");this._closeText=e.getText("NOTIFICATION_LIST_BASE_CLOSE");this.setType("Active");var t=new o(this.getId()+"-closeButton",{type:l.Transparent,icon:r.getIconURI("decline"),tooltip:this._closeText,press:function(){this.close()}.bind(this)});this.setAggregation("_closeButton",t,true);var a=new o({type:l.Transparent,text:this.getTruncate()?this._expandText:this._collapseText,id:this.getId()+"-expandCollapseButton",press:function(){this._deregisterResize();this.setProperty("truncate",!this.getTruncate(),true);a.setText(this.getTruncate()?this._expandText:this._collapseText);this.$().find(".sapMNLI-Header").toggleClass("sapMNLI-TitleWrapper--is-expanded");this.$().find(".sapMNLI-TextWrapper").toggleClass("sapMNLI-TextWrapper--is-expanded",!!this.getDescription());this._registerResize()}.bind(this)});a.addEventDelegate({onfocusin:function(){this.getDomRef().setAttribute("aria-hidden",true)},onfocusout:function(){this.getDomRef().setAttribute("aria-hidden",false)}},this);this.setAggregation("_collapseButton",a,true);this._ariaDetailsText=new s({id:this.getId()+"-info"}).toStatic()};u.prototype.setDescription=function(e){var t=this.setProperty("description",e);this._getDescriptionText().setText(e);return t};u.prototype.setDatetime=function(e){var t=i.prototype.setDatetime.call(this,e);this._updateAriaAdditionalInfo();return t};u.prototype.setUnread=function(e){var t=this.setProperty("unread",e,true);var i=this.getAggregation("_headerTitle");if(i){i.toggleStyleClass("sapMNLI-Unread",this.getUnread())}return t};u.prototype.setPriority=function(e,t){var i=this.setProperty("priority",e,t);this._updateAriaAdditionalInfo();return i};u.prototype.setAuthorPicture=function(e,t){var i=this.setProperty("authorPicture",e,t);this._getAuthorImage().setSrc(e);return i};u.prototype.onBeforeRendering=function(){this._updateAriaAdditionalInfo();this._deregisterResize()};u.prototype.onAfterRendering=function(){this._registerResize()};u.prototype.onfocusin=function(e){i.prototype.onfocusin.apply(this,arguments);if(!t.browser.msie){return}var s=e.target;if(s!==this.getDomRef()&&!s.classList.contains("sapMBtn")){e.preventDefault();e.stopImmediatePropagation();this.focus()}};u.prototype.exit=function(){this._deregisterResize();if(this._ariaDetailsText){this._ariaDetailsText.destroy();this._ariaDetailsText=null}};u.prototype._getDescriptionText=function(){var e=this.getAggregation("_bodyText");if(!e){e=new n({id:this.getId()+"-body",text:this.getDescription(),maxLines:2}).addStyleClass("sapMNLI-Text");this.setAggregation("_bodyText",e,true)}return e};u.prototype._activeHandling=function(){this.$().toggleClass("sapMNLIActive",this._active)};u.prototype._updateAriaAdditionalInfo=function(){var e=sap.ui.getCore().getLibraryResourceBundle("sap.m");var t=this.getUnread()?e.getText("NOTIFICATION_LIST_ITEM_UNREAD"):e.getText("NOTIFICATION_LIST_ITEM_READ");var i=e.getText("NOTIFICATION_LIST_ITEM_DATETIME_PRIORITY",[this.getDatetime(),this.getPriority()]);var s=this.getAuthorName();var r=t+" ";if(s){r+=e.getText("NOTIFICATION_LIST_ITEM_CREATED_BY")+" "+this.getAuthorName()+" "}r+=i;this._ariaDetailsText.setText(r)};u.prototype._canTruncate=function(){var e=this.getDomRef("title-inner").scrollHeight,t=this.$("title").parent().height();if(e>t){return true}if(this.getDomRef("body-inner")){var i=this.getDomRef("body-inner").scrollHeight,s=this.$("body").parent().height();if(i>s){return true}}return false};u.prototype._showHideTruncateButton=function(){var e=this.getDomRef(),t=sap.ui.getCore(),i,s,r;if(!e){return}i=e.querySelector(".sapMNLI-Header");s=e.querySelector(".sapMNLI-TextWrapper");r=this.getDomRef("expandCollapseButton");if(this._canTruncate()&&!this.getHideShowMoreButton()){if(r){r.classList.remove("sapMNLI-CollapseButtonHide")}if(this.getTruncate()){this.getAggregation("_collapseButton").setText(this._expandText);if(i){i.classList.remove("sapMNLI-TitleWrapper--is-expanded")}if(this.getDescription()&&s){s.classList.remove("sapMNLI-TextWrapper--is-expanded")}}else{this.getAggregation("_collapseButton").setText(this._collapseText);this.$().find(".sapMNLI-TextWrapper").toggleClass("sapMNLI-TextWrapper--is-expanded",!!this.getDescription());if(i){i.classList.add("sapMNLI-TitleWrapper--is-expanded")}}}else if(r){r.classList.add("sapMNLI-CollapseButtonHide")}if(this.getDescription()&&s){s.classList.remove("sapMNLI-TextWrapper--initial-overwrite")}if(this.getTitle()&&i){i.classList.remove("sapMNLI-TitleWrapper--initial-overwrite")}t.detachThemeChanged(this._showHideTruncateButton,this)};u.prototype._deregisterResize=function(){if(this._sNotificationResizeHandler){a.deregister(this._sNotificationResizeHandler);this._sNotificationResizeHandler=null}};u.prototype._registerResize=function(){var e=this;var t=this.getDomRef();if(!t){return}e._resizeNotification();this._sNotificationResizeHandler=a.register(t,function(){e._resizeNotification()})};u.prototype._resizeNotification=function(){var e=this.getDomRef(),t=e.querySelector(".sapMNLI-TextWrapper"),i=e.querySelector(".sapMNLI-Header"),s=sap.ui.getCore();if(e.offsetWidth>=640){e.classList.add("sapMNLI-LSize")}else{e.classList.remove("sapMNLI-LSize")}if(t){t.classList.remove("sapMNLI-TextWrapper--is-expanded");t.classList.add("sapMNLI-TextWrapper--initial-overwrite")}i.classList.remove("sapMNLI-TitleWrapper--is-expanded");i.classList.add("sapMNLI-TitleWrapper--initial-overwrite");if(s.isThemeApplied()){this._showHideTruncateButton()}else{s.attachThemeChanged(this._showHideTruncateButton,this)}};return u});