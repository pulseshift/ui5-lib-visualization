/*!
 * OpenUI5
 * (c) Copyright 2009-2019 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/Device","sap/ui/base/Object","sap/ui/core/ValueStateSupport","sap/ui/core/Popup","sap/ui/core/library","sap/ui/thirdparty/jquery","sap/ui/dom/jquery/Aria"],function(e,t,o,s,a,i){"use strict";var n=a.ValueState;var r=t.extend("sap.m.delegate.ValueState",{constructor:function(e){t.apply(this,arguments);this._oControl=e;this._oPopup=null}});r.prototype.open=function(){var t=this._oControl,o=this.getPopup(),a=this.createDom(),n=s.Dock,r=i(t.getDomRefForValueStateMessage());if(!t||!o||!a){return}o.setContent(a);o.close(0);if(o.getContent()){o.getContent().style.maxWidth=t.getDomRef().offsetWidth+"px"}else{o.getContent().style.maxWidth=""}o.open(this.getOpenDuration(),n.BeginTop,n.BeginBottom,t.getDomRefForValueStateMessage(),null,null,e.system.phone?true:s.CLOSE_ON_SCROLL);var p=i(a);if(r.offset().top<p.offset().top){p.addClass("sapMValueStateMessageBottom")}else{p.addClass("sapMValueStateMessageTop")}i(t.getFocusDomRef()).addAriaDescribedBy(this.getId())};r.prototype.close=function(){var e=this._oControl,t=this._oPopup;if(t){t.close(0)}if(e){i(e.getFocusDomRef()).removeAriaDescribedBy(this.getId())}};r.prototype.getId=function(){var e=this._oControl;if(!e){return""}return typeof e.getValueStateMessageId==="function"?e.getValueStateMessageId():e.getId()+"-message"};r.prototype.getOpenDuration=function(){var e=this._oControl;if(!e){return 0}return e.iOpenMessagePopupDuration===undefined?0:e.iOpenMessagePopupDuration};r.prototype.createPopup=function(e){e=e||this.getId();if(this._oPopup){return this._oPopup}this._oPopup=new s(document.createElement("span"),false,false,false);this._oPopup.attachClosed(function(){i(document.getElementById(e)).remove()});this._oPopup.attachOpened(function(){var e=this._oPopup.getContent();if(e&&this._oControl){e.style.zIndex=this._getCorrectZIndex()}}.bind(this));return this._oPopup};r.prototype.getPopup=function(){if(!this._oControl){return null}return this.createPopup()};r.prototype.createDom=function(){var t=this._oControl;if(!t){return null}var s=t.getValueState(),a=t.getValueStateText()||o.getAdditionalText(t),i="sapMValueStateMessage sapMValueStateMessage"+s,r=sap.ui.getCore().getLibraryResourceBundle("sap.m");if(s===n.Success||s===n.None){i="sapUiInvisibleText";a=""}var p=this.getId();var u=document.createElement("div");u.id=p;u.className=i;u.setAttribute("role","tooltip");u.setAttribute("aria-live","assertive");var l=document.createElement("span");l.id=p+"hidden";var d=e.browser.msie;if(d){l.className="sapUiHidden";l.setAttribute("aria-hidden","true")}else{l.className="sapUiPseudoInvisibleText"}if(s!==n.None){l.appendChild(document.createTextNode(r.getText("INPUTBASE_VALUE_STATE_"+s.toUpperCase())))}var c=document.createElement("span");c.id=p+"-text";if(!t.isA("sap.m.Select")&&d){c.setAttribute("aria-hidden","true")}c.appendChild(document.createTextNode(a));u.appendChild(l);u.appendChild(c);return u};r.prototype.destroy=function(){if(this._oPopup){this._oPopup.destroy();this._oPopup=null}this._oControl=null};r.prototype._getCorrectZIndex=function(){var e=this._oControl.$().parents().filter(function(){var e=i(this).css("z-index");return e&&e!=="auto"&&e!=="0"});if(!e.length){return 1}var t=0;e.each(function(){var e=parseInt(i(this).css("z-index"));if(e>t){t=e}});return t+1};return r});