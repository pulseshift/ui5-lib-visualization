sap.ui.define(["sap/ui/core/Control","sap/ui/core/format/DateFormat","./ChartAxis","./ChartAxisLabel","./libs/lodash.debounce","./libs/lodash.isequal","./libs/c3","./library","sap/ui/thirdparty/d3"],function(e,t,i,s,a,r,n,l){return e.extend("ui5.viz.Chart",{metadata:{library:"ui5.viz",properties:{dataVisible:{type:"boolean",group:"Appearance",defaultValue:true},width:{type:"sap.ui.core.CSSSize",group:"Appearance",defaultValue:"100%"},height:{type:"sap.ui.core.CSSSize",group:"Appearance",defaultValue:"360px"},showSubchart:{type:"boolean",group:"Appearance",defaultValue:false},microMode:{type:"boolean",group:"Appearance",defaultValue:false},zoomEnabled:{type:"boolean",group:"Appearance",defaultValue:false},clipZoomOverflow:{type:"boolean",group:"Appearance",defaultValue:true},showDataPoints:{type:"boolean",group:"Appearance",defaultValue:true},backgroundColor:{type:"sap.ui.core.CSSColor",group:"Appearance",defaultValue:"transparent"},legendPosition:{type:"ui5.viz.ChartLegendPosition",group:"Appearance",defaultValue:l.ChartLegendPosition.Right},showLegend:{type:"boolean",group:"Appearance",defaultValue:false},showTooltip:{type:"boolean",group:"Appearance",defaultValue:false},groupedTooltip:{type:"boolean",group:"Appearance",defaultValue:false},switchAxisPosition:{type:"boolean",group:"Appearance",defaultValue:false},xAxisType:{type:"ui5.viz.AxisType",group:"Data",defaultValue:l.AxisType.Category}},aggregations:{xAxis:{type:"ui5.viz.ChartAxis",multiple:false},yAxis:{type:"ui5.viz.ChartAxis",multiple:false},y2Axis:{type:"ui5.viz.ChartAxis",multiple:false},colors:{type:"ui5.viz.Color",multiple:true},lines:{type:"ui5.viz.ChartLine",multiple:true},areas:{type:"ui5.viz.ChartArea",multiple:true},series:{type:"ui5.viz.ChartSeries",multiple:true}},defaultAggregation:"series",associations:{},events:{chartDataUpdate:{parameters:{}}}},_chart:null,_haltCount:0,_initChartUpdateHandler(){const e=this;e._haltCount=0},_getChartUpdateHandler(){const e=this;return{halt(){++e._haltCount;if(e._haltCount!==0){e.setBusy(true)}},release(){--e._haltCount;if(e._haltCount===0){e.setBusy(false)}},isHalted(){return e._haltCount!==0}}},_seriesNumberCount:0,_initNumberRangeCreator(){const e=this;e._seriesNumberCount=0},_getNumberRangeCreator(){const e=this;return{getNext(){return e._seriesNumberCount++}}},_debounceUpdate:null,_debounceUpdateChartLines:null,_debounceUpdateChartAreas:null,CSS_CLASS:"ui5-viz-chart",CSS_CLASS_NOCLIP:"ui5-viz-chart-noclippath",CSS_HIGHLIGHT_PULSATE:"ui5-viz-chart-point-highlight-pulsate",CSS_CLASS_LINE:"ui5-viz-chart-line",CSS_CLASS_LINE_SHOWSELECTOR:"ui5-viz-chart-line-selector-visible",CSS_CLASS_LINE_ICONONLY:"ui5-viz-chart-line-selector-icononly",CSS_CLASS_AREA:"ui5-viz-chart-area",CSS_CLASS_NO_POINTS:"ui5-viz-chart-hide-data-points",CSS_CLASS_MICRO_MODE:"ui5-viz-chart-micro-mode",init(){this._initNumberRangeCreator();this._initChartUpdateHandler();this._chart=null;this._getChartUpdateHandler().halt();this._debounceUpdate=a(this._onDataUpdate,10);this._debounceUpdateChartLines=a(this._updateChartLines,50);this._debounceUpdateChartAreas=a(this._updateChartAreas,50)},constructor(){e.prototype.constructor.apply(this,arguments);this._getChartUpdateHandler().release()},onBeforeRendering(){this._getChartUpdateHandler().halt();if(this._chart){this._chart.destroy()}},renderer(e,t){e.write("<div");e.writeControlData(t);e.addClass(t.CSS_CLASS);e.writeClasses();e.write(">");e.write("</div>")},onAfterRendering(){if(!this.getDomRef()){return}const e=this.getXAxis();const i=this.getYAxis();const s=this.getY2Axis();const a=this.getSeries();const r=this.getId();let o=[];if(this.getMicroMode()){const t=true;e.setProperty("visible",false,t);i.setProperty("visible",false,t);s.setProperty("visible",false,t)}const h={bindto:`#${r}`,size:{width:this.getWidth(),height:this.getHeigth()-(e.getShowTitle()&&e.getVisible()&&e.getTitle()?15:0)},padding:{top:this.getMicroMode()?0:undefined,bottom:e.getShowTitle()&&e.getVisible()&&e.getTitle()?15:undefined,left:this.getMicroMode()?0:undefined,right:this.getMicroMode()?0:undefined},subchart:{show:this.getShowSubchart()},zoom:{enabled:this.getZoomEnabled()},legend:{position:this.getLegendPosition().toLowerCase(),show:this.getShowLegend()},tooltip:{show:this.getShowTooltip(),grouped:this.getGroupedTooltip(),format:{value:(e,t,i,s)=>{const r=a.find(e=>e.getKey()===i);const n=r?r.getData()[s]:null;const l=n?n.getTooltipLabel():null;const o=n?n.getLabel():null;const h=l||o||e;return h},title:(()=>{switch(this.getXAxisType()){case l.AxisType.Time:return e=>{return t.getInstance({style:"long"}).format(e)};case l.AxisType.Indexed:case l.AxisType.Category:default:return e=>{const t=this.getXAxisLabelByIndex(e);const i=t.getTitle()===""?t.getValue():t.getTitle();return t&&t.getVisible()?i:undefined}}})()}},line:{connectNull:true},data:{x:"x",columns:[["x",...e.getLabels().map((e,t)=>{const i=e.getValue();switch(this.getXAxisType()){case l.AxisType.Time:return/^\d{4}-\d{2}-\d{2}$/.test(i)?i:undefined;case l.AxisType.Indexed:return parseFloat(i)||t;case l.AxisType.Category:default:return i}})],...a.map(e=>{let t=e.getData().map((t,i)=>{let s=t.getVisible();if(s&&t.getHighlightAnimation()!==l.DataPointAnimation.None){o.push({series:e.getKey(),point:i,animation:t.getHighlightAnimation()})}return t.getValueOrValuePair()})||[];t.unshift(e.getKey());return t})],axes:a.length===0?[]:a.reduce((e,t)=>{e[t.getKey()]=t.getYAxis().toLowerCase();return e},{}),types:a.length===0?[]:a.reduce((e,t)=>{e[t.getKey()]=t.getType();return e},{}),names:a.length===0?[]:a.reduce((e,t)=>{e[t.getKey()]=t.getName()||t.getKey();return e},{}),colors:a.length===0?[]:a.reduce((e,t)=>{if(t.getColor()){e[t.getKey()]=t.getColor()}return e},{}),labels:{format:a.length===0?[]:a.reduce((e,t)=>{e[t.getKey()]=(e,i,s)=>{const a=t.getData()[s]?t.getData()[s].getLabel():null;const r=a?a:e;return t.getShowLabels()?r:null};return e},{})},groups:a.length===0?[]:a.reduce((e,t)=>{if(t&&t.getGroupKey()&&!e.includes(t.getGroupKey())){e.push(t.getGroupKey())}return e},[]).map(e=>{return a.filter(t=>t.getGroupKey()===e).map(e=>e.getKey())})},color:{pattern:this.getColors().map(e=>e.getColor()).concat(l.ColorPalette.custom?l.ColorPalette.custom:l.ColorPalette.Material300)},axis:{rotated:this.getSwitchAxisPosition(),x:{show:e.getVisible(),type:(()=>{switch(this.getXAxisType()){case l.AxisType.Time:return"timeseries";case l.AxisType.Indexed:return"indexed";case l.AxisType.Category:default:return"category"}})(),categories:this.getXAxisType()===l.AxisType.Category?e.getLabels().map(e=>e.getValue()):undefined,max:this.getMaxValueByAxis(e),min:this.getMinValueByAxis(e),tick:{centered:false,values:e.getAutoTickValues()===false&&e.getLabels().length>0?e.getLabels().map((e,t)=>{const i=e.getValue();switch(this.getXAxisType()){case l.AxisType.Time:return/^\d{4}-\d{2}-\d{2}$/.test(i)?i:undefined;case l.AxisType.Indexed:return parseFloat(i)||0;case l.AxisType.Category:default:return t}}):undefined,format:(()=>{switch(this.getXAxisType()){case l.AxisType.Time:return e=>{return t.getInstance({pattern:"MMM yyyy"}).format(e)};case l.AxisType.Indexed:case l.AxisType.Category:default:return e=>{const t=this.getXAxisLabelByIndex(e);const i=t.getTitle()===""?t.getValue():t.getTitle();return t&&t.getVisible()?i:undefined}}})()},label:{text:e.getShowTitle()?e.getTitle():null,position:"outer-center"}},y:{show:i.getVisible(),max:this.getMaxValueByAxis(i),min:this.getMinValueByAxis(i),padding:{top:this.getMicroMode()?undefined:0,bottom:this.getMicroMode()?undefined:0},default:[i.getMinValue()||i.getLabels().filter(e=>e.getVisible()).reduce((e,t)=>Math.min(e===undefined?Infinity:e,parseFloat(t.getValue())),undefined),i.getMaxValue()||i.getLabels().filter(e=>e.getVisible()).reduce((e,t)=>Math.max(e===undefined?-Infinity:e,parseFloat(t.getValue())),undefined)],tick:{values:i.getAutoTickValues()===false&&i.getLabels().filter(e=>e.getVisible()).length>0?i.getLabels().filter(e=>e.getVisible()).map(e=>parseFloat(e.getValue())||0):undefined,format:e=>{const t=i.getLabels().filter(e=>e.getVisible()).find(t=>parseFloat(t.getValue())===e);if(!t){return e}const s=t.getTitle()===""?t.getValue():t.getTitle();return t.getVisible()?s:undefined}},label:{text:i.getShowTitle()?i.getTitle():null,position:"outer-middle"}},y2:{show:s.getVisible(),max:this.getMaxValueByAxis(s),min:this.getMinValueByAxis(s),padding:{top:0,bottom:0},default:[s.getMinValue()||s.getLabels().filter(e=>e.getVisible()).reduce((e,t)=>Math.min(e===undefined?Infinity:e,parseFloat(t.getValue())),undefined),s.getMaxValue()||s.getLabels().filter(e=>e.getVisible()).reduce((e,t)=>Math.max(e===undefined?-Infinity:e,parseFloat(t.getValue())),undefined)],tick:{values:s.getAutoTickValues()===false&&s.getLabels().filter(e=>e.getVisible()).length>0?s.getLabels().filter(e=>e.getVisible()).map(e=>parseFloat(e.getValue())||null):undefined,format:e=>{const t=s.getLabels().filter(e=>e.getVisible()).find(t=>parseFloat(t.getValue())===e);if(!t){return e}const i=t.getTitle()===""?t.getValue():t.getTitle();return t.getVisible()?i:undefined}},label:{text:s.getShowTitle()?s.getTitle():null,position:"outer-middle"}}},grid:{x:{show:e.getShowGridLines(),lines:this.getLines().filter(e=>e.getVisible()&&e.getAxis()===l.Axis.X).map(e=>{return this._mapChartLineToC3Line(e)})},y:{show:i.getShowGridLines(),lines:this.getLines().filter(e=>e.getVisible()&&e.getAxis()!==l.Axis.X).map(e=>{return this._mapChartLineToC3Line(e)})}},regions:this.getAreas().filter(e=>e.getVisible()).map(e=>{return{id:e.getId(),start:e.getStartValue(),end:e.getEndValue(),axis:e.getAxis().toLowerCase(),text:e.getTitle(),class:this.CSS_CLASS_AREA+" "+this.CSS_CLASS_AREA+"-"+e.getId()}}),transition:{duration:175}};this._chart=n.generate(h);d3.selectAll(`#${r} g.c3-circles circle.c3-circle`).classed(this.CSS_HIGHLIGHT_PULSATE,false);if(o.length>0){o.forEach(e=>{d3.select(`#${r} g.c3-circles-${e.series} circle.c3-circle-${e.point}`).classed(this.CSS_HIGHLIGHT_PULSATE,true)})}this._updateSeriesStyles();this._updateLineStyles();this._updateAreaStyles();if(this.getClipZoomOverflow()){this.removeStyleClass(this.CSS_CLASS_NOCLIP)}else{this.addStyleClass(this.CSS_CLASS_NOCLIP)}if(this.getDomRef())$(this.getDomRef()).css("background-color",this.getBackgroundColor());$(window).resize(this._resize.bind(this));setTimeout(()=>{this._resize()},150);setTimeout(()=>{this._resize()},1500);this._getChartUpdateHandler().release()},exit(){},setDataVisible(e){if(this._chart)e?this._chart.show():this._chart.hide();return this.setProperty("dataVisible",e,true)},setWidth(e){this.setProperty("width",e,true);this._chart?this._chart.resize({width:this.getWidth()}):undefined;return this},setHeight(e){this.setProperty("height",e,true);this._chart?this._chart.resize({height:this.getHeigth()}):undefined;return this},getWidth(){return this._getComputedSize(this.getProperty("width"),"width")},getHeigth(){return this._getComputedSize(this.getProperty("height"),"height")},setShowSubchart(e){return this.setProperty("showSubchart",e,false)},setMicroMode(e){if(e){this.addStyleClass(this.CSS_CLASS_MICRO_MODE)}else{this.removeStyleClass(this.CSS_CLASS_MICRO_MODE)}return this.setProperty("microMode",e,false)},setZoomEnabled(e){if(this._chart)this._chart.zoom.enable(e);return this.setProperty("zoomEnabled",e,true)},setClipZoomOverflow(e){if(e){this.removeStyleClass(this.CSS_CLASS_NOCLIP)}else{this.addStyleClass(this.CSS_CLASS_NOCLIP)}return this.setProperty("clipZoomOverflow",e,true)},setShowDataPoints(e){if(e){this.removeStyleClass(this.CSS_CLASS_NO_POINTS)}else{this.addStyleClass(this.CSS_CLASS_NO_POINTS)}return this.setProperty("showDataPoints",e,true)},setBackgroundColor(e){if(this.getDomRef())$(this.getDomRef()).css("background-color",e);return this.setProperty("backgroundColor",e,true)},setLegendPosition(e){return this.setProperty("legendPosition",e,false)},setShowLegend(e){if(this._chart)e?this._chart.legend.show():this._chart.legend.hide();return this.setProperty("showLegend",e,true)},setShowTooltip(e){return this.setProperty("showTooltip",e,false)},setGroupedTooltip(e){return this.setProperty("groupedTooltip",e,false)},setSwitchAxisPosition(e){return this.setProperty("switchAxisPosition",e,false)},setXAxisType(e){return this.setProperty("xAxisType",e,false)},getXAxis(){let e;e=this.getAggregation("xAxis");if(!e){e=new i;this.setAggregation("xAxis",e,true)}return e},getYAxis(){let e;e=this.getAggregation("yAxis");if(!e){e=new i;this.setAggregation("yAxis",e,true)}return e},getY2Axis(){let e;e=this.getAggregation("y2Axis");if(!e){e=new i({visible:false});this.setAggregation("y2Axis",e,true)}return e},setAggregation(t,i,s){if(i){switch(t){case"xAxis":i.setProperty("_axisType",l.Axis.X,true);break;case"yAxis":i.setProperty("_axisType",l.Axis.Y,true);break;case"y2Axis":i.setProperty("_axisType",l.Axis.Y2,true);break;default:break}}if(["xAxis","yAxis","y2Axis"].includes(t)){e.prototype.setAggregation.call(this,t,i,false);if(i){i.attachAxisUpdate(e=>this._onDataUpdateByCode(e.getParameter("code")))}}else{e.prototype.setAggregation.call(this,t,i,s)}return this},insertAggregation(t,i,s,a){if(t==="series"&&!i.getKey()){i.setKey(this._getNumberRangeCreator().getNext())}if(["lines","areas"].includes(t)){e.prototype.insertAggregation.call(this,t,i,s,true);switch(t){case"lines":i.attachLineUpdate(e=>this._onDataUpdateByCode(e.getParameter("code")));this._onDataUpdateByCode(l.ChartUpdateCode.Line);break;case"areas":i.attachAreaUpdate(e=>this._onDataUpdateByCode(e.getParameter("code")));this._onDataUpdateByCode(l.ChartUpdateCode.Area);break;default:break}}else{e.prototype.insertAggregation.call(this,t,i,s,a)}return this},addAggregation(t,i,s){if(t==="series"&&!i.getKey()){i.setKey(this._getNumberRangeCreator().getNext())}if(["lines","areas"].includes(t)){e.prototype.addAggregation.call(this,t,i,true);switch(t){case"lines":i.attachLineUpdate(e=>this._onDataUpdateByCode(e.getParameter("code")));this._onDataUpdateByCode(l.ChartUpdateCode.Line);break;case"areas":i.attachAreaUpdate(e=>this._onDataUpdateByCode(e.getParameter("code")));this._onDataUpdateByCode(l.ChartUpdateCode.Area);break;default:break}}else{e.prototype.addAggregation.call(this,t,i,s)}return this},removeAggregation(t,i,s){if(["series","lines","areas"].includes(t)){e.prototype.removeAggregation.call(this,t,i,true);switch(t){case"series":this._onDataUpdateByCode(l.ChartUpdateCode.DataPoint);break;case"lines":this._onDataUpdateByCode(l.ChartUpdateCode.Line);break;case"areas":this._onDataUpdateByCode(l.ChartUpdateCode.Area);break;default:break}}else{e.prototype.removeAggregation.call(this,t,i,s)}return this},removeAllAggregation(t,i){if(["series","lines","areas"].includes(t)){e.prototype.removeAllAggregation.call(this,t,true);switch(t){case"series":this._onDataUpdateByCode(l.ChartUpdateCode.DataPoint);break;case"lines":this._onDataUpdateByCode(l.ChartUpdateCode.Line);break;case"areas":this._onDataUpdateByCode(l.ChartUpdateCode.Area);break;default:break}}else{e.prototype.removeAllAggregation.call(this,t,i)}return this},destroyAggregation(t,i){if(["series","lines","areas"].includes(t)){e.prototype.destroyAggregation.call(this,t,true);switch(t){case"series":this._onDataUpdateByCode(l.ChartUpdateCode.DataPoint);break;case"lines":this._onDataUpdateByCode(l.ChartUpdateCode.Line);break;case"areas":this._onDataUpdateByCode(l.ChartUpdateCode.Area);break;default:break}}else{e.prototype.destroyAggregation.call(this,t,i)}return this},setModel(){this._getChartUpdateHandler().halt();e.prototype.setModel.apply(this,arguments);this._getChartUpdateHandler().release();this._onDataUpdateByCode();return this},getXAxisLabelByIndex(e){const t=this.getXAxis();const i=this.getXAxisType();const a=t.getLabels();const r=i===l.AxisType.Indexed?a.find(t=>parseFloat(t.getValue())===e):a[e];return r||new s({visible:false})},getXAxisIndexByValue(e){const t=this.getXAxis();const i=this.getXAxisType();const s=t.getLabels()||[];const a=s.length;if(i===l.AxisType.Indexed){return parseFloat(e)||null}for(let t=0;t<a;t++){const i=s[t];if(i.getValue()===e){return t}}return null},getMinValueByAxis(e){const t=this.getXAxisType();const i=e.getProperty("_axisType");const s=i===l.Axis.X;const a=e.getMinValue();const r=parseFloat(a);const n=r===0;if(s){switch(t){case l.AxisType.Time:return/^\d{4}-\d{2}-\d{2}$/.test(a)?a:undefined;case l.AxisType.Indexed:case l.AxisType.Category:default:return n?r:r||undefined}}return n?r:r||undefined},getMaxValueByAxis(e){const t=this.getXAxisType();const i=e.getProperty("_axisType");const s=i===l.Axis.X;const a=e.getMaxValue();const r=parseFloat(a);const n=r===0;if(s){switch(t){case l.AxisType.Time:return/^\d{4}-\d{2}-\d{2}$/.test(a)?a:undefined;case l.AxisType.Indexed:case l.AxisType.Category:default:return n?r:r||undefined}}return n?r:r||undefined},_onDataUpdateByCode(e){if(this._getChartUpdateHandler().isHalted()){return}else if(!this.getDomRef()){return}else if(!this._chart){this.rerender();return}switch(e){case l.ChartUpdateCode.Line:this._debounceUpdateChartLines();this.fireChartDataUpdate();break;case l.ChartUpdateCode.Area:this._debounceUpdateChartAreas();this.fireChartDataUpdate();break;default:this._debounceUpdate();this.fireChartDataUpdate();break}},_onDataUpdate(){if(!this.getDomRef()){return}const t=this.getId();const i=this.getSeries();const s=i.map(e=>e.getKey());const a=s.filter(e=>this._chart.data().map(e=>e.id).every(t=>t===e)===false);const r=this._chart.data().map(e=>e.id).filter(e=>s.some(t=>t===e)===false);const n=[];const o=this.getXAxis();const h=this.getYAxis();const d=this.getY2Axis();if(a.length>0||r.length>0){this.rerender();return}e.prototype.setProperty.call(o,"visible",!this.getMicroMode(),true);e.prototype.setProperty.call(h,"visible",!this.getMicroMode(),true);e.prototype.setProperty.call(d,"visible",!this.getMicroMode(),true);this._chart.internal.config.axis_x_tick_values=o.getAutoTickValues()===false&&o.getLabels().length>0?o.getLabels().map((e,t)=>{var i=e.getValue();switch(this.getXAxisType()){case l.AxisType.Time:return/^\d{4}-\d{2}-\d{2}$/.test(i)?i:undefined;case l.AxisType.Indexed:return parseFloat(i)||0;case l.AxisType.Category:default:return t}}):undefined;const g={x:"x",columns:[["x",...o.getLabels().map(e=>e.getValue())],...i.map(e=>[e.getKey(),...e.getData().map((t,i)=>{let s=t.getVisible();if(s&&t.getHighlightAnimation()!==l.DataPointAnimation.None){n.push({series:e.getKey(),point:i,animation:t.getHighlightAnimation()})}return t.getValueOrValuePair()})])],axes:i.length===0?[]:i.reduce((e,t)=>{e[t.getKey()]=t.getYAxis().toLowerCase();return e},{}),types:i.length===0?[]:i.reduce((e,t)=>{e[t.getKey()]=t.getType();return e},{}),names:i.length===0?[]:i.reduce((e,t)=>{e[t.getKey()]=t.getName()||t.getKey();return e},{}),colors:i.length===0?[]:i.reduce((e,t)=>{if(t.getColor()){e[t.getKey()]=t.getColor()}return e},{}),unload:r};this._chart.load(g);d3.selectAll(`#${t} g.c3-circles circle.c3-circle`).classed(this.CSS_HIGHLIGHT_PULSATE,false);if(n.length>0){n.forEach(e=>{d3.select(`#${t} g.c3-circles-${e.series} circle.c3-circle-${e.point}`).classed(this.CSS_HIGHLIGHT_PULSATE,true)})}this._chart.groups(i.length===0?[]:i.reduce((e,t)=>{if(t&&t.getGroupKey()&&!e.includes(t.getGroupKey())){e.push(t.getGroupKey())}return e},[]).map(e=>{return i.filter(t=>t.getGroupKey()===e).map(e=>e.getKey())}));this._updateSeriesStyles();this._chart.axis.labels({x:o.getShowTitle()?o.getTitle():null,y:h.getShowTitle()?h.getTitle():null,y2:d.getShowTitle()?d.getTitle():null});this._chart.axis.showX(o.getVisible());this._chart.axis.showY(h.getVisible());this._chart.axis.showY2(d.getVisible());this._chart.axis.range({min:{X:this.getMinValueByAxis(o),y:this.getMinValueByAxis(h),y2:this.getMinValueByAxis(d)},max:{x:this.getMaxValueByAxis(o),y:this.getMaxValueByAxis(h),y2:this.getMaxValueByAxis(d)}});this.fireChartDataUpdate()},_updateChartLines(){const e=[].concat(this._chart.xgrids());const t=[].concat(this._chart.ygrids());const i=this.getLines().filter(e=>e.getVisible()&&e.getAxis()===l.Axis.X).map(e=>this._mapChartLineToC3Line(e));const s=this.getLines().filter(e=>e.getVisible()&&e.getAxis()!==l.Axis.X).map(e=>this._mapChartLineToC3Line(e));const a=i.filter(t=>{const i=e.find(e=>e.id===t.id);return i&&r(t,i)===false});if(a.length>0){this._chart.xgrids(i)}else{e.filter(e=>i.every(t=>t.id!==e.id)).forEach(e=>{this._chart.xgrids.remove({class:e.class})});const t=i.filter(t=>e.every(e=>e.id!==t.id));if(t.length>0){this._chart.xgrids.add(t)}}const n=s.filter(e=>{const i=t.find(t=>t.id===e.id);return i&&r(e,i)===false});if(n.length>0){this._chart.ygrids(s)}else{t.filter(e=>s.every(t=>t.id!==e.id)).forEach(e=>{this._chart.ygrids.remove({class:e.class})});const e=s.filter(e=>t.every(t=>t.id!==e.id));if(e.length>0){this._chart.ygrids.add(e)}}this._updateLineStyles()},_updateChartAreas(){const e=this._chart.regions()||[];const t=Array.isArray(e)?e:[e];const i=this.getAreas().filter(e=>e.getVisible()).map(e=>{return{id:e.getId(),start:e.getStartValue(),end:e.getEndValue(),axis:e.getAxis().toLowerCase(),text:e.getTitle(),class:`${this.CSS_CLASS_AREA} ${this.CSS_CLASS_AREA}-${e.getId()}`}});const s=t.filter(e=>i.every(t=>t.id!==e.id)).map(e=>`${this.CSS_CLASS_AREA}-${e.id}`);if(s.length>0){this._chart.regions.remove({classes:s})}const a=i.filter(e=>t.every(t=>t.id!==e.id));if(a.length>0){this._chart.regions.add(a)}const n=i.filter(e=>{const i=t.find(t=>t.id===e.id);return i&&r(e,i)===false});if(n.length>0){this._chart.regions(n)}this._updateAreaStyles()},_mapChartLineToC3Line(e){const t=e.getShowLineSelector()?this.CSS_CLASS_LINE_SHOWSELECTOR:"";const i=e.getSelectorIconOnly()?this.CSS_CLASS_LINE_ICONONLY:"";return{id:e.getId(),value:e.getValue(),axis:e.getAxis().toLowerCase(),text:e.getTitle(),position:e.getTitlePosition().toLowerCase(),showSelector:e.getShowLineSelector()?true:false,class:`${this.CSS_CLASS_LINE} ${this.CSS_CLASS_LINE}-${e.getStyle()} ${this.CSS_CLASS_LINE}-${e.getId()} ${t} ${i}`}},_onSeriesVisibilityUpdate(e){let t=e.getParameter("chartSeries");if(t.getVisible()){this._chart.show(t.getKey(),{withLegend:true})}else{this._chart.hide(t.getKey(),{withLegend:true})}},_updateSeriesStyles(){const e=this.getId();this.getSeries().forEach(t=>{const i=t.getKey();let s,a,r,n=this._isShapeType(t.getType())?t.getShapeStyle():l.ShapeStyle.Solid;switch(n){case l.ShapeStyle.Striped:a=this._chart.data.colors()[t.getKey()];r=d3.select(`#${e} defs #${e}-stripe-pattern-${i}`);if(r.empty()){r=d3.select(`#${e} defs`).append("pattern").attr({id:`${e}-stripe-pattern-${i}`,width:"8",height:"8",patternUnits:"userSpaceOnUse",class:`stripe-pattern-${i}`}).append("path").attr({d:"M1,0L5,0L0,5L0,1L1,0 M8,1L8,5L5,8L1,8L8,1"})}s=d3.select(`#${e} defs #${e}-stripe-style-${i}`);if(s.empty()){s=d3.select(`#${e} defs`).append("style").attr({id:`${e}-stripe-style-${i}`,type:"text/css"})}s.text(`#${e} .stripe-pattern-${i} path {\n                fill: ${a};\n                stroke: none;\n              }\n              #${e} .c3-target-${i} .c3-shape {\n                fill: url(#${e}-stripe-pattern-${i}) !important;\n              }`);break;case l.ShapeStyle.Solid:default:s=d3.select(`#${e} defs #${e}-stripe-style-${i}`);if(!s.empty()){s.text("")}break}});this.getSeries().forEach(t=>{const i=t.getKey();let s,a,r=this._isLineType(t.getType())?t.getLineStyle():l.LineStyle.Solid,n;switch(t.getLineAnimationSpeed()){case l.AnimationSpeed.Fast:n=20;break;case l.AnimationSpeed.Medium:n=50;break;case l.AnimationSpeed.Slow:n=150;break;case l.AnimationSpeed.None:default:n=0;break}switch(r){case l.LineStyle.Dashed:case l.LineStyle.Dotted:a=t.getLineStyle()===l.LineStyle.Dotted?"1 5":"5";s=d3.select(`#${e} defs #${e}-dashdot-style-${i}`);if(s.empty()){s=d3.select(`#${e} defs`).append("style").attr({id:`${e}-dashdot-style-${i}`,type:"text/css"})}s.text(`#${e} .c3-target-${i} path.c3-shape {\n                                    stroke-dashoffset: ${t.getLineAnimationForwards()?"":"-"}50rem;\n                                    stroke-dasharray: ${a};\n                                    stroke-linecap: round;\n\n                                    -webkit-animation: ui5-viz-chart-dash-animation ${n}s 0s linear infinite forwards;\n                                    -moz-animation: ui5-viz-chart-dash-animation ${n}s 0s linear infinite forwards;\n                                    -ms-animation: ui5-viz-chart-dash-animation ${n}s 0s linear infinite forwards;\n                                    -o-animation: ui5-viz-chart-dash-animation ${n}s 0s linear infinite forwards;\n                                    animation: ui5-viz-chart-dash-animation ${n}s 0s linear infinite forwards;\n                                }`);break;case l.LineStyle.Solid:default:s=d3.select(`#${e} defs #${e}-dashdot-style-${i}`);if(!s.empty()){s.text("")}break}})},_updateLineStyles(){const e=this.getId();let t="",i=d3.select(`#${e} defs #${e}-line-style`);if(i.empty()){i=d3.select(`#${e} defs`).append("style").attr({id:`${e}-line-style`,type:"text/css"})}this.getLines().forEach(i=>{const s=i.getId();const a=i.getColor();const r=i.getStyle();const n=`#${e} .${this.CSS_CLASS_LINE}-${s}`;const o=`${e}-${s}`;let h;let d;if(a){t+=`${n} line {\n                stroke: ${a};\n            }\n\n            ${n} circle {\n                stroke: ${a};\n            }\n\n            ${n} text {\n                fill: ${a};\n            }`}switch(r){case l.LineStyle.Dashed:case l.LineStyle.Dotted:d=r===l.LineStyle.Dotted?"1 5":"5";h=d3.select(`#${e} defs #${o}`);if(h.empty()){h=d3.select(`#${e} defs`).append("style").attr({id:`${o}`,type:"text/css"})}h.text(`${n} line {\n                    stroke-dasharray: ${d};\n                    stroke-linecap: round;\n                }`);break;case l.LineStyle.Solid:default:h=d3.select(`#${e} defs #${o}`);if(!h.empty()){h.text("")}break}let g=d3.select(n),c=sap.ui.core.IconPool.getIconInfo(i.getLineSelectorIcon());if(i.getShowLineSelector()){g.select(".c3-grid-lines-circle-text").attr("font-family",c.fontFamily).text(c.content);g.select(".c3-grid-lines-circle-hover").on("click",function(){i.fireSelectorPress({line:i,selectorDomRef:this.previousSibling})})}else{g.select(".c3-grid-lines-circle-hover").on("click",function(){})}});i.text(t)},_updateAreaStyles(){const e=this.getId();let t="",i=d3.select(`#${e} defs #${e}-area-style`);if(i.empty()){i=d3.select(`#${e} defs`).append("style").attr({id:`${e}-area-style`,type:"text/css"})}this.getAreas().forEach(i=>{const s=i.getId();const a=i.getColor()||"#000000";const r=i.getStyle();let n;switch(r){case l.ShapeStyle.Striped:n=d3.select(`#${e} defs #${e}-area-stripe-pattern-${s}`);if(n.empty()){n=d3.select(`#${e} defs`).append("pattern").attr({id:`${e}-area-stripe-pattern-${s}`,width:"8",height:"8",patternUnits:"userSpaceOnUse",class:`area-stripe-pattern-${s}`}).append("path").attr({d:"M1,0L5,0L0,5L0,1L1,0 M8,1L8,5L5,8L1,8L8,1"})}t+=`#${e} .area-stripe-pattern-${s} path {\n                                    fill: ${a};\n                                    stroke: none;\n                                }\n                                #${e} .${this.CSS_CLASS_AREA}-${s} rect.c3-region-stripe,\n                                #${e} .${this.CSS_CLASS_AREA}-${s} text.c3-region-text {\n                                    fill: ${a};\n                                }\n                                #${e} .${this.CSS_CLASS_AREA}-${s} rect.c3-region-area {\n                                    fill: url(#${e}-area-stripe-pattern-${s}) !important;\n                                }`;break;case l.ShapeStyle.Solid:default:t+=`#${e} .${this.CSS_CLASS_AREA}-${s} rect.c3-region-stripe,\n                                #${e} .${this.CSS_CLASS_AREA}-${s} text.c3-region-text {\n                                    fill: ${a};\n                                }\n                                #${e} .${this.CSS_CLASS_AREA}-${s} rect.c3-region-area {\n                                    fill: ${a};\n                                }`;break}});i.text(t)},_isShapeType(e){let t=false;switch(e){case l.ChartSeriesType.Bar:t=true;break;default:t=false;break}return t},_isLineType(e){let t=false;switch(e){case l.ChartSeriesType.Line:case l.ChartSeriesType.Spline:case l.ChartSeriesType.Step:case l.ChartSeriesType.AreaLine:case l.ChartSeriesType.AreaSpline:case l.ChartSeriesType.AreaStep:case l.ChartSeriesType.RibbonLine:case l.ChartSeriesType.RibbonSpline:case l.ChartSeriesType.RibbonStep:t=true;break;default:t=false;break}return t},_isRibbonType(e){return e===(l.ChartSeriesType.RibbonLine||l.ChartSeriesType.RibbonSpline||l.ChartSeriesType.RibbonStep)},_getAvailableSize(e){var t=0;e=e==="width"||e==="height"?e:"width";if(this.getDomRef()){if(e==="width"){t+=parseInt(getComputedStyle(this.getDomRef(),"").marginLeft.match(/(\d*(\.\d*)?)/,10)[1])||0;t+=parseInt(getComputedStyle(this.getDomRef(),"").marginRight.match(/(\d*(\.\d*)?)/,10)[1])||0}else{t+=parseInt(getComputedStyle(this.getDomRef(),"").marginTop.match(/(\d*(\.\d*)?)/,10)[1])||0;t+=parseInt(getComputedStyle(this.getDomRef(),"").marginBottom.match(/(\d*(\.\d*)?)/,10)[1])||0}}return $(this._getParentDomRef())[e]()-t},_getComputedSize(e,t){e=e||"auto";t=t==="width"||t==="height"?t:"width";var i=l.parseCSSSize(e),s=1,a;switch(i.unit){case"rem":a=i.value*parseInt(getComputedStyle(document.body,"").fontSize.match(/(\d*(\.\d*)?)/,10)[1])||0;break;case"em":a=i.value*parseInt(getComputedStyle(this._getParentDomRef(),"").fontSize.match(/(\d*(\.\d*)?)/,10)[1])||0;break;case"px":a=i.value&&i.value>0?i.value:this._getAvailableSize(t);break;case"vw":s=(i.value&&i.value>0?i.value:100)/100;a=this._getAvailableSize("width")*s;break;case"vh":s=(i.value&&i.value>0?i.value:100)/100;a=this._getAvailableSize("height")*s;break;case"%":s=(i.value&&i.value>0?i.value:100)/100;a=this._getAvailableSize(t)*s;break;case"initial":case"inherit":case"auto":a=this._getAvailableSize(t);break;default:jQuery.sap.log.warning("CSS unit "+i.unit+' is not supported, yet. Fallback to "auto" (max. width).');a=this._getAvailableSize(t)}return a},_resize(){if(this._chart){this._chart.resize({width:this.getWidth(),height:this.getHeigth()})}return this},_getParentDomRef(){var e=this.getDomRef()?this.getDomRef().parentNode:document.body;return e?e:document.body}})},true);