"use strict";function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?Array.from(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?_arrayLikeToArray(e,t):void 0}}function _iterableToArray(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,a=new Array(t);i<t;i++)a[i]=e[i];return a}sap.ui.define(["sap/ui/core/Control","sap/ui/core/format/DateFormat","./ChartAxis","./ChartAxisLabel","./libs/lodash.debounce","./libs/lodash.isequal","./libs/lodash.defer","./libs/d3","./libs/c3","./library"],function(h,o,t,r,e,c,d){var g=7<arguments.length&&void 0!==arguments[7]?arguments[7]:window.d3,l=8<arguments.length&&void 0!==arguments[8]?arguments[8]:window.c3,p=9<arguments.length?arguments[9]:void 0;return h.extend("ui5.viz.Chart",{metadata:{library:"ui5.viz",properties:{dataVisible:{type:"boolean",group:"Appearance",defaultValue:!0},width:{type:"sap.ui.core.CSSSize",group:"Appearance",defaultValue:"100%"},height:{type:"sap.ui.core.CSSSize",group:"Appearance",defaultValue:"360px"},showSubchart:{type:"boolean",group:"Appearance",defaultValue:!1},microMode:{type:"boolean",group:"Appearance",defaultValue:!1},zoomEnabled:{type:"boolean",group:"Appearance",defaultValue:!1},clipZoomOverflow:{type:"boolean",group:"Appearance",defaultValue:!0},showDataPoints:{type:"boolean",group:"Appearance",defaultValue:!0},backgroundColor:{type:"sap.ui.core.CSSColor",group:"Appearance",defaultValue:"transparent"},legendPosition:{type:"ui5.viz.ChartLegendPosition",group:"Appearance",defaultValue:p.ChartLegendPosition.Right},showLegend:{type:"boolean",group:"Appearance",defaultValue:!1},showTooltip:{type:"boolean",group:"Appearance",defaultValue:!1},groupedTooltip:{type:"boolean",group:"Appearance",defaultValue:!1},switchAxisPosition:{type:"boolean",group:"Appearance",defaultValue:!1},xAxisType:{type:"ui5.viz.AxisType",group:"Data",defaultValue:p.AxisType.Category}},aggregations:{xAxis:{type:"ui5.viz.ChartAxis",multiple:!1},yAxis:{type:"ui5.viz.ChartAxis",multiple:!1},y2Axis:{type:"ui5.viz.ChartAxis",multiple:!1},colors:{type:"ui5.viz.Color",multiple:!0},lines:{type:"ui5.viz.ChartLine",multiple:!0},areas:{type:"ui5.viz.ChartArea",multiple:!0},series:{type:"ui5.viz.ChartSeries",multiple:!0}},defaultAggregation:"series",associations:{},events:{chartDataUpdate:{parameters:{}}}},_chart:null,_haltCount:0,_initChartUpdateHandler:function(){this._haltCount=0},_getChartUpdateHandler:function(){var e=this;return{halt:function(){++e._haltCount,0!==e._haltCount&&e.setBusy(!0)},release:function(){--e._haltCount,0===e._haltCount&&e.setBusy(!1)},isHalted:function(){return 0!==e._haltCount}}},_seriesNumberCount:0,_initNumberRangeCreator:function(){this._seriesNumberCount=0},_getNumberRangeCreator:function(){var e=this;return{getNext:function(){return e._seriesNumberCount++}}},_debounceUpdate:null,_debounceUpdateChartLines:null,_debounceUpdateChartAreas:null,CSS_CLASS:"ui5-viz-chart",CSS_CLASS_NOCLIP:"ui5-viz-chart-noclippath",CSS_HIGHLIGHT_PULSATE:"ui5-viz-chart-point-highlight-pulsate",CSS_CLASS_LINE:"ui5-viz-chart-line",CSS_CLASS_LINE_SHOWSELECTOR:"ui5-viz-chart-line-selector-visible",CSS_CLASS_LINE_ICONONLY:"ui5-viz-chart-line-selector-icononly",CSS_CLASS_AREA:"ui5-viz-chart-area",CSS_CLASS_NO_POINTS:"ui5-viz-chart-hide-data-points",CSS_CLASS_MICRO_MODE:"ui5-viz-chart-micro-mode",init:function(){this._initNumberRangeCreator(),this._initChartUpdateHandler(),this._chart=null,this._getChartUpdateHandler().halt(),this._debounceUpdate=e(this._onDataUpdate,50),this._debounceUpdateChartLines=e(this._updateChartLines,50),this._debounceUpdateChartAreas=e(this._updateChartAreas,50)},constructor:function(){h.prototype.constructor.apply(this,arguments),this._getChartUpdateHandler().release()},onBeforeRendering:function(){this._getChartUpdateHandler().halt(),this._chart&&this._chart.destroy()},renderer:function(e,t){e.write("<div"),e.writeControlData(t),e.addClass(t.CSS_CLASS),e.writeClasses(),e.write(">"),e.write("</div>")},onAfterRendering:function(){var a=this;if(console.log("onAfterRendering"),this.getDomRef()){var e=this.getXAxis(),r=this.getYAxis(),n=this.getY2Axis(),c=this.getSeries(),t=this.getId(),s=[];if(this.getMicroMode()){e.setProperty("visible",!1,!0),r.setProperty("visible",!1,!0),n.setProperty("visible",!1,!0)}var i={bindto:"#".concat(t),size:{width:this.getWidth(),height:this.getHeigth()-(e.getShowTitle()&&e.getVisible()&&e.getTitle()?15:0)},padding:{top:this.getMicroMode()?0:void 0,bottom:e.getShowTitle()&&e.getVisible()&&e.getTitle()?15:void 0,left:this.getMicroMode()?0:void 0,right:this.getMicroMode()?0:void 0},subchart:{show:this.getShowSubchart()},zoom:{enabled:this.getZoomEnabled()},legend:{position:this.getLegendPosition().toLowerCase(),show:this.getShowLegend()},tooltip:{show:this.getShowTooltip(),grouped:this.getGroupedTooltip(),format:{value:function(e,t,i,a){var r=c.find(function(e){return e.getKey()===i}),n=r?r.getData()[a]:null,s=n?n.getTooltipLabel():null,o=n?n.getLabel():null;return s||o||e},title:function(){switch(a.getXAxisType()){case p.AxisType.Time:return function(e){return o.getInstance({style:"long"}).format(e)};case p.AxisType.Indexed:case p.AxisType.Category:default:return function(e){var t=a.getXAxisLabelByIndex(e),i=""===t.getTitle()?t.getValue():t.getTitle();return t&&t.getVisible()?i:void 0}}}()}},line:{connectNull:!0},data:{x:"x",columns:[["x"].concat(_toConsumableArray(e.getLabels().map(function(e,t){var i=e.getValue();switch(a.getXAxisType()){case p.AxisType.Time:return/^\d{4}-\d{2}-\d{2}$/.test(i)?i:void 0;case p.AxisType.Indexed:return parseFloat(i)||t;case p.AxisType.Category:default:return i}})))].concat(_toConsumableArray(c.map(function(i){var e=i.getData().map(function(e,t){return e.getVisible()&&e.getHighlightAnimation()!==p.DataPointAnimation.None&&s.push({series:i.getKey(),point:t,animation:e.getHighlightAnimation()}),e.getValueOrValuePair()})||[];return e.unshift(i.getKey()),e}))),axes:0===c.length?[]:c.reduce(function(e,t){return e[t.getKey()]=t.getYAxis().toLowerCase(),e},{}),types:0===c.length?[]:c.reduce(function(e,t){return e[t.getKey()]=t.getType(),e},{}),names:0===c.length?[]:c.reduce(function(e,t){return e[t.getKey()]=t.getName()||t.getKey(),e},{}),colors:0===c.length?[]:c.reduce(function(e,t){return t.getColor()&&(e[t.getKey()]=t.getColor()),e},{}),labels:{format:0===c.length?[]:c.reduce(function(e,n){return e[n.getKey()]=function(e,t,i){var a=n.getData()[i]?n.getData()[i].getLabel():null,r=a||e;return n.getShowLabels()?r:null},e},{})},groups:0===c.length?[]:c.reduce(function(e,t){return t&&t.getGroupKey()&&!e.includes(t.getGroupKey())&&e.push(t.getGroupKey()),e},[]).map(function(t){return c.filter(function(e){return e.getGroupKey()===t}).map(function(e){return e.getKey()})})},color:{pattern:this.getColors().map(function(e){return e.getColor()}).concat(p.ColorPalette.custom?p.ColorPalette.custom:p.ColorPalette.Material300)},axis:{rotated:this.getSwitchAxisPosition(),x:{show:e.getVisible(),type:function(){switch(a.getXAxisType()){case p.AxisType.Time:return"timeseries";case p.AxisType.Indexed:return"indexed";case p.AxisType.Category:default:return"category"}}(),categories:this.getXAxisType()===p.AxisType.Category?e.getLabels().map(function(e){return e.getValue()}):void 0,max:this.getMaxValueByAxis(e),min:this.getMinValueByAxis(e),tick:{multiline:!0,multilineMax:2,centered:!1,values:!1===e.getAutoTickValues()&&0<e.getLabels().length?e.getLabels().map(function(e,t){var i=e.getValue();switch(a.getXAxisType()){case p.AxisType.Time:return/^\d{4}-\d{2}-\d{2}$/.test(i)?i:void 0;case p.AxisType.Indexed:return parseFloat(i)||0;case p.AxisType.Category:default:return t}}):void 0,format:function(){switch(a.getXAxisType()){case p.AxisType.Time:return function(e){return o.getInstance({pattern:"MMM yyyy"}).format(e)};case p.AxisType.Indexed:case p.AxisType.Category:default:return function(e){var t=a.getXAxisLabelByIndex(e),i=""===t.getTitle()?t.getValue():t.getTitle();return t&&t.getVisible()?i:void 0}}}()},label:{text:e.getShowTitle()?e.getTitle():null,position:"outer-center"}},y:{show:r.getVisible(),max:this.getMaxValueByAxis(r),min:this.getMinValueByAxis(r),padding:{top:this.getMicroMode()?void 0:0,bottom:this.getMicroMode()?void 0:0},default:[r.getMinValue()||r.getLabels().filter(function(e){return e.getVisible()}).reduce(function(e,t){return Math.min(void 0===e?1/0:e,parseFloat(t.getValue()))},void 0),r.getMaxValue()||r.getLabels().filter(function(e){return e.getVisible()}).reduce(function(e,t){return Math.max(void 0===e?-1/0:e,parseFloat(t.getValue()))},void 0)],tick:{values:!1===r.getAutoTickValues()&&0<r.getLabels().filter(function(e){return e.getVisible()}).length?r.getLabels().filter(function(e){return e.getVisible()}).map(function(e){return parseFloat(e.getValue())||0}):void 0,format:function(t){var e=r.getLabels().filter(function(e){return e.getVisible()}).find(function(e){return parseFloat(e.getValue())===t});if(!e)return t;var i=""===e.getTitle()?e.getValue():e.getTitle();return e.getVisible()?i:void 0}},label:{text:r.getShowTitle()?r.getTitle():null,position:"outer-middle"}},y2:{show:n.getVisible(),max:this.getMaxValueByAxis(n),min:this.getMinValueByAxis(n),padding:{top:0,bottom:0},default:[n.getMinValue()||n.getLabels().filter(function(e){return e.getVisible()}).reduce(function(e,t){return Math.min(void 0===e?1/0:e,parseFloat(t.getValue()))},void 0),n.getMaxValue()||n.getLabels().filter(function(e){return e.getVisible()}).reduce(function(e,t){return Math.max(void 0===e?-1/0:e,parseFloat(t.getValue()))},void 0)],tick:{values:!1===n.getAutoTickValues()&&0<n.getLabels().filter(function(e){return e.getVisible()}).length?n.getLabels().filter(function(e){return e.getVisible()}).map(function(e){return parseFloat(e.getValue())||null}):void 0,format:function(t){var e=n.getLabels().filter(function(e){return e.getVisible()}).find(function(e){return parseFloat(e.getValue())===t});if(!e)return t;var i=""===e.getTitle()?e.getValue():e.getTitle();return e.getVisible()?i:void 0}},label:{text:n.getShowTitle()?n.getTitle():null,position:"outer-middle"}}},grid:{x:{show:e.getShowGridLines(),lines:this.getLines().filter(function(e){return e.getVisible()&&e.getAxis()===p.Axis.X}).map(function(e){return a._mapChartLineToC3Line(e)})},y:{show:r.getShowGridLines(),lines:this.getLines().filter(function(e){return e.getVisible()&&e.getAxis()!==p.Axis.X}).map(function(e){return a._mapChartLineToC3Line(e)})}},regions:this.getAreas().filter(function(e){return e.getVisible()}).map(function(e){return{id:e.getId(),start:e.getStartValue(),end:e.getEndValue(),axis:e.getAxis().toLowerCase(),text:e.getTitle(),class:a.CSS_CLASS_AREA+" "+a.CSS_CLASS_AREA+"-"+e.getId()}}),transition:{duration:175}};this._chart=l.generate(i),g.selectAll("#".concat(t," g.c3-circles circle.c3-circle")).classed(this.CSS_HIGHLIGHT_PULSATE,!1),0<s.length&&s.forEach(function(e){g.select("#".concat(t," g.c3-circles-").concat(e.series," circle.c3-circle-").concat(e.point)).classed(a.CSS_HIGHLIGHT_PULSATE,!0)}),this._updateSeriesStyles(),this._updateLineStyles(),this._updateAreaStyles(),this.getClipZoomOverflow()?this.removeStyleClass(this.CSS_CLASS_NOCLIP):this.addStyleClass(this.CSS_CLASS_NOCLIP),this.getDomRef()&&$(this.getDomRef()).css("background-color",this.getBackgroundColor()),$(window).resize(this._resize.bind(this)),setTimeout(function(){a._resize()},150),setTimeout(function(){a._resize()},1500),this._getChartUpdateHandler().release()}},exit:function(){},setDataVisible:function(e){return this._chart&&(e?this._chart.show():this._chart.hide()),this.setProperty("dataVisible",e,!0)},setWidth:function(e){return this.setProperty("width",e,!0),this._chart&&this._chart.resize({width:this.getWidth()}),this},setHeight:function(e){return this.setProperty("height",e,!0),this._chart&&this._chart.resize({height:this.getHeigth()}),this},getWidth:function(){return this._getComputedSize(this.getProperty("width"),"width")},getHeigth:function(){return this._getComputedSize(this.getProperty("height"),"height")},setShowSubchart:function(e){return this.setProperty("showSubchart",e,!1)},setMicroMode:function(e){return e?this.addStyleClass(this.CSS_CLASS_MICRO_MODE):this.removeStyleClass(this.CSS_CLASS_MICRO_MODE),this.setProperty("microMode",e,!1)},setZoomEnabled:function(e){return this._chart&&this._chart.zoom.enable(e),this.setProperty("zoomEnabled",e,!0)},setClipZoomOverflow:function(e){return e?this.removeStyleClass(this.CSS_CLASS_NOCLIP):this.addStyleClass(this.CSS_CLASS_NOCLIP),this.setProperty("clipZoomOverflow",e,!0)},setShowDataPoints:function(e){return e?this.removeStyleClass(this.CSS_CLASS_NO_POINTS):this.addStyleClass(this.CSS_CLASS_NO_POINTS),this.setProperty("showDataPoints",e,!0)},setBackgroundColor:function(e){return this.getDomRef()&&$(this.getDomRef()).css("background-color",e),this.setProperty("backgroundColor",e,!0)},setLegendPosition:function(e){return this.setProperty("legendPosition",e,!1)},setShowLegend:function(e){return this._chart&&(e?this._chart.legend.show():this._chart.legend.hide()),this.setProperty("showLegend",e,!0)},setShowTooltip:function(e){return this.setProperty("showTooltip",e,!1)},setGroupedTooltip:function(e){return this.setProperty("groupedTooltip",e,!1)},setSwitchAxisPosition:function(e){return this.setProperty("switchAxisPosition",e,!1)},setXAxisType:function(e){return this.setProperty("xAxisType",e,!1)},getXAxis:function(){var e;return(e=this.getAggregation("xAxis"))||(e=new t,this.setAggregation("xAxis",e,!0)),e},getYAxis:function(){var e;return(e=this.getAggregation("yAxis"))||(e=new t,this.setAggregation("yAxis",e,!0)),e},getY2Axis:function(){var e;return(e=this.getAggregation("y2Axis"))||(e=new t({visible:!1}),this.setAggregation("y2Axis",e,!0)),e},setAggregation:function(e,t,i){var a=this;if(t)switch(e){case"xAxis":t.setProperty("_axisType",p.Axis.X,!0);break;case"yAxis":t.setProperty("_axisType",p.Axis.Y,!0);break;case"y2Axis":t.setProperty("_axisType",p.Axis.Y2,!0)}return["xAxis","yAxis","y2Axis"].includes(e)?(h.prototype.setAggregation.call(this,e,t,!1),t&&t.attachAxisUpdate(function(e){return a._onDataUpdateByCode(e.getParameter("code"))})):h.prototype.setAggregation.call(this,e,t,i),this},insertAggregation:function(e,t,i,a){var r=this;if("series"!==e||t.getKey()||t.setKey(this._getNumberRangeCreator().getNext()),["lines","areas"].includes(e))switch(h.prototype.insertAggregation.call(this,e,t,i,!0),e){case"lines":t.attachLineUpdate(function(e){return r._onDataUpdateByCode(e.getParameter("code"))}),this._onDataUpdateByCode(p.ChartUpdateCode.Line);break;case"areas":t.attachAreaUpdate(function(e){return r._onDataUpdateByCode(e.getParameter("code"))}),this._onDataUpdateByCode(p.ChartUpdateCode.Area)}else h.prototype.insertAggregation.call(this,e,t,i,a);return this},addAggregation:function(e,t,i){var a=this;if("series"!==e||t.getKey()||t.setKey(this._getNumberRangeCreator().getNext()),["lines","areas"].includes(e))switch(h.prototype.addAggregation.call(this,e,t,!0),e){case"lines":t.attachLineUpdate(function(e){return a._onDataUpdateByCode(e.getParameter("code"))}),this._onDataUpdateByCode(p.ChartUpdateCode.Line);break;case"areas":t.attachAreaUpdate(function(e){return a._onDataUpdateByCode(e.getParameter("code"))}),this._onDataUpdateByCode(p.ChartUpdateCode.Area)}else h.prototype.addAggregation.call(this,e,t,i);return this},removeAggregation:function(e,t,i){if(["series","lines","areas"].includes(e))switch(h.prototype.removeAggregation.call(this,e,t,!0),e){case"series":this._onDataUpdateByCode(p.ChartUpdateCode.DataPoint);break;case"lines":this._onDataUpdateByCode(p.ChartUpdateCode.Line);break;case"areas":this._onDataUpdateByCode(p.ChartUpdateCode.Area)}else h.prototype.removeAggregation.call(this,e,t,i);return this},removeAllAggregation:function(e,t){if(["series","lines","areas"].includes(e))switch(h.prototype.removeAllAggregation.call(this,e,!0),e){case"series":this._onDataUpdateByCode(p.ChartUpdateCode.DataPoint);break;case"lines":this._onDataUpdateByCode(p.ChartUpdateCode.Line);break;case"areas":this._onDataUpdateByCode(p.ChartUpdateCode.Area)}else h.prototype.removeAllAggregation.call(this,e,t);return this},destroyAggregation:function(e,t){if(["series","lines","areas"].includes(e))switch(h.prototype.destroyAggregation.call(this,e,!0),e){case"series":this._onDataUpdateByCode(p.ChartUpdateCode.DataPoint);break;case"lines":this._onDataUpdateByCode(p.ChartUpdateCode.Line);break;case"areas":this._onDataUpdateByCode(p.ChartUpdateCode.Area)}else h.prototype.destroyAggregation.call(this,e,t);return this},setModel:function(){return this._getChartUpdateHandler().halt(),h.prototype.setModel.apply(this,arguments),this._getChartUpdateHandler().release(),this._onDataUpdateByCode(),this},getXAxisLabelByIndex:function(t){var e=this.getXAxis(),i=this.getXAxisType(),a=e.getLabels();return(i===p.AxisType.Indexed?a.find(function(e){return parseFloat(e.getValue())===t}):a[t])||new r({visible:!1})},getXAxisIndexByValue:function(e){var t=this.getXAxis(),i=this.getXAxisType(),a=t.getLabels()||[],r=a.length;if(i===p.AxisType.Indexed)return parseFloat(e)||null;for(var n=0;n<r;n++){if(a[n].getValue()===e)return n}return null},getMinValueByAxis:function(e){var t=this.getXAxisType(),i=e.getProperty("_axisType")===p.Axis.X,a=e.getMinValue(),r=parseFloat(a),n=0===r;if(i)switch(t){case p.AxisType.Time:return/^\d{4}-\d{2}-\d{2}$/.test(a)?a:void 0;case p.AxisType.Indexed:case p.AxisType.Category:default:return n?r:r||void 0}return n?r:r||void 0},getMaxValueByAxis:function(e){var t=this.getXAxisType(),i=e.getProperty("_axisType")===p.Axis.X,a=e.getMaxValue(),r=parseFloat(a),n=0===r;if(i)switch(t){case p.AxisType.Time:return/^\d{4}-\d{2}-\d{2}$/.test(a)?a:void 0;case p.AxisType.Indexed:case p.AxisType.Category:default:return n?r:r||void 0}return n?r:r||void 0},_onDataUpdateByCode:function(e){if(!this._getChartUpdateHandler().isHalted()&&this.getDomRef())if(this._chart)switch(e){case p.ChartUpdateCode.Line:this._debounceUpdateChartLines(),this.fireChartDataUpdate();break;case p.ChartUpdateCode.Area:this._debounceUpdateChartAreas(),this.fireChartDataUpdate();break;default:this._debounceUpdate(),this.fireChartDataUpdate()}else this.rerender()},_onDataUpdate:function(){var a=this;if(this.getDomRef()){var t=this.getId(),e=this.getSeries(),i=e.map(function(e){return e.getKey()}),r=i.filter(function(t){return!1===a._chart.data().map(function(e){return e.id}).every(function(e){return e===t})}),n=this._chart.data().map(function(e){return e.id}).filter(function(t){return!1===i.some(function(e){return e===t})}),s=[],o=this.getXAxis(),c=this.getYAxis(),l=this.getY2Axis();if(0<r.length||0<n.length)this.rerender();else{h.prototype.setProperty.call(o,"visible",!this.getMicroMode(),!0),h.prototype.setProperty.call(c,"visible",!this.getMicroMode(),!0),h.prototype.setProperty.call(l,"visible",!this.getMicroMode(),!0),this._chart.internal.config.axis_x_tick_values=!1===o.getAutoTickValues()&&0<o.getLabels().length?o.getLabels().map(function(e,t){var i=e.getValue();switch(a.getXAxisType()){case p.AxisType.Time:return/^\d{4}-\d{2}-\d{2}$/.test(i)?i:void 0;case p.AxisType.Indexed:return parseFloat(i)||0;case p.AxisType.Category:default:return t}}):void 0;var u={x:"x",columns:[["x"].concat(_toConsumableArray(o.getLabels().map(function(e){return e.getValue()})))].concat(_toConsumableArray(e.map(function(i){return[i.getKey()].concat(_toConsumableArray(i.getData().map(function(e,t){return e.getVisible()&&e.getHighlightAnimation()!==p.DataPointAnimation.None&&s.push({series:i.getKey(),point:t,animation:e.getHighlightAnimation()}),e.getValueOrValuePair()})))}))),axes:0===e.length?[]:e.reduce(function(e,t){return e[t.getKey()]=t.getYAxis().toLowerCase(),e},{}),types:0===e.length?[]:e.reduce(function(e,t){return e[t.getKey()]=t.getType(),e},{}),names:0===e.length?[]:e.reduce(function(e,t){return e[t.getKey()]=t.getName()||t.getKey(),e},{}),colors:0===e.length?[]:e.reduce(function(e,t){return t.getColor()&&(e[t.getKey()]=t.getColor()),e},{}),unload:n,done:function(){a.fireChartDataUpdate(),setTimeout(a._chart.flush,a._chart.internal.config.transition_duration),d(a._chart.flush)}};this._chart.load(u),g.selectAll("#".concat(t," g.c3-circles circle.c3-circle")).classed(this.CSS_HIGHLIGHT_PULSATE,!1),0<s.length&&s.forEach(function(e){g.select("#".concat(t," g.c3-circles-").concat(e.series," circle.c3-circle-").concat(e.point)).classed(a.CSS_HIGHLIGHT_PULSATE,!0)}),this._chart.groups(0===e.length?[]:e.reduce(function(e,t){return t&&t.getGroupKey()&&!e.includes(t.getGroupKey())&&e.push(t.getGroupKey()),e},[]).map(function(t){return e.filter(function(e){return e.getGroupKey()===t}).map(function(e){return e.getKey()})})),this._updateSeriesStyles(),this._chart.axis.labels({x:o.getShowTitle()?o.getTitle():null,y:c.getShowTitle()?c.getTitle():null,y2:l.getShowTitle()?l.getTitle():null}),this._chart.axis.showX(o.getVisible()),this._chart.axis.showY(c.getVisible()),this._chart.axis.showY2(l.getVisible()),this._chart.axis.range({min:{X:this.getMinValueByAxis(o),y:this.getMinValueByAxis(c),y2:this.getMinValueByAxis(l)},max:{x:this.getMaxValueByAxis(o),y:this.getMaxValueByAxis(c),y2:this.getMaxValueByAxis(l)}})}}},_updateChartLines:function(){var t=this,i=[].concat(this._chart.xgrids()),a=[].concat(this._chart.ygrids()),e=this.getLines().filter(function(e){return e.getVisible()&&e.getAxis()===p.Axis.X}).map(function(e){return t._mapChartLineToC3Line(e)}),r=this.getLines().filter(function(e){return e.getVisible()&&e.getAxis()!==p.Axis.X}).map(function(e){return t._mapChartLineToC3Line(e)});if(0<e.filter(function(t){var e=i.find(function(e){return e.id===t.id});return e&&!1===c(t,e)}).length)this._chart.xgrids(e);else{i.filter(function(t){return e.every(function(e){return e.id!==t.id})}).forEach(function(e){t._chart.xgrids.remove({class:e.class})});var n=e.filter(function(t){return i.every(function(e){return e.id!==t.id})});0<n.length&&this._chart.xgrids.add(n)}if(0<r.filter(function(t){var e=a.find(function(e){return e.id===t.id});return e&&!1===c(t,e)}).length)this._chart.ygrids(r);else{a.filter(function(t){return r.every(function(e){return e.id!==t.id})}).forEach(function(e){t._chart.ygrids.remove({class:e.class})});var s=r.filter(function(t){return a.every(function(e){return e.id!==t.id})});0<s.length&&this._chart.ygrids.add(s)}this._updateLineStyles()},_updateChartAreas:function(){var t=this,e=this._chart.regions()||[],i=Array.isArray(e)?e:[e],a=this.getAreas().filter(function(e){return e.getVisible()}).map(function(e){return{id:e.getId(),start:e.getStartValue(),end:e.getEndValue(),axis:e.getAxis().toLowerCase(),text:e.getTitle(),class:"".concat(t.CSS_CLASS_AREA," ").concat(t.CSS_CLASS_AREA,"-").concat(e.getId())}}),r=i.filter(function(t){return a.every(function(e){return e.id!==t.id})}).map(function(e){return"".concat(t.CSS_CLASS_AREA,"-").concat(e.id)});0<r.length&&this._chart.regions.remove({classes:r});var n=a.filter(function(t){return i.every(function(e){return e.id!==t.id})});0<n.length&&this._chart.regions.add(n);var s=a.filter(function(t){var e=i.find(function(e){return e.id===t.id});return e&&!1===c(t,e)});0<s.length&&this._chart.regions(s),this._updateAreaStyles()},_mapChartLineToC3Line:function(e){var t=e.getShowLineSelector()?this.CSS_CLASS_LINE_SHOWSELECTOR:"",i=e.getSelectorIconOnly()?this.CSS_CLASS_LINE_ICONONLY:"";return{id:e.getId(),value:e.getValue(),axis:e.getAxis().toLowerCase(),text:e.getTitle(),position:e.getTitlePosition().toLowerCase(),showSelector:!!e.getShowLineSelector(),class:"".concat(this.CSS_CLASS_LINE," ").concat(this.CSS_CLASS_LINE,"-").concat(e.getStyle()," ").concat(this.CSS_CLASS_LINE,"-").concat(e.getId()," ").concat(t," ").concat(i)}},_onSeriesVisibilityUpdate:function(e){var t=e.getParameter("chartSeries");t.getVisible()?this._chart.show(t.getKey(),{withLegend:!0}):this._chart.hide(t.getKey(),{withLegend:!0})},_updateSeriesStyles:function(){var s=this,o=this.getId();this.getSeries().forEach(function(e){var t,i,a=e.getKey();switch(s._isShapeType(e.getType())?e.getShapeStyle():p.ShapeStyle.Solid){case p.ShapeStyle.Striped:i=s._chart.data.colors()[e.getKey()],g.select("#".concat(o," defs #").concat(o,"-stripe-pattern-").concat(a)).empty()&&g.select("#".concat(o," defs")).append("pattern").attr("id","".concat(o,"-stripe-pattern-").concat(a)).attr("width","8").attr("height","8").attr("patternUnits","userSpaceOnUse").attr("class","stripe-pattern-".concat(a)).append("path").attr("d","M1,0L5,0L0,5L0,1L1,0 M8,1L8,5L5,8L1,8L8,1"),(t=g.select("#".concat(o," defs #").concat(o,"-stripe-style-").concat(a))).empty()&&(t=g.select("#".concat(o," defs")).append("style").attr("id","".concat(o,"-stripe-style-").concat(a)).attr("type","text/css")),t.text("#".concat(o," .stripe-pattern-").concat(a," path {\n                fill: ").concat(i,";\n                stroke: none;\n              }\n              #").concat(o," .c3-target-").concat(a," .c3-shape {\n                fill: url(#").concat(o,"-stripe-pattern-").concat(a,") !important;\n              }"));break;case p.ShapeStyle.Solid:default:(t=g.select("#".concat(o," defs #").concat(o,"-stripe-style-").concat(a))).empty()||t.text("")}}),this.getSeries().forEach(function(e){var t,i,a,r=e.getKey(),n=s._isLineType(e.getType())?e.getLineStyle():p.LineStyle.Solid;switch(e.getLineAnimationSpeed()){case p.AnimationSpeed.Fast:a=20;break;case p.AnimationSpeed.Medium:a=50;break;case p.AnimationSpeed.Slow:a=150;break;case p.AnimationSpeed.None:default:a=0}switch(n){case p.LineStyle.Dashed:case p.LineStyle.Dotted:i=e.getLineStyle()===p.LineStyle.Dotted?"1 5":"5",(t=g.select("#".concat(o," defs #").concat(o,"-dashdot-style-").concat(r))).empty()&&(t=g.select("#".concat(o," defs")).append("style").attr("id","".concat(o,"-dashdot-style-").concat(r)).attr("type","text/css")),t.text("#".concat(o," .c3-target-").concat(r," path.c3-shape {\n                                    stroke-dashoffset: ").concat(e.getLineAnimationForwards()?"":"-","50rem;\n                                    stroke-dasharray: ").concat(i,";\n                                    stroke-linecap: round;\n\n                                    -webkit-animation: ui5-viz-chart-dash-animation ").concat(a,"s 0s linear infinite forwards;\n                                    -moz-animation: ui5-viz-chart-dash-animation ").concat(a,"s 0s linear infinite forwards;\n                                    -ms-animation: ui5-viz-chart-dash-animation ").concat(a,"s 0s linear infinite forwards;\n                                    -o-animation: ui5-viz-chart-dash-animation ").concat(a,"s 0s linear infinite forwards;\n                                    animation: ui5-viz-chart-dash-animation ").concat(a,"s 0s linear infinite forwards;\n                                }"));break;case p.LineStyle.Solid:default:(t=g.select("#".concat(o," defs #").concat(o,"-dashdot-style-").concat(r))).empty()||t.text("")}})},_updateLineStyles:function(){var u=this,h=this.getId(),d="",e=g.select("#".concat(h," defs #").concat(h,"-line-style"));e.empty()&&(e=g.select("#".concat(h," defs")).append("style").attr("id","".concat(h,"-line-style")).attr("type","text/css")),this.getLines().forEach(function(e){var t,i,a=e.getId(),r=e.getColor(),n=e.getStyle(),s="#".concat(h," .").concat(u.CSS_CLASS_LINE,"-").concat(a),o="".concat(h,"-").concat(a);switch(r&&(d+="".concat(s," line {\n                stroke: ").concat(r,";\n            }\n\n            ").concat(s," circle {\n                stroke: ").concat(r,";\n            }\n\n            ").concat(s," text {\n                fill: ").concat(r,";\n            }")),n){case p.LineStyle.Dashed:case p.LineStyle.Dotted:i=n===p.LineStyle.Dotted?"1 5":"5",(t=g.select("#".concat(h," defs #").concat(o))).empty()&&(t=g.select("#".concat(h," defs")).append("style").attr("id","".concat(o)).attr("type","text/css")),t.text("".concat(s," line {\n                    stroke-dasharray: ").concat(i,";\n                    stroke-linecap: round;\n                }"));break;case p.LineStyle.Solid:default:(t=g.select("#".concat(h," defs #").concat(o))).empty()||t.text("")}var c=g.select(s),l=sap.ui.core.IconPool.getIconInfo(e.getLineSelectorIcon());e.getShowLineSelector()?(c.select(".c3-grid-lines-circle-text").attr("font-family",l.fontFamily).text(l.content),c.select(".c3-grid-lines-circle-hover").on("click",function(){e.fireSelectorPress({line:e,selectorDomRef:this.previousSibling})})):c.select(".c3-grid-lines-circle-hover").on("click",function(){})}),e.text(d)},_updateAreaStyles:function(){var a=this,r=this.getId(),n="",e=g.select("#".concat(r," defs #").concat(r,"-area-style"));e.empty()&&(e=g.select("#".concat(r," defs")).append("style").attr("id","".concat(r,"-area-style")).attr("type","text/css")),this.getAreas().forEach(function(e){var t=e.getId(),i=e.getColor()||"#000000";switch(e.getStyle()){case p.ShapeStyle.Striped:g.select("#".concat(r," defs #").concat(r,"-area-stripe-pattern-").concat(t)).empty()&&g.select("#".concat(r," defs")).append("pattern").attr("id","".concat(r,"-area-stripe-pattern-").concat(t)).attr("width","8").attr("height","8").attr("patternUnits","userSpaceOnUse").attr("class","area-stripe-pattern-".concat(t)).append("path").attr("d","M1,0L5,0L0,5L0,1L1,0 M8,1L8,5L5,8L1,8L8,1"),n+="#".concat(r," .area-stripe-pattern-").concat(t," path {\n                                    fill: ").concat(i,";\n                                    stroke: none;\n                                }\n                                #").concat(r," .").concat(a.CSS_CLASS_AREA,"-").concat(t," rect.c3-region-stripe,\n                                #").concat(r," .").concat(a.CSS_CLASS_AREA,"-").concat(t," text.c3-region-text {\n                                    fill: ").concat(i,";\n                                }\n                                #").concat(r," .").concat(a.CSS_CLASS_AREA,"-").concat(t," rect.c3-region-area {\n                                    fill: url(#").concat(r,"-area-stripe-pattern-").concat(t,") !important;\n                                }");break;case p.ShapeStyle.Solid:default:n+="#".concat(r," .").concat(a.CSS_CLASS_AREA,"-").concat(t," rect.c3-region-stripe,\n                                #").concat(r," .").concat(a.CSS_CLASS_AREA,"-").concat(t," text.c3-region-text {\n                                    fill: ").concat(i,";\n                                }\n                                #").concat(r," .").concat(a.CSS_CLASS_AREA,"-").concat(t," rect.c3-region-area {\n                                    fill: ").concat(i,";\n                                }")}}),e.text(n)},_isShapeType:function(e){var t=!1;switch(e){case p.ChartSeriesType.Bar:t=!0;break;default:t=!1}return t},_isLineType:function(e){var t=!1;switch(e){case p.ChartSeriesType.Line:case p.ChartSeriesType.Spline:case p.ChartSeriesType.Step:case p.ChartSeriesType.AreaLine:case p.ChartSeriesType.AreaSpline:case p.ChartSeriesType.AreaStep:case p.ChartSeriesType.RibbonLine:case p.ChartSeriesType.RibbonSpline:case p.ChartSeriesType.RibbonStep:t=!0;break;default:t=!1}return t},_isRibbonType:function(e){return e===(p.ChartSeriesType.RibbonLine||p.ChartSeriesType.RibbonSpline||p.ChartSeriesType.RibbonStep)},_getAvailableSize:function(e){var t=0;return e="width"===e||"height"===e?e:"width",this.getDomRef()&&("width"===e?(t+=parseInt(getComputedStyle(this.getDomRef(),"").marginLeft.match(/(\d*(\.\d*)?)/,10)[1])||0,t+=parseInt(getComputedStyle(this.getDomRef(),"").marginRight.match(/(\d*(\.\d*)?)/,10)[1])||0):(t+=parseInt(getComputedStyle(this.getDomRef(),"").marginTop.match(/(\d*(\.\d*)?)/,10)[1])||0,t+=parseInt(getComputedStyle(this.getDomRef(),"").marginBottom.match(/(\d*(\.\d*)?)/,10)[1])||0)),$(this._getParentDomRef())[e]()-t},_getComputedSize:function(e,t){e=e||"auto",t="width"===t||"height"===t?t:"width";var i,a=p.parseCSSSize(e),r=1;switch(a.unit){case"rem":i=a.value*parseInt(getComputedStyle(document.body,"").fontSize.match(/(\d*(\.\d*)?)/,10)[1])||0;break;case"em":i=a.value*parseInt(getComputedStyle(this._getParentDomRef(),"").fontSize.match(/(\d*(\.\d*)?)/,10)[1])||0;break;case"px":i=a.value&&0<a.value?a.value:this._getAvailableSize(t);break;case"vw":r=(a.value&&0<a.value?a.value:100)/100,i=this._getAvailableSize("width")*r;break;case"vh":r=(a.value&&0<a.value?a.value:100)/100,i=this._getAvailableSize("height")*r;break;case"%":r=(a.value&&0<a.value?a.value:100)/100,i=this._getAvailableSize(t)*r;break;case"initial":case"inherit":case"auto":i=this._getAvailableSize(t);break;default:jQuery.sap.log.warning("CSS unit "+a.unit+' is not supported, yet. Fallback to "auto" (max. width).'),i=this._getAvailableSize(t)}return i},_resize:function(){return this._chart&&this._chart.resize({width:this.getWidth(),height:this.getHeigth()}),this},_getParentDomRef:function(){var e=this.getDomRef()?this.getDomRef().parentNode:document.body;return e||document.body}})},!0);